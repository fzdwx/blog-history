[{"content":" æ“ä½œç³»ç»Ÿæ˜¯æœ€æ—©çš„å¹¶å‘ç¨‹åºä¹‹ä¸€ã€‚\nå¼€å§‹ï¼Œæˆ‘ä»¬è‚¯å®šè¦ç†è§£ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œä»¥åŠå®ƒä»¬çš„åŒºåˆ«ã€‚\nå¹¶è¡Œï¼š å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚ å¹¶å‘ï¼š å¯ä»¥æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä½†æ˜¯åŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä¼šåœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚ å¦‚æœä¸€ä¸ªæ“ä½œç³»ç»Ÿè¦æ”¯æŒå¹¶å‘ï¼Œé‚£ä¹ˆä»¥ä¸‹çš„å“ªäº›éƒ¨åˆ†éœ€è¦å¤åˆ¶å¤šä»½ï¼Ÿ å…¨å±€å˜é‡ å †å†…å­˜ å‡½æ•°è°ƒç”¨æ ˆ ç­”æ¡ˆæ˜¾è€Œæ˜“è§çš„æ˜¯ å‡½æ•°è°ƒç”¨æ ˆ å¹¶å‘ç¼–ç¨‹ä¸ºä»€ä¹ˆéš¾ï¼Ÿ\næ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«ä¸€ä¸ªå †å†…å­˜ å•ä¸ªçº¿ç¨‹çš„çŠ¶æ€æœºçš„æ‰§è¡Œç»“æœæ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒä»¬æ¶‰åŠåˆ°ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´æ¯æ¬¡ç¨‹åºè¿è¡Œçš„ç»“æœå¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ å¤šçº¿ç¨‹çŠ¶æ€æœºæ‰§è¡Œç¤ºæ„å›¾ æ— æ³•ä¿è¯çš„ä¸‰ä¸ªç‰¹æ€§ åŸå­æ€§: ä¸€æ®µä»£ç æ‰§è¡Œæ—¶ç‹¬å æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿ æ— æ³•ä¿è¯çš„ä¾‹å­ï¼š ä¸¤ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå€¼è¿›è¡Œ ++ N æ¬¡ï¼Œ è¿™ä¸ªç»“æœå¯èƒ½ä¸æ˜¯ 2N å®ç°åŸå­æ€§ï¼š lock \u0026amp; unlock å®ç°ä¸´ç•Œå»çš„ç»å¯¹ä¸²è¡ŒåŒ– å…¶ä»–éƒ¨åˆ†ä»ç„¶å¯ä»¥å¹¶è¡Œæ‰§è¡Œ é¡ºåºæ€§: ä»£ç æŒ‰ç¼–å†™çš„é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å®ç°æºä»£ç çš„æŒ‰é¡ºåºç¿»è¯‘(ä¸ºæ±‡ç¼–)ã€‚ ä¼šå¯¼è‡´çš„åŸå› : ç¼–è¯‘å™¨çš„ä¼˜åŒ–(ç¼–è¯‘å™¨å¯¹å†…å­˜è®¿é—® â€œeventually consistentâ€ çš„å¤„ç†å¯¼è‡´å…±äº«å†…å­˜ä½œä¸ºçº¿ç¨‹åŒæ­¥å·¥å…·çš„å¤±æ•ˆã€‚)ï¼Œæ¯”å¦‚è¯´ gcc åŠ -O1/2 å®é™…ä¾‹å­ï¼š while(!done); // =\u0026gt; opt if (!done) while(1); å®ç°æºä»£ç çš„æŒ‰é¡ºåºç¿»è¯‘ï¼š åœ¨ä»£ç ä¸­æ’å…¥â€œä¼˜åŒ–ä¸èƒ½ç©¿è¶Šçš„â€ barrier asm volatile (\u0026quot;\u0026quot; ::: \u0026ldquo;memory\u0026rdquo;); å«ä¹‰æ˜¯ å¯ä»¥è¯»å†™ä»»ä½•å†…å­˜ ä½¿ç”¨ volatile å˜é‡ ä¿æŒ c è¯­ä¹‰å’Œæ±‡ç¼–è¯­ä¹‰ä¸€è‡´ extern int volatile done; while(!done); å¯è§æ€§ï¼š å¯¹æŸä¸ªå…±äº«å†…å­˜çš„ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹è¦ç«‹é©¬å¯è§ã€‚ ä¸€æ®µä»£ç : å®ƒçš„ç»“æœå¯èƒ½ä¸º: 0,0 0,1 1,0 1,1 4ç§æƒ…å†µ, ä½†æ˜¯åªè¦æœ‰æ–¹æ³•(f1 / f2)è¢«æ‰§è¡Œå°±ä¸ä¼šå‡ºç°0,0è¿™ç§ç»“æœã€‚ä½†å®é™…çš„æƒ…å†µæ˜¯0,0è¿™ä¸ªç»“æœå‡ºç°çš„æ¬¡æ•°æœ€å¤šã€‚ int x = 0, y= 0; void f1(){ x = 1; asm volatile(\u0026#34;\u0026#34;:::\u0026#34;memory\u0026#34;); printf(\u0026#34;%d \u0026#34;,y) } void f2(){ y = 1; asm volatile(\u0026#34;\u0026#34;:::\u0026#34;memory\u0026#34;); printf(\u0026#34;%d \u0026#34;,x) } åŸå› æ˜¯ï¼šç°ä»£å¤„ç†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€ç¼–è¯‘å™¨ã€‚å•ä¸ªå¤„ç†å™¨æŠŠæ±‡ç¼–ï¼ˆç”¨ç”µè·¯ï¼‰ç¼–è¯‘æˆæ›´å°çš„æ“ä½œç¬¦ã€‚ åœ¨ä»»ä½•æ—¶åˆ»ï¼Œå¤„ç†å™¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªæ“ä½œç¬¦çš„å®¹å™¨ æ¯ä¸€å‘¨æœŸå°½å¯èƒ½å¤šçš„è¡¥å……æ“ä½œç¬¦ æ¯ä¸€å‘¨æœŸæ‰§è¡Œå°½å¯èƒ½å¤šçš„æ“ä½œç¬¦ ä¹±åºæ‰§è¡Œï¼ŒæŒ‰åºæäº¤ å®ç°é¡ºåºä¸€è‡´æ€§ï¼š ä½¿ç”¨mfenceæŒ‡ä»¤æˆ–ä½¿ç”¨åŸå­æŒ‡ä»¤(lock),è®©å®ƒæ¯æ¬¡éƒ½åˆ°å†…å­˜ä¸­å»è¯»å–ï¼Œè€Œä¸è¯»å–ç¼“å­˜ è‡ªæ—‹é” spin lock å‡å¦‚ç¡¬ä»¶èƒ½æä¾›ä¸€æ¡â€œç¬é—´å®Œæˆâ€ çš„è¯» + å†™çš„æŒ‡ä»¤\nå…¶ä»–æ‰€æœ‰äººæš‚åœï¼Œload + store å¦‚æœæœ‰äººåŒæ—¶è¯·æ±‚ï¼Œç¡¬ä»¶é€‰å‡ºä¸€ä¸ªèƒœåˆ©è€… è´¥è€…ç­‰èƒœåˆ©è€…å®Œæˆåç»§ç»­ X86æä¾›çš„ lock å‰ç¼€ long sum = 0; void sum(){ for(;;){ asm volatile(\u0026#34;lock addq $1, %0\u0026#34;: \u0026#34;+m\u0026#34;(sum)); } } atomic exchange(load + store)\nint xchg(volatile int *addr, int newval) { int result; asm volatile (\u0026#34;lock xchg %0, %1\u0026#34; : \u0026#34;+m\u0026#34;(*addr), \u0026#34;=a\u0026#34;(result) : \u0026#34;1\u0026#34;(newval)); return result; } å®ç°è‡ªæ—‹é”:\nint locked = 0; void lock() { while (xchg(\u0026amp;locked, 1)) ; } void unlock() { xchg(\u0026amp;locked, 0); } lock æŒ‡ä»¤çš„ç°ä»£å®ç° åœ¨ L1 cache å±‚ä¿æŒä¸€è‡´æ€§\næ‰€æœ‰ cpu çš„L1ç¼“å­˜éƒ½ç”¨æ€»çº¿è¿èµ·æ¥ å¯¹æŸä¸ªå†…å­˜ M æ‰§è¡Œ lockï¼Œåˆ™å…¶ä»–æ‰€æœ‰ç¼“å­˜çš„ M éƒ½æ— æ•ˆï¼ˆè¿™ä¸ªä»£ä»·éå¸¸å¤§ï¼‰ RISC-V çš„åŸå­æ“ä½œ åŸå­æ“ä½œçš„ç›®çš„ï¼š\na = load(x); if (a == xx){ store(x,y) } a = load(x); store(x,y) a = load(x); a++; store(x,a) å®ƒä»¬çš„æœ¬è´¨éƒ½æ˜¯ load -\u0026gt; exec(è¿›è¡Œè¿ç®—) -\u0026gt; store Load reserved / Store Conditional LR: åœ¨è¯»å–æ—¶ä¼šå¯¹è¿™ä¸ªå†…å­˜åŠ ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œä¸­æ–­ã€å…¶ä»–å¤„ç†å™¨çš„å†™å…¥éƒ½ä¼šå¯¼è‡´æ ‡è®°æ¶ˆé™¤\nlr.w rd (rs1) rd = M[rs1] reserve M[rs1] SC: å¦‚æœé‚£ç‰‡å†…å­˜è¿˜å­˜åœ¨æ ‡è®°åˆ™ç»§ç»­å†™å…¥\nsc.w rd rs2 (rs1) if still reserved: M[rs1] = rs2 rd = 0 else: rd = nonzero å®ç° cas int cas(int *addr, int cmp_val, int new_val){ int old_val = *addr; if (old_val == cmp_val){ *addr = new_val; return 0; }else{ return 1; } } cas: lr.w t0 (a0) bne t0 a1 fail sc.w t0 a2 (a0) bnez t0 cas li a0 0 jr ra fail: li a0 1 ja ra äº’æ–¥é” è‡ªæ—‹é”çš„é—®é¢˜: 1.\n","permalink":"https://fzdwx.github.io/posts/2022-12-16-os-concurrent/","summary":"æ“ä½œç³»ç»Ÿæ˜¯æœ€æ—©çš„å¹¶å‘ç¨‹åºä¹‹ä¸€ã€‚\nå¼€å§‹ï¼Œæˆ‘ä»¬è‚¯å®šè¦ç†è§£ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œä»¥åŠå®ƒä»¬çš„åŒºåˆ«ã€‚\nå¹¶è¡Œï¼š å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚ å¹¶å‘ï¼š å¯ä»¥æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä½†æ˜¯åŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä¼šåœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚ å¦‚æœä¸€ä¸ªæ“ä½œç³»ç»Ÿè¦æ”¯æŒå¹¶å‘ï¼Œé‚£ä¹ˆä»¥ä¸‹çš„å“ªäº›éƒ¨åˆ†éœ€è¦å¤åˆ¶å¤šä»½ï¼Ÿ å…¨å±€å˜é‡ å †å†…å­˜ å‡½æ•°è°ƒç”¨æ ˆ ç­”æ¡ˆæ˜¾è€Œæ˜“è§çš„æ˜¯ å‡½æ•°è°ƒç”¨æ ˆ å¹¶å‘ç¼–ç¨‹ä¸ºä»€ä¹ˆéš¾ï¼Ÿ\næ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«ä¸€ä¸ªå †å†…å­˜ å•ä¸ªçº¿ç¨‹çš„çŠ¶æ€æœºçš„æ‰§è¡Œç»“æœæ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸ä¸€æ ·ï¼Œå› ä¸ºå®ƒä»¬æ¶‰åŠåˆ°ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´æ¯æ¬¡ç¨‹åºè¿è¡Œçš„ç»“æœå¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ å¤šçº¿ç¨‹çŠ¶æ€æœºæ‰§è¡Œç¤ºæ„å›¾ æ— æ³•ä¿è¯çš„ä¸‰ä¸ªç‰¹æ€§ åŸå­æ€§: ä¸€æ®µä»£ç æ‰§è¡Œæ—¶ç‹¬å æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿ æ— æ³•ä¿è¯çš„ä¾‹å­ï¼š ä¸¤ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå€¼è¿›è¡Œ ++ N æ¬¡ï¼Œ è¿™ä¸ªç»“æœå¯èƒ½ä¸æ˜¯ 2N å®ç°åŸå­æ€§ï¼š lock \u0026amp; unlock å®ç°ä¸´ç•Œå»çš„ç»å¯¹ä¸²è¡ŒåŒ– å…¶ä»–éƒ¨åˆ†ä»ç„¶å¯ä»¥å¹¶è¡Œæ‰§è¡Œ é¡ºåºæ€§: ä»£ç æŒ‰ç¼–å†™çš„é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å®ç°æºä»£ç çš„æŒ‰é¡ºåºç¿»è¯‘(ä¸ºæ±‡ç¼–)ã€‚ ä¼šå¯¼è‡´çš„åŸå› : ç¼–è¯‘å™¨çš„ä¼˜åŒ–(ç¼–è¯‘å™¨å¯¹å†…å­˜è®¿é—® â€œeventually consistentâ€ çš„å¤„ç†å¯¼è‡´å…±äº«å†…å­˜ä½œä¸ºçº¿ç¨‹åŒæ­¥å·¥å…·çš„å¤±æ•ˆã€‚)ï¼Œæ¯”å¦‚è¯´ gcc åŠ -O1/2 å®é™…ä¾‹å­ï¼š while(!done); // =\u0026gt; opt if (!done) while(1); å®ç°æºä»£ç çš„æŒ‰é¡ºåºç¿»è¯‘ï¼š åœ¨ä»£ç ä¸­æ’å…¥â€œä¼˜åŒ–ä¸èƒ½ç©¿è¶Šçš„â€ barrier asm volatile (\u0026quot;\u0026quot; ::: \u0026ldquo;memory\u0026rdquo;); å«ä¹‰æ˜¯ å¯ä»¥è¯»å†™ä»»ä½•å†…å­˜ ä½¿ç”¨ volatile å˜é‡ ä¿æŒ c è¯­ä¹‰å’Œæ±‡ç¼–è¯­ä¹‰ä¸€è‡´ extern int volatile done; while(!","title":"æ“ä½œç³»ç»Ÿçš„å¹¶å‘ç¼–ç¨‹"},{"content":"Resource \u0026nbsp;RISC-V Green Card \u0026nbsp;RISC-V Call convertion \u0026nbsp;P\u0026amp;H(RISC-V) åœ¨æ±‡ç¼–è¯­è¨€ä¸­æ²¡æœ‰å˜é‡è¿™ä¸ªæ¦‚å¿µï¼Œæ±‡ç¼–è¯­è¨€é€šå¸¸æ“ä½œçš„æ˜¯å¯„å­˜å™¨ã€‚ç®—æœ¯æŒ‡ä»¤çš„æ“ä½œæ•°å¿…é¡»å–è‡ªå¯„å­˜å™¨ï¼Œå†…å»ºäºç¡¬ä»¶çš„ç‰¹æ®Šä½ç½®(CPUå†…ï¼Ÿ)ã€‚\nTIP å¯„å­˜å™¨ï¼ˆRegisterï¼‰æ˜¯\u0026nbsp;ä¸­å¤®å¤„ç†å™¨ å†…ç”¨æ¥æš‚å­˜æŒ‡ä»¤ã€\u0026nbsp;æ•°æ® å’Œ\u0026nbsp;åœ°å€ çš„\u0026nbsp;ç”µè„‘å­˜å‚¨å™¨ ã€‚å¯„å­˜å™¨çš„å­˜è´®å®¹é‡æœ‰é™ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚åœ¨\u0026nbsp;è®¡ç®—æœºä½“ç³»ç»“æ„ é‡Œï¼Œå¯„å­˜å™¨å­˜å‚¨åœ¨å·²çŸ¥æ—¶é—´ç‚¹æ‰€ä½œè®¡ç®—çš„ä¸­é—´ç»“æœï¼Œé€šè¿‡å¿«é€Ÿåœ°è®¿é—®æ•°æ®æ¥åŠ é€Ÿ\u0026nbsp;è®¡ç®—æœºç¨‹åº çš„æ‰§è¡Œã€‚ RISC-V Card RISC-V æ“ä½œæ•° å¦‚æœå¯„å­˜å™¨çš„å¤§å°æ˜¯ 64ä½ åˆ™ç§°ä¸ºåŒå­—ï¼Œ32ä½ åˆ™æ˜¯å•å­—ã€‚ x0 è¢«ç¡¬è¿æ¥åˆ° 0 add x3, x4, x0 =\u0026gt; x3 = x4 (x0 is hard-wired to value 0) æ±‡ç¼–æŒ‡ä»¤ å­˜å‚¨æ“ä½œæ•° TIP å°†æ•°æ®ä»å†…å­˜å¤åˆ¶åˆ°å¯„å­˜å™¨çš„æ•°æ®ä¼ è¾“æŒ‡ä»¤ç§°ä¸º è½½å…¥æŒ‡ä»¤(load)ã€‚åœ¨ RISC-V ä¸­æŒ‡ä»¤æ˜¯ ld,è¡¨ç¤ºå–åŒå­—ã€‚ ä¸€ä¸ªä»æ•°ç»„ä¸­å–å€¼çš„Cç¨‹åºï¼Œå†™å‡ºæ±‡ç¼–ä»£ç  g = h + A[8]; A æ˜¯ä¸€ä¸ª 100 ä¸ªåŒå­—ç»„æˆçš„æ•°ç»„ï¼Œg, håˆ†åˆ«å­˜å‚¨åœ¨ x20, x21 ä¸­ï¼Œæ•°ç»„èµ·å§‹åœ°å€æˆ–åŸºå€ä½äº x22 ä¸­ã€‚\nld x9, 8(x22) // x9 = A[8] add x21, x20, x9; // x21 = x20 + x9 å­˜æ”¾åŸºå€çš„å¯„å­˜å™¨(x22)è¢«ç§°ä¸ºåŸºå€å¯„å­˜å™¨, æ•°æ®ä¼ è¾“æŒ‡ä»¤ä¸­çš„ 8 ç§°ä¸ºåç§»é‡ã€‚\nå®é™…çš„RISC-Vå†…å­˜åœ°å€å’Œå†…å­˜ä¸­åŒå­—çš„å†…å®¹ã€‚ åŒå­—åœ°å€æ˜¯ 8 çš„å€æ•°ï¼ŒåŒç†å•å­—åœ°å€æ˜¯ 4 çš„å€æ•° å¤§ç«¯ä¸å°ç«¯ç¼–å€ è®¡ç®—æœºåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ä½¿ç”¨æœ€å·¦è¾¹æˆ–â€œå¤§ç«¯â€å­—èŠ‚çš„åœ°å€ä½œä¸ºåŒå­—åœ°å€ï¼Œå¦ä¸€ç§ä½¿ç”¨æœ€å³ç«¯æˆ–â€œå°ç«¯â€å­—èŠ‚çš„åœ°å€ä½œä¸ºåŒå­—åœ°å€ã€‚\nRISC-V ä½¿ç”¨å°ç«¯ ã€‚ç”±äºä»…åœ¨ä»¥åŒå­—å½¢å¼å’Œ 8 ä¸ªå•ç‹¬å­—èŠ‚è®¿é—®ç›¸åŒæ•°æ®æ—¶ï¼Œå­—èŠ‚é¡ºåºæ‰æœ‰å½±å“ï¼Œå› æ­¤å¤§å¤šæƒ…å†µä¸éœ€è¦å…³ç³»â€œå¤§å°ç«¯â€ã€‚\næ‰€ä»¥ä¸ºäº†ä¸Šé¢çš„ä»£ç è·å¾—æ­£ç¡®çš„å­—èŠ‚åœ°å€åŠ åˆ° x22 è¿™ä¸ªå¯„å­˜å™¨çš„åç§»é‡ä¸º 64ï¼ˆ8x8ï¼‰ã€‚\nä¸è½½å…¥æŒ‡ä»¤ç›¸åçš„æŒ‡ä»¤é€šå¸¸è¢«æˆä¸ºå­˜å‚¨æŒ‡ä»¤(store),ä»å¯„å­˜å™¨å¤åˆ¶æ•°æ®åˆ°å†…å­˜ã€‚æŒ‡ä»¤æ˜¯sd,è¡¨ç¤ºå­˜å‚¨åŒå­—ã€‚\nTIP åœ¨ä¸€äº›ä½“ç³»ç»“æ„ä¸­ï¼Œå­—çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 4 çš„å€æ•°ï¼ŒåŒå­—çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 çš„å€æ•°ã€‚è¯¥è¦æ±‚æˆä¸ºå¯¹é½é™åˆ¶ RISC-V å’Œ Intel x86 æ²¡æœ‰å¯¹é½é™åˆ¶ï¼Œä½† MIPS æœ‰è¿™ä¸ªé™åˆ¶ã€‚\nä½¿ç”¨ load å’Œ store ç¼–è¯‘ç”ŸæˆæŒ‡ä»¤ A[12] = h + A[8]; h å­˜æ”¾åœ¨ x21 ä¸­ï¼ŒA çš„åŸºå€å­˜æ”¾åœ¨ x22 ä¸­ã€‚\nld x9, 64(x22) // x9 = A[8] add x9, x21, x9 // x9 = h + A[8] sd x9, 96(x22) // A[12] = x9 å°†å­—ç¬¦ä¸²å¤åˆ¶ç¨‹åºç¼–è¯‘ä¸ºæ±‡ç¼– void strcpy(char x[],char y[]){ size_t i; i = 0; while((x[i] = y[i]) != \u0026#39;\\0\u0026#39;){ i += 1; } } x, y çš„åŸºå€å­˜æ”¾åœ¨ x10 å’Œ x11 ä¸­ï¼Œ i å­˜æ”¾åœ¨ x19 ä¸­ã€‚\nstrcpy: addi sp, sp, -8 // è°ƒæ•´æ ˆæŒ‡é’ˆï¼Œä»¥å­˜æ”¾ä¸€ä¸ªitem(x19) sd x19, 0(sp) // x19 å…¥æ ˆ add x19, x0, x0 // x19 = 0 + 0 L1: add x5, x19, x11 // x5 = x19 + x11 =\u0026gt; address of y[i] in x5 lbu x6, 0(x5) // temp: x6 = y[i] add x7, x19, x10 // x5 = x19 + x11 =\u0026gt; address of x[i] in x7 sd x6, 0(x7) // x[i] = y[i] beq x6, x0, L2 // if x6 ==0 then go to L2 addi x19, x19, 1 // i = i + 1 jal x0, L1 // go to L1 L2: ld x19, 0(sp) // æ¢å¤ x19 ä»¥åŠæ ˆæŒ‡é’ˆ addi sp, sp, 8 jalr x0, 0(x1) ä¸€æ®µå¾ªç¯ä»£ç ç¼–è¯‘ä¸ºæ±‡ç¼– int A[20]; int sum = 0; for (int 3i = 0; i \u0026lt; 20; i++){ sum += A[i]; } RISC-V æ±‡ç¼–ï¼ˆ32 bit)\nadd x9, x8, x0 # x9 = \u0026amp;A[0] add x10, x0, x0 # sum add x11, x0, x0 # i addi x13,x0, 20 # 20 Loop: bge x11, x13, Done # if x11 \u0026gt; x13 go to Down(end loop) lw x12, 0(x9) # x12 = A[i] add x10, x10, x12 # sum addi x9, x9, 4 # x9 = \u0026amp;A[i+1] addi x11, x11, 1 # i++ j loop Done: é€»è¾‘æ“ä½œ and andi and x5, x6, x9 =\u0026gt; x5 = x6 \u0026amp; x9 addi x5, x6, 3 =\u0026gt; x5 = x6 \u0026amp; 3 sll ssli , å·¦ç§»(æ‰©å¤§) slli x11, x23, 2 =\u0026gt; x11 = x23 \u0026laquo; 2 0000 0010 =\u0026gt; 2 0000 1000 =\u0026gt; 8 srl srli , å³ç§»ï¼ˆç¼©å°) srli x23, x11, 2 = \u0026gt; x23 = x11 \u0026raquo; 2 0000 1000 =\u0026gt; 8 0000 0010 =\u0026gt; 2 sra srai, ç®—æ•°å³ç§» 1111 1111 1111 1111 1111 1111 1110 0111 = -25 srai x10, x10, 4 1111 1111 1111 1111 1111 1111 1111 1110 = -2 Helpful RISC-V Assmebler Features a0 - a7 æ˜¯å‚æ•°å¯„å­˜å™¨(x10 - x17ï¼Œç”¨äºå‡½æ•°è°ƒç”¨ã€‚ zero ä»£è¡¨ x0 mv rd, rs = addi rd, rs, 0 li rd, 13 = addi rd, x0, 13 nop = addi x0, x0 la a1 Lable å°† Label çš„ åœ°å€ åŠ è½½åˆ° a1 a0 - a7(x10 - x17): 8 ä¸ªå¯„å­˜å™¨ç”¨äºå‚æ•°ä¼ é€’ä»¥åŠä¸¤ä¸ªè¿”å›å€¼(a0 - a1) raï¼ˆx1ï¼‰: ä¸€ä¸ªè¿”å› address çš„å¯„å­˜å™¨ï¼Œç”¨äºè¿”å›åŸç‚¹ï¼ˆè°ƒç”¨çš„ä½ç½®ï¼‰ s0 - s1(x8 - x9) and s2 - s11 (s18 - x27): ä¿å­˜çš„å¯„å­˜å™¨ RISC-V å‡½æ•°è°ƒç”¨çš„è½¬æ¢ å¯„å­˜å™¨æ¯”å†…å­˜å¿«ï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒä»¬ jal rd, Label è·³è½¬å’Œé“¾æ¥ jal x1, 100 jalr rd, rs, imm è·³è½¬å’Œé“¾æ¥å¯„å­˜å™¨ jalr x1, 100(x5) jal Lable =\u0026gt; jal ra, Lable è°ƒç”¨å‡½æ•° jalr s1 å½“ s1 æ˜¯æ–¹æ³•æŒ‡é’ˆæ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ ä¸€æ®µå‡½æ•°è°ƒç”¨è½¬æ¢ä¸ºæ±‡ç¼– ... sum(a,b); ... int sum(int x, int y){ retrun x + y; } 1000 mv a0, s0 # x = a 1004 mv a1, s1 # y= b 1008 addi ra, zero, 1016 # 1016 is sum function 1012 j # jump to sum 1016 ... ... 2000 sum: add a0, a0, a1 2004 jr ra 1008 ~ 1012 å¯ä»¥ä½¿ç”¨ jal sum æ¥æ›¿ä»£ã€\nè°ƒç”¨å‡½æ•°çš„åŸºæœ¬æ­¥éª¤ æŠŠéœ€è¦çš„å‚æ•°æ”¾åˆ°æ–¹æ³•å¯ä»¥è®¿é—®çš„åœ°æ–¹ï¼ˆå¯„å­˜å™¨ï¼‰ è½¬ç§»æ§åˆ¶æƒç»™å‡½æ•°,ä½¿ç”¨(jal) ä¿æŒåœ°å€ï¼Œå¹¶è·³è½¬åˆ°å‡½æ•°çš„åœ°å€ è·å–å‡½æ•°æ‰§è¡Œæ‰€éœ€çš„(local)å­˜å‚¨èµ„æº æ‰§è¡Œé¢„æœŸçš„å‡½æ•° å°†è¿”å›å€¼æ”¾åœ¨è°ƒç”¨ä»£ç å¯ä»¥è®¿é—®çš„åœ°æ–¹ï¼Œå¹¶æ¢å¤æˆ‘ä»¬ä½¿ç”¨åˆ°çš„å¯„å­˜å™¨ï¼Œé‡Šæ”¾æœ¬åœ°å­˜å‚¨ å°†æ§åˆ¶å™¨è¿”å›ç»™ä¸»å¤„ç†å™¨ï¼ˆret), ä½¿ç”¨å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­çš„åœ°å€ï¼Œè¿”å›åˆ°è°ƒç”¨å®ƒçš„åœ°æ–¹ æ–¹æ³•è°ƒç”¨ç¤ºä¾‹ int leaf(int g, int h, int i, int j){ int f; f = (g + h) - (i + j); retrun f; } g,h,i,j in a0,a1,a2,a3 f in s0 temp is s1 leaf: # prologue start addi sp, sp, -8 # è…¾å‡º 8byte æ¥å­˜æ”¾çš„2ä¸ªæ•´æ•° sw s1, 4(sp) # ä¿å­˜ s1, s0 åˆ° sp ä¸­ sw s0, 0(sp) # prologue end add s0, a0, a1 # f = g + h add s1, a2, a3 # temp = i + j sub a0, s0, s1 # a0 = ï¼ˆg + h) - (i + j) # epilogue lw s0, 0(sp) # æ¢å¤ s1, s0 lw s1, 4(sp) addi sp, sp 8 jr ra sp TIP sp æ˜¯æ ˆæŒ‡é’ˆï¼Œä»å†…å­˜ç©ºé—´ çš„æœ€é¡¶éƒ¨å¼€å§‹å‘ä¸‹å¢é•¿ï¼Œåœ¨ RISC-V ä¸­ä½¿ç”¨ x2 è¿™ä¸ªå¯„å­˜å™¨ã€‚\npush æ˜¯å‡å°‘ sp çš„æŒ‡é’ˆåœ°å€ pop æ˜¯å¢åŠ  æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ç»„å­˜æ”¾åœ¨æ ˆä¸Šçš„æ•°æ®ï¼Œå®ƒä»¬æ˜¯æ ˆå¸§ï¼ˆstack frame ï¼‰ï¼Œæ ˆå¸§é€šå¸¸åŒ…å«ï¼š\nè¿”å›åœ°å€ å‚æ•° ä½¿ç”¨çš„å±€éƒ¨å˜é‡çš„ç©ºé—´ åµŒå¥—å‡½æ•°è°ƒç”¨ int sumSquare(int x,int y){ return mult(x,x) + y; } åœ¨ ra ä¸­æœ‰ä¸€ä¸ª sumSquare æƒ³è¦è·³å›çš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªå€¼ä¼šè¢«è°ƒç”¨ mult è¦†ç›–ã€‚\ncaller: è°ƒç”¨å‡½æ•°çš„äºº calleï¼š è¢«è°ƒç”¨çš„å‡½æ•° å½“è¢«è°ƒç”¨è€…ä»æ‰§è¡Œä¸­è¿”å›æ—¶ï¼Œè°ƒç”¨è€…éœ€è¦çŸ¥é“å“ªäº›å¯„å­˜å™¨å¯èƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œå“ªäº›å¯„å­˜å™¨è¢«ä¿è¯æ˜¯ä¸å˜çš„ã€‚ å¯„å­˜å™¨è§„å®šï¼š å³å“ªäº›å¯„å­˜å™¨åœ¨ç¨‹åºè°ƒç”¨(jal) åå°†è¢«å–æ¶ˆç¼“å­˜ ï¼Œå“ªäº›å¯ä»¥è¢«æ”¹å˜ã€‚ å³æœ‰ä¸€äº›å¯„å­˜å™¨æ˜¯æ˜“å¤±çš„(temp),ä¸€äº›æ˜¯è¦ä¿å­˜çš„ï¼ˆè°ƒç”¨è€…éœ€è¦æ¢å¤å®ƒä»¬åŸæ¥çš„å€¼ï¼‰ã€‚ è¿™ä¼˜åŒ–äº†æ¯æ¬¡è¿›å…¥æ ˆå¸§çš„å¯„å­˜å™¨çš„æ•°é‡ åˆ†ç±»: è·¨å‡½æ•°è°ƒç”¨ä¿ç•™: sp, gp, tp s0 - s11 (s0 is also fp) ä¸ä¿ç•™: å‚æ•°å¯„å­˜å™¨ä»¥åŠè¿”å›å¯„å­˜å™¨ï¼š a0 - a7, ra temp å¯„å­˜å™¨: t0 - t6 ä¸Šé¢ä»£ç çš„ RISC-V\nx in a1, y in a1\nsumSquare: addi sp, sp -8 sw ra, 4(sp) // save retrun address to sp sw a1, 0(sp) // save s1 to y mv a1, a0 // y = x =\u0026gt; mult(x,x) jal mult // call mult lw a1, 0(sp) // get y from sp add a0, a0, a1 // mult() + y lw ra, 4(sp) // get retrun address from sp addi sp, sp, 8 jr ra RISC-V å¯„å­˜å™¨åç§° RISC-V æ–¹æ³•è°ƒç”¨å¥—è·¯ matmul: # å‹æ ˆï¼Œè…¾å‡ºç©ºé—´ä¿å­˜æˆ‘ä»¬è¦ä½¿ç”¨çš„å‡ ä¸ª s å¯„å­˜å™¨ addi sp sp -36 sw ra 0(sp) sw s0 4(sp) sw s1 8(sp) sw s2 12(sp) sw s3 16(sp) sw s4 20(sp) sw s5 24(sp) sw s6 28(sp) sw s7 32(sp) body: # xxx xxx end: # æ¢å¤å¯„å­˜å™¨çš„å€¼ lw ra 0(sp) lw s0 4(sp) lw s1 8(sp) lw s2 12(sp) lw s3 16(sp) lw s4 20(sp) lw s5 24(sp) lw s6 28(sp) lw s7 32(sp) addi sp sp 36 ret RISC-V æŒ‡ä»¤äºŒè¿›åˆ¶çš„è¡¨ç¤º R æ ¼å¼å¸ƒå±€ ç”¨äºç®—æœ¯å’Œé€»è¾‘è¿ç®—çš„æŒ‡ä»¤\nopcodeï¼Œfunct3, funct7 : å°†å‘Šè¯‰æˆ‘ä»¬æ˜¯å¦è¦æ‰§è¡ŒåŠ ï¼Œå‡ï¼Œå·¦ç§»ï¼Œå¼‚æˆ–ç­‰æ“ä½œã€‚ R-format çš„ opcode å›ºå®šä¸º 0110011 ä¸€ä¸ª add æ“ä½œï¼š add x18 x19 x10 =\u0026gt; x18 = x19 + x10 0000000 01010 10011 000 10010 0110011 rs2 = x19, rs1 = x10, rd = x18 I æ ¼å¼å¸ƒå±€ å¤„ç†ç«‹å³æ•°ï¼Œæ¯”å¦‚addi rd rs1, imm =\u0026gt; addi a0 a0 1\nimm çš„èŒƒå›´æ˜¯ -2084 ï½ 2047 addi x15 x1 -50 RISC-V Loads load æŒ‡ä»¤ä¹Ÿæ˜¯ I ç±»å‹çš„ã€‚\nlw x14 8(x2) S æ ¼å¼å¸ƒå±€ ","permalink":"https://fzdwx.github.io/posts/2022-12-10-risc-v/","summary":"Resource \u0026nbsp;RISC-V Green Card \u0026nbsp;RISC-V Call convertion \u0026nbsp;P\u0026amp;H(RISC-V) åœ¨æ±‡ç¼–è¯­è¨€ä¸­æ²¡æœ‰å˜é‡è¿™ä¸ªæ¦‚å¿µï¼Œæ±‡ç¼–è¯­è¨€é€šå¸¸æ“ä½œçš„æ˜¯å¯„å­˜å™¨ã€‚ç®—æœ¯æŒ‡ä»¤çš„æ“ä½œæ•°å¿…é¡»å–è‡ªå¯„å­˜å™¨ï¼Œå†…å»ºäºç¡¬ä»¶çš„ç‰¹æ®Šä½ç½®(CPUå†…ï¼Ÿ)ã€‚\nTIP å¯„å­˜å™¨ï¼ˆRegisterï¼‰æ˜¯\u0026nbsp;ä¸­å¤®å¤„ç†å™¨ å†…ç”¨æ¥æš‚å­˜æŒ‡ä»¤ã€\u0026nbsp;æ•°æ® å’Œ\u0026nbsp;åœ°å€ çš„\u0026nbsp;ç”µè„‘å­˜å‚¨å™¨ ã€‚å¯„å­˜å™¨çš„å­˜è´®å®¹é‡æœ‰é™ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚åœ¨\u0026nbsp;è®¡ç®—æœºä½“ç³»ç»“æ„ é‡Œï¼Œå¯„å­˜å™¨å­˜å‚¨åœ¨å·²çŸ¥æ—¶é—´ç‚¹æ‰€ä½œè®¡ç®—çš„ä¸­é—´ç»“æœï¼Œé€šè¿‡å¿«é€Ÿåœ°è®¿é—®æ•°æ®æ¥åŠ é€Ÿ\u0026nbsp;è®¡ç®—æœºç¨‹åº çš„æ‰§è¡Œã€‚ RISC-V Card RISC-V æ“ä½œæ•° å¦‚æœå¯„å­˜å™¨çš„å¤§å°æ˜¯ 64ä½ åˆ™ç§°ä¸ºåŒå­—ï¼Œ32ä½ åˆ™æ˜¯å•å­—ã€‚ x0 è¢«ç¡¬è¿æ¥åˆ° 0 add x3, x4, x0 =\u0026gt; x3 = x4 (x0 is hard-wired to value 0) æ±‡ç¼–æŒ‡ä»¤ å­˜å‚¨æ“ä½œæ•° TIP å°†æ•°æ®ä»å†…å­˜å¤åˆ¶åˆ°å¯„å­˜å™¨çš„æ•°æ®ä¼ è¾“æŒ‡ä»¤ç§°ä¸º è½½å…¥æŒ‡ä»¤(load)ã€‚åœ¨ RISC-V ä¸­æŒ‡ä»¤æ˜¯ ld,è¡¨ç¤ºå–åŒå­—ã€‚ ä¸€ä¸ªä»æ•°ç»„ä¸­å–å€¼çš„Cç¨‹åºï¼Œå†™å‡ºæ±‡ç¼–ä»£ç  g = h + A[8]; A æ˜¯ä¸€ä¸ª 100 ä¸ªåŒå­—ç»„æˆçš„æ•°ç»„ï¼Œg, håˆ†åˆ«å­˜å‚¨åœ¨ x20, x21 ä¸­ï¼Œæ•°ç»„èµ·å§‹åœ°å€æˆ–åŸºå€ä½äº x22 ä¸­ã€‚\nld x9, 8(x22) // x9 = A[8] add x21, x20, x9; // x21 = x20 + x9 å­˜æ”¾åŸºå€çš„å¯„å­˜å™¨(x22)è¢«ç§°ä¸ºåŸºå€å¯„å­˜å™¨, æ•°æ®ä¼ è¾“æŒ‡ä»¤ä¸­çš„ 8 ç§°ä¸ºåç§»é‡ã€‚","title":"RISC-V ç®€ä»‹"},{"content":"è¡¨ç¤ºæ–¹æ³• $(-1)^{S}\\times(1.xxx\u0026hellip;x_{2}\\times2^{{yyy\u0026hellip;y}_{2}})$ æŒ‡æ•°è¡¨ç¤ºY,å°¾æ•°è¡¨ç¤ºX å•ç²¾åº¦çš„è¡¨ç¤ºæ–¹æ³• åŒç²¾åº¦çš„è¡¨ç¤ºæ–¹æ³• å…¬å¼:\n$(-1)^{S}\\times{F}\\times{2^{E}}$ F æ˜¯å°¾æ•°è¡¨ç¤ºçš„å€¼ï¼ŒE æ˜¯æŒ‡æ•°è¡¨ç¤ºçš„å€¼ï¼ŒS å°±å¯¹åº”æ•°çš„ç¬¦å·ä½, 1 è¡¨ç¤ºè´Ÿæ•°ã€‚ ç§»ç è¡¨ç¤ºæ³• TIP æœ€ç†æƒ³çš„è¡¨ç¤ºæ³•æ˜¯å°†æœ€å°çš„è´ŸæŒ‡æ•°è¡¨ç¤ºä¸º 00\u0026hellip;002ï¼Œ å°†æœ€å¤§çš„æ­£æŒ‡æ•°è¡¨ç¤ºä¸º 11\u0026hellip;112ã€‚ä»ç§»ç è¡¨ç¤ºçš„æ•°å‡å»åŸæ•°å°±å¯ä»¥å¾—åˆ°ç›¸åº”çš„åç§»å€¼ï¼Œä»è€Œç”±æ— ç¬¦å·çš„ç§»ç å¯å¾—åˆ°çœŸå®çš„å€¼ã€‚ IEEE 754è§„å®š:\nå•ç²¾åº¦çš„åç§»å€¼ä¸º 127 æŒ‡æ•°ä¸º -1 è¡¨ç¤º -1 + 12710 = 12610 = 011111102 +1 = 1 + 12710 = 12810 = 100000002 æœ€å¤§æŒ‡æ•°ä¸º127 æœ€å°ä¸º-126 åŒç²¾åº¦çš„æŒ‡æ•°åç§»å€¼ä¸º 1023 1023 -1022 å¸¦åç§»å€¼çš„æŒ‡æ•°æ„å‘³ç€ä¸€ä¸ªç”±æµ®ç‚¹æ•°è¡¨ç¤ºçš„å€¼å®é™…ä¸Šæ˜¯:\n$(-1)^{S}\\times{(1 + æœ‰æ•ˆä½æ•°)}\\times{2^{æŒ‡æ•° - åç§»å€¼}}$ è¡¨ç¤º - 0.7510 åˆ†æ•°è¡¨ç¤ºä¸ºï¼š\n(-3/4)10 = (-3/22)10 äºŒè¿›åˆ¶å°æ•°è¡¨ç¤º:\n(-11/22)10 = -0.112 -11 å³ç§» 2 ä½ ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º:\n-0.112 x 20 ç”¨è§„æ ¼åŒ–çš„ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º:\n-1.12 x 2-1 ç”±ä¸Šé¢çš„å…¬å¼çš„åˆ°ï¼š\n$(-1)^{S}\\times{(1 + æœ‰æ•ˆä½æ•°)}\\times{2^{æŒ‡æ•° - åç§»å€¼}}$ æœ‰æ•ˆä½æ•°: 0.12 1 = (- 1)S =\u0026gt; S = 12 æŒ‡æ•° - 127 = -1 =\u0026gt; æŒ‡æ•° = 12610 å•ç²¾åº¦å¯ä»¥è¡¨ç¤º:\nåŒç²¾åº¦è¡¨ç¤º:\nè¡¨ç¤ºäºŒè¿›åˆ¶æµ®ç‚¹æ•°ä¸ºåè¿›åˆ¶æµ®ç‚¹æ•° S = 1 æœ‰æ•ˆä½æ•°: 0.012 =\u0026gt; 1 x 2-2ï¼ˆå³ç§»ä¸¤ä½ï¼‰ = 0.25 æŒ‡æ•°: 129 æ ¹æ®å…¬å¼:\n$(-1)^{1}\\times{(1 + 0.25)}\\times{2^{129 - 127}}$\n= $-1\\times1.25\\times2^2$\n= $-1.25\\times4$\n= $-5$\næµ®ç‚¹åŠ æ³•ä¸æµ®ç‚¹ä¹˜æ³•å¯ä»¥çœ‹ P\u0026amp;H 3.5.4~3.5.5 \u0026nbsp;https://github.com/fzdwx/fzdwx.github.io/releases/download/v1.0/p.h.pdf RISC-V ä¸­çš„æµ®ç‚¹æŒ‡ä»¤ ç®—æœ¯ åŠ æ³•: fadd.s fadd.d fadd.s f0, f1, f2 =\u0026gt; f0 = f1 + f2 å‡æ³•ï¼šfsub fsub fsub.s f0, f1, f2 =\u0026gt; f0 = f1 - f2 ä¹˜æ³•: fmul fmul.s f0, f1, f2 =\u0026gt; f0 = f1 * f2 é™¤æ³•: fdiv fdivs f0, f1, f2 =\u0026gt; f0 = f1 / f2 å¹³æ–¹æ ¹: fsqrt fsqrt.s f0, f1 =\u0026gt; $f0 = \\sqrt{f1}$ æ¯”è¾ƒ ç›¸ç­‰: feq feq.s x5, f0, f1 =\u0026gt; x5 = 1 if f0 == f1, else 0 å°äº: flt flt.s x5, f0, f1 =\u0026gt; x5 = 1 if f0 \u0026lt; f1, else 0 å°äºæˆ–ç­‰äº: fle fle.s x5, f0, f1 =\u0026gt; x5 = 1 if f0 \u0026lt;= f1, else 0 å¦‚æœæ¯”è¾ƒç»“æœä¸º çœŸï¼Œåˆ™å°†æ•´ç‚¹å¯„å­˜å™¨è®¾ç½® 1,å¦åˆ™ä¸º 0 æ‰€ä»¥å¯ä»¥ä½¿ç”¨æ•´æ•°åˆ†æ”¯æŒ‡ä»¤ beq å’Œ bne æ¥æ¯”è¾ƒç»“æœå¹¶è¿›è¡Œåˆ†æ”¯ å–å­˜æŒ‡ä»¤: åŒï¼šfld fsd fld f0, 8(x5) =\u0026gt; f0 = Memory[x5 + 8] fsd f0, 8(x5) =\u0026gt; Memory[x5 +8] = f0 å•:flw fsw æµ®ç‚¹æ•°æ®ä¼ è¾“æŒ‡ä»¤çš„åŸºå€å¯„å­˜å™¨ä»ä¸ºæ•´ç‚¹å¯„å­˜å™¨ åœ¨ RISC-Vä¸­æœ‰ç‹¬ç«‹çš„æµ®ç‚¹å¯„å­˜å™¨: f0 ~ f31 ä¸Šè¿°æŒ‡ä»¤éƒ½æœ‰å•åŒç²¾åº¦ç‰ˆæœ¬ï¼Œå•ç²¾åº¦ä»¥ .s ç»“å°¾ï¼ŒåŒç²¾åº¦ä»¥ .d ç»“å°¾\nä¸€ä¸ªç¤ºä¾‹: ä»å†…å­˜ä¸­å–å‡ºä¸¤ä¸ªå•ç²¾åº¦æ•°ï¼Œç›¸åŠ ï¼Œç„¶åå°†æ€»å’Œå­˜å…¥å†…å­˜ä¸­\nflw f0, 0(x10) // åŠ è½½ä¸€ä¸ª 32bit çš„æ•°åˆ° f0 flw f1, 4(x10) // åŠ è½½ä¸€ä¸ª 32bit çš„æ•°åˆ° f1 fadd.s f2, f0, f1 // f2 = f0 + f1 fsw f2, 8(x10) // ä¿å­˜æ¥è‡ª f2 çš„ 32bit çš„æ•° TIP ç‹¬ç«‹æµ®ç‚¹å¯„å­˜å™¨çš„å¥½å¤„: åœ¨ä¸éœ€è¦å¢åŠ æŒ‡ä»¤ä½çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å€å¢çš„å¯„å­˜å™¨æ•°ç›®ï¼ŒåŒæ—¶å› ä¸ºæœ‰ç‹¬ç«‹çš„æ•´ç‚¹å’Œæµ®ç‚¹å¯„å­˜å™¨ï¼Œå¯ä»¥è·å¾—å€å¢çš„å¯„å­˜å™¨å¸¦å®½ï¼Œå¹¶ä¸”è¿˜èƒ½ä¸ºæµ®ç‚¹å®šåˆ¶å¯„å­˜å™¨ã€‚\nä¾‹å¦‚ä¸€äº›å¯„å­˜å™¨ä¸­æ‰€æœ‰ç±»å‹çš„æ“ä½œæ•°è½¬æ¢ä¸ºå•ä¸€çš„å†…éƒ¨æ ¼å¼ã€‚\nå°†ä¸€æ®µ C ä»£ç è½¬æ¢æˆ RISC-V çš„çš„æ±‡ç¼–ä»£ç  float f2c(float qwe){ retrun ((5.0f / 9.0f) * (qwe - 32.0f)); } å‡è®¾å‚æ•° qwe ä¼ å…¥åˆ°å¯„å­˜å™¨ f10 ä¸­ï¼Œä¸”ç»“æœä¹Ÿå­˜å…¥ f10ä¸­:\nf2c: flw f0, const5(x3) // f0 = 5.0f flw f1, const9(x3) // f1 = 9.0f fdiv.s f0, f0, f1 // f0 = 5.0f / 9.0f flw f1, const32(x3) // f1 = 32.0f fsub.s f10, f10, f1 // f10 = qwe - 32.0f fmul.s f10, f0, f10 // f10 = ((5.0f / 9.0f) * (qwe - 32.0f)); jalr x0, 0(x1) // retrun å‡è®¾é€šè¿‡ x3 è®¿é—®ä¸Šé¢3ä¸ªå¸¸é‡æµ®ç‚¹æ•°\nå°†äºŒç»´çŸ©é˜µçš„Cä»£ç è½¬æ¢ä¸ºRISC-Vçš„æ±‡ç¼–ä»£ç  $C=C+A\\times{B}$ å‡è®¾A, B, Céƒ½æ˜¯ 32 x 32 çš„äºŒç»´çŸ©é˜µ\nvoid mm(double c[][], double a[][], double b[][]){ size_t i,j,k; for(i=0;i\u0026lt;32;i=i+1){ for(j=0;j\u0026lt;32;j=j+1){ for(k=0;k\u0026lt;32;k=k+1){ c[i][j] = c[i][j] + a[i][k] * b[k][j]; } } } } æ–¹æ³•å‚æ•°åˆ†åˆ«å­˜æ”¾åœ¨ x10, x11, x12; i, j, k åˆ†åˆ«å­˜æ”¾åœ¨x5, x6, x7ã€‚\nmm:... li x28, 32 // x28 = 32 li x5, 0 // i = 0; L1:\tli x6, 0 // j = 0; L2:\tli x7, 0 // k = 0; slli x30, x5, 5 // x30 = i * 2 ^ 5(size of row of c) add x30, x30, x6 // x30 = i * size(row) + j slli x30, x30, 3 // x30 = byte offset of [i][j] 8ä¸ªå­—èŠ‚,å·¦ç§»3ä½ add x30, x10, x30 // x30 = byte address of c[i][j] fld f0, 0(x30) // f0 = 8 bytes of c[i][j] L3: slli x29, x7, 5 // x29 = k * 2 ^ 5 add x29, x29, x6 slli x29, x29, 3 add x29, x12, x29 fld f1, 0(x29) // f1 = 8 bytes of b[k][j] slli x29,x5 5 // x29 = i * 2 ^ 5 add x29, x29, x7 slli x29, x29, 3 add x29, x11, x29 fld f2, 0(x29) // f2 = a[i][k] fmul.d f1, f2, f1 // f1 = a[i][k] * b[k][j] fadd.d f0, f0 ,f1 // f0 = c[i][j] + a[i][k] * b[k][j] addi x7, x7, 1 // k = k + 1 bltu x7, x28, L3 // if (k \u0026lt; 32) go to L3 fsd f0, 0(x30) // c[i][j] = f0 addi x6, x6, 1 // j = j + 1 bltu x6, x28, L2 // if (j \u0026lt; 32) go to L2 addi x5, x5, 1 // i = i + 1 bltu x5, x28, 1 // if (i \u0026lt; 32) go to L1 ä¸€äº›Cè¯­è¨€å’ŒJavaçš„æ•°æ®ç±»å‹ã€æ•°æ®ä¼ è¾“æŒ‡ä»¤ï¼š äºŒè¿›åˆ¶æµ®ç‚¹æ•°è¡¨ç¤ºå›¾ ","permalink":"https://fzdwx.github.io/posts/2022-12-09-float-rep/","summary":"è¡¨ç¤ºæ–¹æ³• $(-1)^{S}\\times(1.xxx\u0026hellip;x_{2}\\times2^{{yyy\u0026hellip;y}_{2}})$ æŒ‡æ•°è¡¨ç¤ºY,å°¾æ•°è¡¨ç¤ºX å•ç²¾åº¦çš„è¡¨ç¤ºæ–¹æ³• åŒç²¾åº¦çš„è¡¨ç¤ºæ–¹æ³• å…¬å¼:\n$(-1)^{S}\\times{F}\\times{2^{E}}$ F æ˜¯å°¾æ•°è¡¨ç¤ºçš„å€¼ï¼ŒE æ˜¯æŒ‡æ•°è¡¨ç¤ºçš„å€¼ï¼ŒS å°±å¯¹åº”æ•°çš„ç¬¦å·ä½, 1 è¡¨ç¤ºè´Ÿæ•°ã€‚ ç§»ç è¡¨ç¤ºæ³• TIP æœ€ç†æƒ³çš„è¡¨ç¤ºæ³•æ˜¯å°†æœ€å°çš„è´ŸæŒ‡æ•°è¡¨ç¤ºä¸º 00\u0026hellip;002ï¼Œ å°†æœ€å¤§çš„æ­£æŒ‡æ•°è¡¨ç¤ºä¸º 11\u0026hellip;112ã€‚ä»ç§»ç è¡¨ç¤ºçš„æ•°å‡å»åŸæ•°å°±å¯ä»¥å¾—åˆ°ç›¸åº”çš„åç§»å€¼ï¼Œä»è€Œç”±æ— ç¬¦å·çš„ç§»ç å¯å¾—åˆ°çœŸå®çš„å€¼ã€‚ IEEE 754è§„å®š:\nå•ç²¾åº¦çš„åç§»å€¼ä¸º 127 æŒ‡æ•°ä¸º -1 è¡¨ç¤º -1 + 12710 = 12610 = 011111102 +1 = 1 + 12710 = 12810 = 100000002 æœ€å¤§æŒ‡æ•°ä¸º127 æœ€å°ä¸º-126 åŒç²¾åº¦çš„æŒ‡æ•°åç§»å€¼ä¸º 1023 1023 -1022 å¸¦åç§»å€¼çš„æŒ‡æ•°æ„å‘³ç€ä¸€ä¸ªç”±æµ®ç‚¹æ•°è¡¨ç¤ºçš„å€¼å®é™…ä¸Šæ˜¯:\n$(-1)^{S}\\times{(1 + æœ‰æ•ˆä½æ•°)}\\times{2^{æŒ‡æ•° - åç§»å€¼}}$ è¡¨ç¤º - 0.7510 åˆ†æ•°è¡¨ç¤ºä¸ºï¼š\n(-3/4)10 = (-3/22)10 äºŒè¿›åˆ¶å°æ•°è¡¨ç¤º:\n(-11/22)10 = -0.112 -11 å³ç§» 2 ä½ ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º:","title":"æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„è¡¨ç¤º"},{"content":"åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æ˜¯ç”¨çš„å›¾ç‰‡æ¥ä½œä¸ºæ¡ˆä¾‹çš„ï¼Œé¦–å…ˆé€šè¿‡ä»‹ç»äº†ä¸€ç§å›¾ç‰‡çš„ç¼–ç å½¢å¼, ppm:\nç¬¬ä¸€è¡Œè¡¨ç¤ºæ˜¯ä»€ä¹ˆæ ¼å¼çš„ ppm æ–‡ä»¶ ç¬¬äºŒè¡Œè¡¨ç¤ºå®½å’Œé«˜ ç¬¬ä¸‰è¡Œè¡¨ç¤ºé¢œè‰²èŒƒå›´ åé¢çš„å°±æ˜¯å„ä¸ªåƒç´ çš„RGBå€¼ P3 2 2 255 29 83 36 45 64 57 188 229 201 123 162 184 ä»–æ˜¯è¿™ä¹ˆä»‹ç»çš„:\næˆ‘ä»¬å°†æ¢ç´¢ä¸€ç§éšè—æ¶ˆæ¯çš„æ–¹æ³•ã€‚è™½ç„¶å¤§å¤šæ•°å›¾åƒçš„æ¯ä¸ª RGB é€šé“éƒ½æœ‰ 8 ä½æ•°æ®ï¼Œä½†äººçœ¼æ— æ³•è½»æ˜“çœ‹å‡ºå 4 ä½çš„å·®å¼‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¿¡æ¯éšè—åœ¨å›¾åƒçš„åº•éƒ¨ä½ä¸­ã€‚æˆ‘ä»¬é€šè¿‡ä¿®æ”¹æ¯ä¸ªåƒç´  B å€¼çš„æœ€ä½æœ‰æ•ˆä½, å¦‚æœæœ€åä¸€ä½æ˜¯ 0ï¼Œåˆ™æŠŠæ•´ä¸ªåƒç´ è½¬æ¢ä¸ºé»‘è‰²(255,255,255),å¦‚æœæœ€åä¸€ä½æ˜¯ 1,åˆ™è½¬æ¢ä¸ºç™½è‰²(0,0,0)ã€‚\nå…³é”®å°±æ˜¯ï¼š æ¯ä¸ª RGB é€šé“éƒ½æœ‰ 8 ä½æ•°æ®ï¼Œä½†äººçœ¼æ— æ³•è½»æ˜“çœ‹å‡ºå 4 ä½çš„å·®å¼‚ï¼Œæ‰€ä»¥è¿™å°±ç»™äº†æˆ‘ä»¬æ“ä½œçš„ç©ºé—´ã€‚\né¡¹ç›®çš„ç»“æœ ","permalink":"https://fzdwx.github.io/posts/2022-12-07-steganography/","summary":"æœ€è¿‘åœ¨è·Ÿ cs61cï¼Œç¬¬ä¸€ä¸ª project ä¸­ä»‹ç»äº†éšå†™æœ¯ï¼Œå¤§æ„å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯\u003ccode\u003e123\u003c/code\u003e,åœ¨ç»è¿‡ç‰¹å®šçš„ç¼–ç è½¬æ¢åæˆäº†\u003ccode\u003e456\u003c/code\u003eã€‚","title":"éšå†™æœ¯"},{"content":" å‰æ®µæ—¶é—´ç©è¿‡å‡ å¤©çš„ obsidianï¼Œç”±äºå¤ªè´¹ç¥äº†æ‰€ä»¥è½¬å‘äº† hugo ,ç„¶åç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨å†™ md ï¼Œä½“éªŒè¿˜æ˜¯ä¸å¤ªå¥½ï¼Œç„¶åæˆ‘æƒ³èµ·è¿˜æœ‰ obsidian è¿™ä¸ªè½¯ä»¶ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªæ’ä»¶ã€‚\nå½“å‰ä¸»è¦åŠŸèƒ½ï¼š\nå¼€ä¸€ä¸ª custome iframe é¢„è§ˆ hugo (via \u0026nbsp;https://github.com/Ellpeck/ObsidianCustomFrames ) åå°å¯åŠ¨ hugo server å½“å‰è¿˜æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå­è¿›ç¨‹( hugo è¿›ç¨‹)åœ¨ç¨‹åºæ¨å‡ºæ—¶ä¸ä¼šå…³é—­ã€‚ é‡åˆ°çš„é—®é¢˜:\nè·å– obsidian æ‰“å¼€çš„ç›®å½•ä¸çŸ¥é“ api( cwd ),åæ issue çŸ¥é“äº†è·å–æ–¹æ³•ã€‚ ä»“åº“: \u0026nbsp;https://github.com/fzdwx/hugo-preview-obsidian è¿è¡Œå›¾ä¾‹ï¼Œå·¦ç¼–è¾‘åŒºåŸŸï¼Œå³é¢„è§ˆåŒºåŸŸ æ›´æ–° æ”¯æŒè‡ªå®šä¹‰ exec command, ä¾‹å¦‚å¯ä»¥ç”¨æ¥å¯åŠ¨ç»ˆç«¯ã€‚ ä½¿ç”¨ ALT+F12 å”¤èµ·ã€‚ ç”±äºæˆ‘ä½¿ç”¨ git è¿›è¡ŒåŒæ­¥ï¼Œæ—¶å¸¸éœ€è¦æ‰“å¼€ç»ˆç«¯å¹¶ä¸”è¿›å…¥åˆ°å…·ä½“çš„ç›®å½•ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¿«é€Ÿå¯åŠ¨ç»ˆç«¯åœ¨å½“å‰çš„ç›®å½•ä¸‹çš„å‘½ä»¤ï¼š wezterm start --class float --cwd ${cwd}ã€‚ ç›®å‰åªæä¾›äº† cwd è¿™ä¸ªå˜é‡ï¼Œå®ƒä¼šæ›¿æ¢ä¸ºå½“å‰ç¬”è®°çš„è·¯å¾„ã€‚ è‡ªå®šä¹‰ command é…ç½®ç¤ºä¾‹ ","permalink":"https://fzdwx.github.io/posts/2022-12-04-hugo-preview-obsidian/","summary":"å‰æ®µæ—¶é—´ç©è¿‡å‡ å¤©çš„ obsidianï¼Œç”±äºå¤ªè´¹ç¥äº†æ‰€ä»¥è½¬å‘äº† hugo ,ç„¶åç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨å†™ md ï¼Œä½“éªŒè¿˜æ˜¯ä¸å¤ªå¥½ï¼Œç„¶åæˆ‘æƒ³èµ·è¿˜æœ‰ obsidian è¿™ä¸ªè½¯ä»¶ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªæ’ä»¶ã€‚","title":"åœ¨ Obsidian ä¸­é¢„è§ˆ hugo "},{"content":" \u0026nbsp;ã€Šæ·±å…¥è§£æCSSã€‹ \u0026nbsp;ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹ã€‹ \u0026nbsp;ã€ŠCSAPPã€‹ \u0026nbsp;ã€Šå›¾è§£HThe.C.Programming.Language.pdfTTPã€‹ \u0026nbsp;ã€Šé«˜æ€§èƒ½MySQLã€‹ \u0026nbsp;ã€Šè®¡ç®—æœºç»„æˆä¸è®¾è®¡ï¼šç¡¬ä»¶_è½¯ä»¶æ¥å£ã€‹(P\u0026amp;H) \u0026nbsp;ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€ã€‹(K\u0026amp;R) \u0026nbsp;https://www.aliyundrive.com/s/AECNXPqn8WA dBeJ \u0026nbsp;https://xmsoushu.com/#/ \u0026nbsp;https://zlib.zu1k.com/ ","permalink":"https://fzdwx.github.io/notes/16/","summary":" \u0026nbsp;ã€Šæ·±å…¥è§£æCSSã€‹ \u0026nbsp;ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹ã€‹ \u0026nbsp;ã€ŠCSAPPã€‹ \u0026nbsp;ã€Šå›¾è§£HThe.C.Programming.Language.pdfTTPã€‹ \u0026nbsp;ã€Šé«˜æ€§èƒ½MySQLã€‹ \u0026nbsp;ã€Šè®¡ç®—æœºç»„æˆä¸è®¾è®¡ï¼šç¡¬ä»¶_è½¯ä»¶æ¥å£ã€‹(P\u0026amp;H) \u0026nbsp;ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€ã€‹(K\u0026amp;R) \u0026nbsp;https://www.aliyundrive.com/s/AECNXPqn8WA dBeJ \u0026nbsp;https://xmsoushu.com/#/ \u0026nbsp;https://zlib.zu1k.com/ ","title":"ğŸ“‘  ä¹¦å•"},{"content":" bit å¯ä»¥è¡¨ç¤ºä»»ä½•äº‹ç‰©\nä¾‹å¦‚è¡¨ç¤º26ä¸ªå­—ç¬¦: 5 bits(2^5 = 32)\nBinary,Decimal,Hex Decimal åè¿›åˆ¶ç®€å•çš„ä»‹ç»ä»¥åŠç»„æˆ Binary (to Decimal) äºŒè¿›åˆ¶çš„ä»‹ç»ä»¥åŠè½¬æ¢åˆ°åè¿›åˆ¶ Hexadecimal (to Decimal) åå…­è‡³è¿›åˆ¶çš„ä»‹ç»ä»¥åŠè½¬æ¢åˆ°åè¿›åˆ¶ Convert è¿›åˆ¶è½¬æ¢\nConvert from Decimal to Binary 13è½¬æ¢åˆ°äºŒè¿›åˆ¶ Convert from Decimal to Hexadecimal 165è½¬æ¢åˆ°åå…­è¿›åˆ¶ Convert Binary \u0026lt;\u0026ndash;\u0026gt; Hexadecimal ä¸€å¼ éå¸¸æœ‰ç”¨çš„å¯¹ç…§å›¾ Binary -\u0026gt; Hex å‘å·¦å¡«å……å®Œæ•´çš„4ä½æ•°: 0b11110 -\u0026gt; ob00011110\nç„¶åæ ¹æ®ä¸Šå›¾è¿›è¡Œè½¬æ¢æœ€åå¾—åˆ° 1E Hex -\u0026gt; Binary è½¬æ¢0xA87 -\u0026gt; 0b101010000111\nNumber Representation Overflow TIP æ¯”å¦‚ add(or -,*,/)çš„ç»“æœä¸èƒ½ç”±å·²ç»å›ºå®šçš„ bit è¡¨ç¤ºåˆ™ç§°ä¸º overflow. ä¾‹å¦‚0b1010(10) + 0b0111(7) = 0b10001(17),è¿™ä¸ªç»“æœå°±è¶…è¿‡äº† 4 ä½æ•°\n5 bitsçš„æ— ç¬¦å·çš„ overflow ç¤ºæ„å›¾ï¼Œå¦‚æœ11111åœ¨åŠ 1å°±å›åˆ°äº†00000ï¼ŒåŒæ ·å¦‚æœ00000å‡å»1å›åˆ°11111ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½æ˜¯overflow Negative Number TIP æ­£æ•°å‰å¯¼ä¸º0,è´Ÿæ•°å‰å¯¼ä¸º1. N = 5 2N-1éè´Ÿæ•° 2N-1è´Ÿæ•° 1ä¸ª0 1ä¸ªç¬¦å·ä½ï¼Œ4ä¸ªæœ‰æ•ˆçš„æ•°å­—ä½ è¡¥ç å…¬å¼ å¯ä»¥åŒä½æ•°ä¹˜ä»¥2çš„å¹‚æ¥è¡¨ç¤ºæ­£æ•°å’Œè´Ÿæ•° d31x-(231)+d30x-(230)+..+d2 x 22 + d1 x 21 + d0 x 20 1101 -\u0026gt; 1x-2^3+1x2^2+0x2^1+1x2^0=-8+4+0+1=-3 å¯ä»¥å…ˆç¿»è½¬ bit ç„¶ååŠ 1 1101 0010 0011 -\u0026gt; 1101 0011 1101 ","permalink":"https://fzdwx.github.io/posts/2022-11-22-number/","summary":"bit å¯ä»¥è¡¨ç¤ºä»»ä½•äº‹ç‰©\nä¾‹å¦‚è¡¨ç¤º26ä¸ªå­—ç¬¦: 5 bits(2^5 = 32)\nBinary,Decimal,Hex Decimal åè¿›åˆ¶ç®€å•çš„ä»‹ç»ä»¥åŠç»„æˆ Binary (to Decimal) äºŒè¿›åˆ¶çš„ä»‹ç»ä»¥åŠè½¬æ¢åˆ°åè¿›åˆ¶ Hexadecimal (to Decimal) åå…­è‡³è¿›åˆ¶çš„ä»‹ç»ä»¥åŠè½¬æ¢åˆ°åè¿›åˆ¶ Convert è¿›åˆ¶è½¬æ¢\nConvert from Decimal to Binary 13è½¬æ¢åˆ°äºŒè¿›åˆ¶ Convert from Decimal to Hexadecimal 165è½¬æ¢åˆ°åå…­è¿›åˆ¶ Convert Binary \u0026lt;\u0026ndash;\u0026gt; Hexadecimal ä¸€å¼ éå¸¸æœ‰ç”¨çš„å¯¹ç…§å›¾ Binary -\u0026gt; Hex å‘å·¦å¡«å……å®Œæ•´çš„4ä½æ•°: 0b11110 -\u0026gt; ob00011110\nç„¶åæ ¹æ®ä¸Šå›¾è¿›è¡Œè½¬æ¢æœ€åå¾—åˆ° 1E Hex -\u0026gt; Binary è½¬æ¢0xA87 -\u0026gt; 0b101010000111\nNumber Representation Overflow TIP æ¯”å¦‚ add(or -,*,/)çš„ç»“æœä¸èƒ½ç”±å·²ç»å›ºå®šçš„ bit è¡¨ç¤ºåˆ™ç§°ä¸º overflow. ä¾‹å¦‚0b1010(10) + 0b0111(7) = 0b10001(17),è¿™ä¸ªç»“æœå°±è¶…è¿‡äº† 4 ä½æ•°","title":"Number Representation"},{"content":"èµ„æº:\n\u0026nbsp;https://regexlearn.com/zh-cn/cheatsheet \u0026nbsp;https://regexlearn.com/zh-cn/playground é€ŸæŸ¥è¡¨ åŒ¹é…ä»»æ„å­—ç¬¦: /./g bar ber bir bor bur å­—ç¬¦é›†: [abc] /b[aeiou]r/g =\u0026gt; bar bir ber bor bur å°†å¯é€‰çš„å­—ç¬¦æ”¾å…¥[]ä¸­ å¦å®šå­—ç¬¦é›†: [^abc] /b[^eo]r/g =\u0026gt; bar ber bir bor bur åœ¨[]ä¸­çš„^è¾“å…¥è¦æ’é™¤çš„å­—ç¬¦ å­—æ¯èŒƒå›´: [a-z] abcdefghijklmnopqrstuvwxyz /[e-o]/g =\u0026gt;abcdefghijklmnopqrstuvwxyz å°†èµ·å§‹å­—æ¯å’Œç»“æŸå­—æ¯å†™è¿›[]ä¸­,ä¸­é—´ç”¨è¿å­—ç¬¦-åˆ†éš”,åŒºåˆ†å¤§å°å†™ æ•°å­—ä¹ŸåŒç†: /[3-6]/g =\u0026gt; 0123456789 é‡å¤ *è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å¯ä»¥ä¸å‡ºç°æˆ–å¯ä»¥å‡ºç°å¤šæ¬¡ /be*r/g =\u0026gt; br ber beer +è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ /be+r/g =\u0026gt; br ber beer ?è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æ˜¯å¯é€‰çš„ /colou?r/g =\u0026gt; color, colour {n}æŒ‡å®šä¸€ä¸ªå­—ç¬¦å‡ºç° n æ¬¡ /be{2}r/g =\u0026gt; ber beer beeer beeeer {n,}æŒ‡å®šä¸€ä¸ªå­—ç¬¦è‡³å°‘å‡ºç° n æ¬¡ /be{3,}r/g =\u0026gt; ber beer beeer beeeer {n,m}æŒ‡å®šä¸€ä¸ªå­—ç¬¦å‡ºç° n ~ m æ¬¡ /be{1,3}r/g =\u0026gt; ber beer beeer beeeer åˆ†ç»„ ()åŒ…è£¹éœ€è¦åˆ†ç»„çš„æ–‡æœ¬ /(haa)/g =\u0026gt; ha-ha,haa-haa \\nå¼•ç”¨åˆ†ç»„, ä¸ªäººç†è§£æ˜¯é‡å¤ä½ å¼•ç”¨çš„é‚£ä¸ªåˆ†ç»„çš„å†…å®¹ /(ha)-\\1,(haa)-\\2/g =\u0026gt; ha-ha,haa-haa (?:)éæ•è·åˆ†ç»„, ä¸ªäººç†è§£æ˜¯åˆ†ç»„äº†ï¼Œä½†æ˜¯å°±å½“æ²¡æœ‰åˆ†ç»„ä¸€æ ·ä¸å¯è¢«å¼•ç”¨ /(?:ha)-ha,(haa)-\\1/g =\u0026gt; ha-ha,haa-haa |å…è®¸ä¸€ä¸ªè¡¨è¾¾å¼æœ‰å¤šä¸ªä¸åŒçš„åˆ†æ”¯ /(c|r)at|dog/g =\u0026gt; cat rat dog \\è½¬ä¹‰å­—ç¬¦ /(\\*|\\.)/g =\u0026gt; (*) Asterisk. é”šç‚¹ ^åŒ¹é…è¡Œé¦– åŒ¹é…ä»¥æ•°å­—å¼€å¤´: /^[0-9]/g =\u0026gt; 1. 3 eggs, beaten $åŒ¹é…è¡Œå°¾ åŒ¹é…ä»¥ html ç»“å°¾: /html$/g =\u0026gt; \u0026nbsp;https://domain.com/what-is-html.`html` å­—ç¬¦ç±» \\wåŒ¹é…å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ /\\w/g =\u0026gt; abcABC123 _.:!? \\Wä¸\\wç›¸å /\\W/g =\u0026gt; abcABC123 _.:!? \\dåŒ¹é…æ•°å­— /\\d/g =\u0026gt; abcABC123 .:!? \\DåŒ¹é…é™¤æ•°å­—å¤–çš„æ‰€æœ‰å­—ç¬¦ /\\D/g =\u0026gt; abcABC123 .:!? \\såŒ¹é…ç©ºæ ¼ /\\s/g =\u0026gt; abcABC123 .:!? \\SåŒ¹é…å‡ºç©ºæ ¼ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦ /\\S/g =\u0026gt; abcABC123 .:!? é›¶å®½æ–­è¨€ æ­£å‘å…ˆè¡Œæ–­è¨€: (?=xxx),xxxè¡¨ç¤ºè¦åŒ¹é…çš„å­—ç¬¦ åŒ¹é…åé¢æ˜¯ PM çš„æ•°å­—: /\\d+(?=PM)/g =\u0026gt; Date: 4 Aug 3PM è´Ÿå‘å…ˆè¡Œæ–­è¨€:(?!xxx) åŒ¹é…åé¢ä¸æ˜¯ PM çš„æ•°å­—: /\\d+(?!PM)/g =\u0026gt; Date: 4 Aug 3PM æ­£å‘åè¡Œæ–­è¨€: (?\u0026lt;=) åŒ¹é…å‰é¢å­—ç¬¦æ˜¯ $ çš„æ•°å­—: /(?\u0026lt;=\\$)\\d+/g =\u0026gt;Product Code: 1064 Price: $5 è´Ÿå‘åè¡Œæ–­è¨€: (?\u0026lt;!) åŒ¹é…åé¢å­—ç¬¦ä¸æ˜¯ $ çš„æ•°å­—: /(?\u0026lt;!\\$)\\d+/g =\u0026gt;Product Code: 1064 Price: $5 æ ‡å¿— /\\w+\\.com/gmi g =\u0026gt; å…¨å±€,è¡¨ç¤ºåŒ¹é…æ‰€æœ‰åŒ¹é…é¡¹,å¦åˆ™åªåŒ¹é…ç¬¬ä¸€ä¸ª m =\u0026gt; å¤šè¡Œ,å•ç‹¬å¤„ç†æ¯ä¸€è¡Œ i =\u0026gt; å¿½ç•¥å¤§å°å†™ è´ªå©ªåŒ¹é…,æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤æ˜¯è´ªå©ªåŒ¹é…: /.*r/ æ‡’æƒ°åŒ¹é…,/.*?r/,å°†æŸ¥æ‰¾ä»¥ r ç»“å°¾ä¸”å‰é¢å¸¦æœ‰ä»»æ„å­—ç¬¦çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ ber beer beeer beeeer ç¤ºä¾‹ Release 10/9/2021 åŒ¹é…4ä½é˜¿æ‹‰ä¼¯æ•°å­—: /[0-9]{4}/g =\u0026gt; Release 10/9/2021 è‡³å°‘2ä½é˜¿æ‹‰ä¼¯æ•°å­—: /[0-9]{2,}/g =\u0026gt; Release 10/9/2021 1-4ä½é˜¿æ‹‰ä¼¯æ•°å­—: /[0-9]{1,4}/g =\u0026gt; Release 10/9/2021 ","permalink":"https://fzdwx.github.io/notes/14/","summary":"èµ„æº:\n\u0026nbsp;https://regexlearn.com/zh-cn/cheatsheet \u0026nbsp;https://regexlearn.com/zh-cn/playground é€ŸæŸ¥è¡¨ åŒ¹é…ä»»æ„å­—ç¬¦: /./g bar ber bir bor bur å­—ç¬¦é›†: [abc] /b[aeiou]r/g =\u0026gt; bar bir ber bor bur å°†å¯é€‰çš„å­—ç¬¦æ”¾å…¥[]ä¸­ å¦å®šå­—ç¬¦é›†: [^abc] /b[^eo]r/g =\u0026gt; bar ber bir bor bur åœ¨[]ä¸­çš„^è¾“å…¥è¦æ’é™¤çš„å­—ç¬¦ å­—æ¯èŒƒå›´: [a-z] abcdefghijklmnopqrstuvwxyz /[e-o]/g =\u0026gt;abcdefghijklmnopqrstuvwxyz å°†èµ·å§‹å­—æ¯å’Œç»“æŸå­—æ¯å†™è¿›[]ä¸­,ä¸­é—´ç”¨è¿å­—ç¬¦-åˆ†éš”,åŒºåˆ†å¤§å°å†™ æ•°å­—ä¹ŸåŒç†: /[3-6]/g =\u0026gt; 0123456789 é‡å¤ *è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å¯ä»¥ä¸å‡ºç°æˆ–å¯ä»¥å‡ºç°å¤šæ¬¡ /be*r/g =\u0026gt; br ber beer +è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ /be+r/g =\u0026gt; br ber beer ?è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æ˜¯å¯é€‰çš„ /colou?r/g =\u0026gt; color, colour {n}æŒ‡å®šä¸€ä¸ªå­—ç¬¦å‡ºç° n æ¬¡ /be{2}r/g =\u0026gt; ber beer beeer beeeer {n,}æŒ‡å®šä¸€ä¸ªå­—ç¬¦è‡³å°‘å‡ºç° n æ¬¡ /be{3,}r/g =\u0026gt; ber beer beeer beeeer {n,m}æŒ‡å®šä¸€ä¸ªå­—ç¬¦å‡ºç° n ~ m æ¬¡ /be{1,3}r/g =\u0026gt; ber beer beeer beeeer åˆ†ç»„ ()åŒ…è£¹éœ€è¦åˆ†ç»„çš„æ–‡æœ¬ /(haa)/g =\u0026gt; ha-ha,haa-haa \\nå¼•ç”¨åˆ†ç»„, ä¸ªäººç†è§£æ˜¯é‡å¤ä½ å¼•ç”¨çš„é‚£ä¸ªåˆ†ç»„çš„å†…å®¹ /(ha)-\\1,(haa)-\\2/g =\u0026gt; ha-ha,haa-haa (?","title":"æ­£åˆ™é€ŸæŸ¥"},{"content":"#!/usr/bin/env just --justfile\r# default\rdefault:\r@just --choose\r# start wezterm on $PWD\rterm:\rwezterm start --class float --cwd={{ invocation_directory() }} ","permalink":"https://fzdwx.github.io/notes/13/","summary":"#!/usr/bin/env just --justfile\r# default\rdefault:\r@just --choose\r# start wezterm on $PWD\rterm:\rwezterm start --class float --cwd={{ invocation_directory() }} ","title":"just file template"},{"content":" ä¸€ä¸ª tui çš„ markdown ç¼–è¾‘å™¨ï¼Œjust markdownã€‚è€ƒè™‘ç”¨ go å†™ï¼Œé™„å¸¦ previewã€‚ å¯èƒ½è¦ä½¿ç”¨åˆ°çš„åº“ \u0026nbsp;https://github.com/charmbracelet/glamour \u0026nbsp;https://github.com/charmbracelet/bubbletea \u0026nbsp;https://github.com/charmbracelet/lipgloss è¿™ä¸¤å¤©å†™äº†ä¸€ä¸ª demo: \u0026nbsp;https://github.com/fzdwx/md , å¯ä»¥ä¸€ç”¨ã€‚ ","permalink":"https://fzdwx.github.io/notes/12/","summary":" ä¸€ä¸ª tui çš„ markdown ç¼–è¾‘å™¨ï¼Œjust markdownã€‚è€ƒè™‘ç”¨ go å†™ï¼Œé™„å¸¦ previewã€‚ å¯èƒ½è¦ä½¿ç”¨åˆ°çš„åº“ \u0026nbsp;https://github.com/charmbracelet/glamour \u0026nbsp;https://github.com/charmbracelet/bubbletea \u0026nbsp;https://github.com/charmbracelet/lipgloss è¿™ä¸¤å¤©å†™äº†ä¸€ä¸ª demo: \u0026nbsp;https://github.com/fzdwx/md , å¯ä»¥ä¸€ç”¨ã€‚ ","title":"idea"},{"content":"æœ€è¿‘åœ¨çœ‹ åŠ¨æ¼« \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e ç”µè§†å‰§ \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e å·²çœ‹å®Œ \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e ","permalink":"https://fzdwx.github.io/notes/11/","summary":"æœ€è¿‘åœ¨çœ‹ åŠ¨æ¼« \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e ç”µè§†å‰§ \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e å·²çœ‹å®Œ \u003c!DOCTYPE HTML\u003e \u003c!DOCTYPE HTML\u003e ","title":"å½±è§†å‰§"},{"content":"ä¸»é¡µ:\n\u0026nbsp;è¯¾ç¨‹ä¸»é¡µ \u0026nbsp;cs diy ä¸»é¡µ è§†é¢‘èµ„æº \u0026nbsp;ç¬¬6å’Œ7é›† \u0026nbsp;ç¼ºäº†çœ‹è¿™ä¸ª \u0026nbsp;æœ‰ä¸€äº› \u0026nbsp;2021 ç‰ˆæœ¬ \u0026nbsp;ä¸­æ–‡ç¿»è¯‘ ä¸ªäººè®°å½• æˆ‘åš lab æ—¶ç§¯ç´¯çš„ä¸€äº›ç›¸å…³çš„ blog\nMap Reduce \u0026nbsp;https://fzdwx.github.io/posts/2022-09-27-mit6.824-lab1/ Raft KV \u0026nbsp;https://fzdwx.github.io/posts/2022-10-10-raftkv/ ","permalink":"https://fzdwx.github.io/notes/9/","summary":"ä¸»é¡µ:\n\u0026nbsp;è¯¾ç¨‹ä¸»é¡µ \u0026nbsp;cs diy ä¸»é¡µ è§†é¢‘èµ„æº \u0026nbsp;ç¬¬6å’Œ7é›† \u0026nbsp;ç¼ºäº†çœ‹è¿™ä¸ª \u0026nbsp;æœ‰ä¸€äº› \u0026nbsp;2021 ç‰ˆæœ¬ \u0026nbsp;ä¸­æ–‡ç¿»è¯‘ ä¸ªäººè®°å½• æˆ‘åš lab æ—¶ç§¯ç´¯çš„ä¸€äº›ç›¸å…³çš„ blog\nMap Reduce \u0026nbsp;https://fzdwx.github.io/posts/2022-09-27-mit6.824-lab1/ Raft KV \u0026nbsp;https://fzdwx.github.io/posts/2022-10-10-raftkv/ ","title":"6.824"},{"content":"åˆšåˆšæ”¹\u0026nbsp;nvim é…ç½®æ—¶ï¼Œä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œå‡ºç°äº†æ¸¸ç¦»åˆ†æ”¯(è‹±æ–‡åç§°å¤§æ¦‚æ˜¯ detached head )ã€‚ä¸»è¦ç—‡çŠ¶å°±æ˜¯ gitæäº¤ä¸äº†ï¼Œç”±äºæˆ‘ç”¨çš„ lazygit ï¼Œå®ƒçš„æç¤ºä¸æ˜æ˜¾ï¼Œæˆ‘ä»¥ä¸ºæäº¤äº†ã€‚ç„¶ååé¢æ‰“å¼€ idea çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆã€‚å‘ç°æç¤ºæ˜¯æ¸¸ç¦»åˆ†æ”¯ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä¹Ÿæ²¡åœ¨æ„ã€‚ æœ€è‡´å‘½çš„æ“ä½œæ¥äº†: æˆ‘ç›´æ¥ checkout main åˆ†æ”¯ï¼Œç„¶åä»Šå¤©æ™šä¸Šä¿®æ”¹çš„è®°å½•å…¨æ²¡äº†ã€‚\næˆ‘çš„è§£å†³æ–¹æ¡ˆ:\næŸ¥çœ‹git logï¼Œåªèƒ½æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ä¿®æ”¹ commit è®°å½•ã€‚ æ— æ•ˆ åˆ©ç”¨ idea çš„ local history åŠŸèƒ½ï¼Œåªèƒ½æ‰¾åˆ°æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ç©ºç™½çš„ã€‚ æ— æ•ˆ æœç´¢ detached head çš„è§£å†³æ–¹æ¡ˆï¼Œåªèƒ½æœåˆ°æ²¡åˆ‡æ¢åˆ†æ”¯å‰çš„è§£å†³æ–¹æ¡ˆï¼Œä¸é€‚ç”¨ä¸æˆ‘çš„ç°è±¡ã€‚ æ— æ•ˆ æœ€åæœç´¢ git æŸ¥çœ‹æ‰€æœ‰ commit ï¼Œæ‰¾åˆ°äº†git reflogï¼Œå®ƒèƒ½æ˜¾ç¤ºå¯å¼•ç”¨çš„å†å²ç‰ˆæœ¬è®°å½•ï¼Œæœ€åæ‰¾åˆ°æˆ‘è¦çš„é‚£ä¸ª commit ä¹‹åç›´æ¥git rest --hard xxxå®Œç¾è§£å†³ã€‚ è¯´å®è¯ï¼Œæœ‰ç‚¹æ…Œä¹Ÿæœ‰ç‚¹çƒ¦ï¼Œå¦‚æœæ‰¾ä¸å›æ¥æˆ‘å¯èƒ½ä¼šå¼ƒå‘ nvim äº†ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-10-23-about-git-detached-head/","summary":"å¦‚ä½•åœ¨åˆ‡æ¢äº†åˆ†æ”¯ä¹‹åæ¢å¤æ¸¸ç¦»åˆ†æ”¯æäº¤çš„ä»£ç ã€‚","title":"å…³äº git æ¸¸ç¦»åˆ†æ”¯"},{"content":"æ•™ç¨‹ \u0026nbsp;mdn css ä¹¦ç± \u0026nbsp;css in depth CSS lib \u0026nbsp;hyperui-Tailwind CSS Components ","permalink":"https://fzdwx.github.io/notes/8/","summary":"æ•™ç¨‹ \u0026nbsp;mdn css ä¹¦ç± \u0026nbsp;css in depth CSS lib \u0026nbsp;hyperui-Tailwind CSS Components ","title":"å‰ç«¯èµ„æ–™"},{"content":"èµ„æ–™ \u0026nbsp;Rustå®˜æ–¹æ–‡æ¡£ç¿»è¯‘é¡¹ç›®ç»„ ï¼Œå†…å«ä¸€ç³»åˆ—ç›¸å…³æ–‡æ¡£ \u0026nbsp;Rustè¯­è¨€åœ£ç» \u0026nbsp;Rust resource é¡¹ç›® \u0026nbsp;pingcapæ¨å‡ºçš„project ï¼Œä»¥ Talent Plan å¼€æºæ•°æ®åº“å¼€å‘è¯¾ç¨‹ä¸ºä¾æ‰˜ï¼Œå¸®åŠ©å­¦ä¹ è€…æŒæ¡æ•°æ®åº“å¼€å‘çš„ç†è®ºçŸ¥è¯†ï¼Œè¿›è¡Œå®é™…æ•°æ®åº“å¼€å‘é”»ç‚¼ã€‚(\u0026nbsp;github åœ°å€ ) ","permalink":"https://fzdwx.github.io/notes/7/","summary":"èµ„æ–™ \u0026nbsp;Rustå®˜æ–¹æ–‡æ¡£ç¿»è¯‘é¡¹ç›®ç»„ ï¼Œå†…å«ä¸€ç³»åˆ—ç›¸å…³æ–‡æ¡£ \u0026nbsp;Rustè¯­è¨€åœ£ç» \u0026nbsp;Rust resource é¡¹ç›® \u0026nbsp;pingcapæ¨å‡ºçš„project ï¼Œä»¥ Talent Plan å¼€æºæ•°æ®åº“å¼€å‘è¯¾ç¨‹ä¸ºä¾æ‰˜ï¼Œå¸®åŠ©å­¦ä¹ è€…æŒæ¡æ•°æ®åº“å¼€å‘çš„ç†è®ºçŸ¥è¯†ï¼Œè¿›è¡Œå®é™…æ•°æ®åº“å¼€å‘é”»ç‚¼ã€‚(\u0026nbsp;github åœ°å€ ) ","title":"Rust ç›¸å…³èµ„æºé›†åˆ"},{"content":"Roadmap \u0026nbsp;https://github.com/izackwu/TeachYourselfCS-CN/blob/master/TeachYourselfCS-CN.md cs61c Great Ideas in Computer Architecture\nä¸»è¦èµ„æ–™ è¯¾ç¨‹ä¸»é¡µ: \u0026nbsp;https://inst.eecs.berkeley.edu/~cs61c/fa20/ è§†é¢‘: \u0026nbsp;https://inst.eecs.berkeley.edu/~cs61c/fa20/#lectures discussion: \u0026nbsp;https://www.youtube.com/watch?v=4HC3VqyPU7o\u0026list=PLYKsAjQZdJD_aO22u9YREZWQUV8WOdAC8\u0026ab_channel=CarolineLiu jyy os æ“ä½œç³»ç»Ÿ\nä¸»è¦èµ„æ–™ è§†é¢‘åœ°å€: \u0026nbsp;https://www.bilibili.com/video/BV1Cm4y1d7Ur è¯¾ç¨‹ä¸»é¡µ: \u0026nbsp;http://jyywiki.cn/OS/2022/ é˜…è¯»ææ–™: æ“ä½œç³»ç»Ÿå¯¼è®º \u0026nbsp;ä¹¦é¦–é¡µ \u0026nbsp;ä¹¦PDF ä»£ç  \u0026nbsp;xv6-risc-v todo:\nlibco jyy ics å…³äºjyyçš„è®¡ç®—æœºç³»ç»ŸåŸºç¡€è¯¾\nä¸»è¦èµ„æ–™ paåœ°å€: \u0026nbsp;https://nju-projectn.github.io/ics-pa-gitbook/ics2021/ è¯¾ç¨‹è§†é¢‘åœ°å€: \u0026nbsp;https://www.bilibili.com/video/BV1qa4y1j7xk è¯¾ç¨‹ä¸»é¡µ: \u0026nbsp;http://jyywiki.cn/ICS/2021/ NEMU ISAç›¸å…³çš„API: \u0026nbsp;https://nju-projectn.github.io/ics-pa-gitbook/ics2021/nemu-isa-api.html æ‰©å±•èµ„æ–™ Linux Cç¼–ç¨‹ä¸€ç«™å¼å­¦ä¹ : \u0026nbsp;https://docs.huihoo.com/c/linux-c-programming/ è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾: \u0026nbsp;https://missing-semester-cn.github.io/ ","permalink":"https://fzdwx.github.io/notes/6/","summary":"Roadmap \u0026nbsp;https://github.com/izackwu/TeachYourselfCS-CN/blob/master/TeachYourselfCS-CN.md cs61c Great Ideas in Computer Architecture\nä¸»è¦èµ„æ–™ è¯¾ç¨‹ä¸»é¡µ: \u0026nbsp;https://inst.eecs.berkeley.edu/~cs61c/fa20/ è§†é¢‘: \u0026nbsp;https://inst.eecs.berkeley.edu/~cs61c/fa20/#lectures discussion: \u0026nbsp;https://www.youtube.com/watch?v=4HC3VqyPU7o\u0026list=PLYKsAjQZdJD_aO22u9YREZWQUV8WOdAC8\u0026ab_channel=CarolineLiu jyy os æ“ä½œç³»ç»Ÿ\nä¸»è¦èµ„æ–™ è§†é¢‘åœ°å€: \u0026nbsp;https://www.bilibili.com/video/BV1Cm4y1d7Ur è¯¾ç¨‹ä¸»é¡µ: \u0026nbsp;http://jyywiki.cn/OS/2022/ é˜…è¯»ææ–™: æ“ä½œç³»ç»Ÿå¯¼è®º \u0026nbsp;ä¹¦é¦–é¡µ \u0026nbsp;ä¹¦PDF ä»£ç  \u0026nbsp;xv6-risc-v todo:\nlibco jyy ics å…³äºjyyçš„è®¡ç®—æœºç³»ç»ŸåŸºç¡€è¯¾\nä¸»è¦èµ„æ–™ paåœ°å€: \u0026nbsp;https://nju-projectn.github.io/ics-pa-gitbook/ics2021/ è¯¾ç¨‹è§†é¢‘åœ°å€: \u0026nbsp;https://www.bilibili.com/video/BV1qa4y1j7xk è¯¾ç¨‹ä¸»é¡µ: \u0026nbsp;http://jyywiki.cn/ICS/2021/ NEMU ISAç›¸å…³çš„API: \u0026nbsp;https://nju-projectn.github.io/ics-pa-gitbook/ics2021/nemu-isa-api.html æ‰©å±•èµ„æ–™ Linux Cç¼–ç¨‹ä¸€ç«™å¼å­¦ä¹ : \u0026nbsp;https://docs.huihoo.com/c/linux-c-programming/ è®¡ç®—æœºæ•™è‚²ä¸­ç¼ºå¤±çš„ä¸€è¯¾: \u0026nbsp;https://missing-semester-cn.github.io/ ","title":"æ¶è¡¥è®¡ç®—æœºåŸºç¡€"},{"content":"ä¸»è¦åŸç†å°±æ˜¯é€šè¿‡ github action çš„æ¥ç›‘å¬ issue çš„ç›¸å…³äº‹ä»¶ï¼Œç„¶åè¯»å–issueä¸­çš„å†…å®¹åˆ›å»ºæ–‡ä»¶æäº¤åˆ° git ä¸Šï¼Œæœ€åç›´æ¥éƒ¨ç½²ã€‚è¿™æ ·å°±èƒ½éšæ—¶ç¼–è¾‘å¹¶å±•ç¤ºäº†ã€‚\nå…·ä½“å¯ä»¥çœ‹ \u0026nbsp;add event to myb log è¿™ä¸ªä»“åº“ï¼Œ ä»¥åŠ\u0026nbsp;ä½¿ç”¨æ–¹å¼ ã€‚\næ¥ä¸‹æ¥ä»‹ç»å¦‚ä½•å¼€å‘ä¸€ä¸ª github action:\n1. å…‹éš†å®˜æ–¹æä¾›çš„template å®˜æ–¹ä¸»è¦å¯¹ typescript çš„æ”¯æŒæ¯”è¾ƒå¥½ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„\u0026nbsp;å·¥å…·åŒ… ï¼Œæ²¡åŠæ³•åªèƒ½åŒtsæ¥è¿›è¡Œå¼€å‘ï¼Œ\n\u0026nbsp;https://github.com/actions/typescript-action 2. å®šä¹‰æƒ³è¦åœ¨è¿è¡Œæ—¶ç”¨æˆ·è¾“å…¥çš„å‚æ•° é€šè¿‡ç¼–è¾‘action.ymlè¿™ä¸ªæ–‡ä»¶æ¥å®šä¹‰æƒ³è¦åœ¨è¿è¡Œæ—¶å®šä¹‰çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´GITHUB_TOKEN:\nname: \u0026#39;add event to my blog\u0026#39; description: \u0026#39;add event to my blog\u0026#39; author: \u0026#39;fzdwx\u0026#39; branding: icon: \u0026#39;archive\u0026#39; color: \u0026#39;white\u0026#39; inputs: # åœ¨è¿™ä¸ªkeyä¸‹é¢æ·»åŠ è‡ªå®šä¹‰å‚æ•° token: required: true description: \u0026#39;the repo PAT or GITHUB_TOKEN\u0026#39; runs: using: \u0026#39;node16\u0026#39; main: \u0026#39;dist/index.js\u0026#39; å‚æ•°æœ‰ä¸‰ä¸ªå±æ€§:\nrequired: æ˜¯å¦å¿…é¡» description: æè¿° default: é»˜è®¤å€¼ 3. å®ç°æƒ³è¦çš„åŠŸèƒ½ è¯¦ç»†å¯ä»¥æŸ¥çœ‹æˆ‘çš„\u0026nbsp;ä¸»è¦ä»£ç  ã€‚æˆ‘çš„é‡Œé¢ä¸»è¦åšäº†:\næ ¹æ®å½“å‰issue number\u0026nbsp;è·å–è¯¥issueçš„å†…å®¹ ã€‚ æ ¹æ®é¢„å®šä¹‰çš„æ¨¡æ¿ï¼Œ\u0026nbsp;åˆ›å»ºæ–‡ä»¶å†…å®¹ ã€‚ æäº¤åˆ°\u0026nbsp;git ä¸Šã€‚ 4. å‘å¸ƒåˆ°marketplace éœ€è¦å‹¾é€‰ Publish this Action to the GitHub Marketplaceï¼Œå¯èƒ½éœ€è¦2faè®¤è¯ï¼Œæ‰¾ä¸€ä¸ª github æ”¯æŒ(æˆ‘ç”¨çš„æ˜¯ authyï¼Œé˜²æ­¢åé¢å¿˜è®°äº†)å°±okäº†ã€‚\nFigure 1 æˆåŠŸ release åå°±èƒ½åœ¨åˆ«çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-10-15-about-github-action/","summary":"èµ·å› æ˜¯å› ä¸ºæƒ³è¦æœ‰ä¸€ç§å¯ä»¥ä¸ç”¨ç¼–è¾‘æ–‡ä»¶è€Œä½œç”¨åˆ°ç½‘ç«™ä¸Šçš„æ–¹å¼ï¼Œç„¶åå°±äº†è§£åˆ°äº† github action çš„å½¢å¼ã€‚","title":"å†™ä¸€ä¸ªè‡ªå·±çš„github action"},{"content":"å£çº¸ç½‘ç«™:\n\u0026nbsp;https://wallhaven.cc/ \u0026nbsp;https://wallpaperscraft.com/catalog/anime/1920x1080 \u0026nbsp;https://wall.alphacoders.com/ ","permalink":"https://fzdwx.github.io/notes/5/","summary":"å£çº¸ç½‘ç«™:\n\u0026nbsp;https://wallhaven.cc/ \u0026nbsp;https://wallpaperscraft.com/catalog/anime/1920x1080 \u0026nbsp;https://wall.alphacoders.com/ ","title":"å£çº¸"},{"content":"èµ·å›  æ˜¨å¤©æ™šä¸Šæƒ³ç”¨fzfä¸cdè”åŠ¨ï¼Œå°±æ˜¯fzfçš„ç»“æœä¼ é€’ç»™cdæ¥æ‰§è¡Œäºæ˜¯æœ‰äº†è¿™ä¹ˆä¸€æ¡å‘½ä»¤:\ncd $(fd --type d | fzf) è¿™ä¸ªå‘½ä»¤ä¹Ÿç¡®å®èƒ½å®Œæˆä»»åŠ¡ï¼Œä½†æ˜¯é—®é¢˜æœ‰ä¸¤ä¸ª:\nå¦‚æœç›´æ¥é€€å‡ºçš„è¯ä¼šå›åˆ°å®¶ç›®å½•ï¼Œå› ä¸º$(..)çš„æ‰§è¡Œç»“æœä¸ºç©º æ¯æ¬¡éƒ½è¦è¾“å…¥è¿™ä¹ˆå¤šä¼šå¾ˆéº»çƒ¦ ç”¨alias ç„¶åå°è¯•ç”¨aliasæ¥è¯•è¯•ï¼Œæ‰€ä»¥å°±å¾€.zshrcé‡Œé¢æ·»åŠ :\nalias cdf=\u0026#34;cd $(fd --type d | fzf)\u0026#34; ç»“æœæ˜¯ç›´æ¥ä¸èƒ½è¿è¡Œï¼Œå› ä¸ºå®ƒç›´æ¥è¯†åˆ«äº†$(..)è¿™ä¸€æ®µï¼Œç„¶åç›´æ¥è¿è¡Œäº†ï¼Œä½†æ˜¯åé¢å°±ä¸ä¼šè¿è¡Œã€‚\nç”¨shellè„šæœ¬ ç„¶åå°±å†™äº†è¿™ä¸ªæ–‡ä»¶:\n#!/bin/sh path=$(fd --type d --strip-cwd-prefix --hidden --follow --exclude .git --exclude node_modules | fzf) if [ -z \u0026#34;$path\u0026#34; ]; then exit fi cd \u0026#34;$path\u0026#34; || exit ç»“æœä¹Ÿæ˜¯ä¸è¡Œï¼Œåé¢æˆ‘åœ¨æœ€ä¸‹é¢åŠ äº†ä¸€è¡Œecho \u0026quot;$PWD\u0026quot;ï¼Œæˆ‘çœ‹åˆ°æ˜¯æ‰§è¡Œäº†çš„ï¼Œä½†æ˜¯ç¨‹åºé€€å‡ºäº†å°±å¤±æ•ˆäº†ã€‚\nè§£å†³ æœ€åæˆ‘æœç´¢åˆ°å¯ä»¥ä½¿ç”¨source xxxæˆ–è€…. xxxæ¥è§£å†³ï¼Œæœ€åæ˜¯alias+shellè„šæœ¬æ¥å®Œæˆè¿™ä¸ªæ“ä½œçš„:\nalias cdf=\u0026#34;source /path/to/cdf\u0026#34; åŒæ—¶å®ƒä¹Ÿè§£å†³æˆ‘ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ã€‚\nsourceä¸ºä»€ä¹ˆèƒ½è§£å†³ï¼Ÿ ä¹‹æ‰€ä»¥ç›´æ¥ç”¨shellè„šæœ¬ç›´æ¥è¿è¡Œä¼šä¸è¡Œï¼Œæ˜¯å› ä¸ºå®ƒä¸æ˜¯åœ¨å½“å‰shellç¯å¢ƒä¸­è¿è¡Œçš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå­shellï¼Œæ‰€ä»¥ç»“æœå°±ä¸èƒ½æ”¹å˜å½“å‰çš„æ–‡ä»¶ç›®å½•äº†ã€‚\nè€Œsourceæˆ–è€….å°±ä»£è¡¨ç€åœ¨å½“å‰çš„shellç¯å¢ƒä¸­æ‰§è¡Œï¼Œæ‰€ä»¥å°±èƒ½æˆåŠŸã€‚\næ›´æ–° 2022/11/18 ä»Šå¤©å‘ç°ä¸€ç§æ›´å®¹æ˜“è§£å†³çš„åŠæ³•,å°±æ˜¯åœ¨å†™ä¸€ä¸ª shell æ–¹æ³•:\nfunction cd() { cd \u0026#34;$(fzf)\u0026#34; } æŠŠå®ƒåŠ å…¥åˆ°.zshrc(æˆ‘ç”¨çš„æ˜¯ zsh)ä¸­ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ cd å°±å¥½äº†ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-10-11-about-source/","summary":"èµ·å›  æ˜¨å¤©æ™šä¸Šæƒ³ç”¨fzfä¸cdè”åŠ¨ï¼Œå°±æ˜¯fzfçš„ç»“æœä¼ é€’ç»™cdæ¥æ‰§è¡Œäºæ˜¯æœ‰äº†è¿™ä¹ˆä¸€æ¡å‘½ä»¤:\ncd $(fd --type d | fzf) è¿™ä¸ªå‘½ä»¤ä¹Ÿç¡®å®èƒ½å®Œæˆä»»åŠ¡ï¼Œä½†æ˜¯é—®é¢˜æœ‰ä¸¤ä¸ª:\nå¦‚æœç›´æ¥é€€å‡ºçš„è¯ä¼šå›åˆ°å®¶ç›®å½•ï¼Œå› ä¸º$(..)çš„æ‰§è¡Œç»“æœä¸ºç©º æ¯æ¬¡éƒ½è¦è¾“å…¥è¿™ä¹ˆå¤šä¼šå¾ˆéº»çƒ¦ ç”¨alias ç„¶åå°è¯•ç”¨aliasæ¥è¯•è¯•ï¼Œæ‰€ä»¥å°±å¾€.zshrcé‡Œé¢æ·»åŠ :\nalias cdf=\u0026#34;cd $(fd --type d | fzf)\u0026#34; ç»“æœæ˜¯ç›´æ¥ä¸èƒ½è¿è¡Œï¼Œå› ä¸ºå®ƒç›´æ¥è¯†åˆ«äº†$(..)è¿™ä¸€æ®µï¼Œç„¶åç›´æ¥è¿è¡Œäº†ï¼Œä½†æ˜¯åé¢å°±ä¸ä¼šè¿è¡Œã€‚\nç”¨shellè„šæœ¬ ç„¶åå°±å†™äº†è¿™ä¸ªæ–‡ä»¶:\n#!/bin/sh path=$(fd --type d --strip-cwd-prefix --hidden --follow --exclude .git --exclude node_modules | fzf) if [ -z \u0026#34;$path\u0026#34; ]; then exit fi cd \u0026#34;$path\u0026#34; || exit ç»“æœä¹Ÿæ˜¯ä¸è¡Œï¼Œåé¢æˆ‘åœ¨æœ€ä¸‹é¢åŠ äº†ä¸€è¡Œecho \u0026quot;$PWD\u0026quot;ï¼Œæˆ‘çœ‹åˆ°æ˜¯æ‰§è¡Œäº†çš„ï¼Œä½†æ˜¯ç¨‹åºé€€å‡ºäº†å°±å¤±æ•ˆäº†ã€‚\nè§£å†³ æœ€åæˆ‘æœç´¢åˆ°å¯ä»¥ä½¿ç”¨source xxxæˆ–è€…. xxxæ¥è§£å†³ï¼Œæœ€åæ˜¯alias+shellè„šæœ¬æ¥å®Œæˆè¿™ä¸ªæ“ä½œçš„:\nalias cdf=\u0026#34;source /path/to/cdf\u0026#34; åŒæ—¶å®ƒä¹Ÿè§£å†³æˆ‘ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ã€‚\nsourceä¸ºä»€ä¹ˆèƒ½è§£å†³ï¼Ÿ ä¹‹æ‰€ä»¥ç›´æ¥ç”¨shellè„šæœ¬ç›´æ¥è¿è¡Œä¼šä¸è¡Œï¼Œæ˜¯å› ä¸ºå®ƒä¸æ˜¯åœ¨å½“å‰shellç¯å¢ƒä¸­è¿è¡Œçš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå­shellï¼Œæ‰€ä»¥ç»“æœå°±ä¸èƒ½æ”¹å˜å½“å‰çš„æ–‡ä»¶ç›®å½•äº†ã€‚\nè€Œsourceæˆ–è€….å°±ä»£è¡¨ç€åœ¨å½“å‰çš„shellç¯å¢ƒä¸­æ‰§è¡Œï¼Œæ‰€ä»¥å°±èƒ½æˆåŠŸã€‚\næ›´æ–° 2022/11/18 ä»Šå¤©å‘ç°ä¸€ç§æ›´å®¹æ˜“è§£å†³çš„åŠæ³•,å°±æ˜¯åœ¨å†™ä¸€ä¸ª shell æ–¹æ³•:\nfunction cd() { cd \u0026#34;$(fzf)\u0026#34; } æŠŠå®ƒåŠ å…¥åˆ°.","title":"åœ¨shellè„šæœ¬ä¸­æ‰§è¡Œcdåæ”¹å˜main shellçš„è·¯å¾„"},{"content":"idea ç›®å‰æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œæ˜¯åœ¨å‘½ä»¤è¡Œä¸‹ç®¡ç†è„šæœ¬çš„å·¥å…·ã€‚\nä¾‹å¦‚è¯´æˆ‘æœ‰ä¸€äº›å¸¸ç”¨çš„è„šæœ¬:\ncd $(find . -name \u0026#34;*\u0026#34; -type d | fzf) ç„¶åé€šè¿‡å‘½ä»¤è¡Œæ·»åŠ \ncli load \u0026#34;cd $(find . -name \u0026#34;*\u0026#34; -type d | fzf)\u0026#34; -alias cdf ç„¶åä½¿ç”¨cdfè¿›è¡Œè¿è¡Œ\ncli cdf åç»­ 2022-10-18 22:47\nåˆšåˆšæ‰¾åˆ°äº†ä¸€ä¸ªè·Ÿæˆ‘è¿™ä¸ªæƒ³æ³•å¾ˆå¥‘åˆçš„é¡¹ç›®: \u0026nbsp;https://github.com/denisidoro/navi ã€‚\nä»Šå¤©ä¸€æ™šä¸Šéƒ½åœ¨è°ƒç ”æŠ€æœ¯çš„å¯è¡Œæ€§ï¼Œä½†æ˜¯éƒ½è¾¾ä¸åˆ°æˆ‘æƒ³è¦çš„æ•ˆæœã€‚è¿˜æ˜¯è¿™ä¸ªä¾‹å­ï¼Œcd $(find . -name \u0026quot;*\u0026quot; -type d | fzf)ï¼Œ ä¸»è¦æœ‰ä¸¤ç§æ€è·¯:\nåœ¨è¿è¡Œç¨‹åºçš„ä½¿ç”¨åˆ©ç”¨shellçš„tabé”®ç›˜è¡¥å…¨ï¼Œç›´æ¥æ›¿æ¢æˆè¿™æ®µå‘½ä»¤ï¼Œç„¶åè¿è¡Œã€‚æ¯”å¦‚è¯´ç¨‹åºå«qweï¼Œåœ¨shellé‡Œé¢è¾“å…¥qwe cdf\u0026lt;TAB\u0026gt; ï¼Œç„¶åå°±ç›´æ¥æ›¿æ¢ä¸ºä¸Šé¢çš„å‘½ä»¤ã€‚æˆ‘åœ¨goé‡Œé¢æ‰¾åˆ°cobraè¿™ä¸ªåŒ…ï¼Œå®ƒèƒ½åŠ¨æ€è¡¥å…¨å‘½ä»¤ï¼Œæœ‰ç‚¹æ•ˆæœï¼Œä½†è¿˜ä¸å¤Ÿï¼Œä¸èƒ½åšåˆ°å…¨éƒ¨æ›¿æ¢ï¼Œé‚æç½®ã€‚ ç›´æ¥åœ¨ç¨‹åºé‡Œé¢è¿è¡Œè¿™æ®µå‘½ä»¤ï¼Œæˆ‘è¯•äº†ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼Œcdæ‰§è¡Œåæ²¡æœ‰ç”Ÿæ•ˆï¼Œåº”è¯¥è¿˜æ˜¯è·Ÿforkæœ‰å…³ã€‚ ç„¶åå°±åˆ°githubé‡Œé¢æ‰¾åˆ«äººçš„å®ç°ï¼Œæ²¡æƒ³åˆ°æ‰¾åˆ°äº†ä¸€ä¸ªï¼Œä½†æ˜¯è¯•è¿‡ä¹‹åè¿˜æ˜¯ä¸æ”¯æŒï¼Œä½†ç¡®å®åšçš„è¿˜ä¸é”™ã€‚\næƒ³è¦åšæˆæˆ‘æƒ³è¦çš„æ•ˆæœå°±æ˜¯å®ç°:\nåœ¨shellä¸­è¡¥å…¨èƒ½ç›´æ¥æ›¿æ¢æ‰€æœ‰ï¼Œè€Œä¸æ˜¯ä¸€æ®µã€‚ åœ¨ç¨‹åºä¸­ä¸ç”¨forkè¿è¡Œã€‚ è¿˜éœ€è¦åœ¨çœ‹çœ‹ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-10-10-code-alias/","summary":"idea ç›®å‰æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œæ˜¯åœ¨å‘½ä»¤è¡Œä¸‹ç®¡ç†è„šæœ¬çš„å·¥å…·ã€‚\nä¾‹å¦‚è¯´æˆ‘æœ‰ä¸€äº›å¸¸ç”¨çš„è„šæœ¬:\ncd $(find . -name \u0026#34;*\u0026#34; -type d | fzf) ç„¶åé€šè¿‡å‘½ä»¤è¡Œæ·»åŠ \ncli load \u0026#34;cd $(find . -name \u0026#34;*\u0026#34; -type d | fzf)\u0026#34; -alias cdf ç„¶åä½¿ç”¨cdfè¿›è¡Œè¿è¡Œ\ncli cdf åç»­ 2022-10-18 22:47\nåˆšåˆšæ‰¾åˆ°äº†ä¸€ä¸ªè·Ÿæˆ‘è¿™ä¸ªæƒ³æ³•å¾ˆå¥‘åˆçš„é¡¹ç›®: \u0026nbsp;https://github.com/denisidoro/navi ã€‚\nä»Šå¤©ä¸€æ™šä¸Šéƒ½åœ¨è°ƒç ”æŠ€æœ¯çš„å¯è¡Œæ€§ï¼Œä½†æ˜¯éƒ½è¾¾ä¸åˆ°æˆ‘æƒ³è¦çš„æ•ˆæœã€‚è¿˜æ˜¯è¿™ä¸ªä¾‹å­ï¼Œcd $(find . -name \u0026quot;*\u0026quot; -type d | fzf)ï¼Œ ä¸»è¦æœ‰ä¸¤ç§æ€è·¯:\nåœ¨è¿è¡Œç¨‹åºçš„ä½¿ç”¨åˆ©ç”¨shellçš„tabé”®ç›˜è¡¥å…¨ï¼Œç›´æ¥æ›¿æ¢æˆè¿™æ®µå‘½ä»¤ï¼Œç„¶åè¿è¡Œã€‚æ¯”å¦‚è¯´ç¨‹åºå«qweï¼Œåœ¨shellé‡Œé¢è¾“å…¥qwe cdf\u0026lt;TAB\u0026gt; ï¼Œç„¶åå°±ç›´æ¥æ›¿æ¢ä¸ºä¸Šé¢çš„å‘½ä»¤ã€‚æˆ‘åœ¨goé‡Œé¢æ‰¾åˆ°cobraè¿™ä¸ªåŒ…ï¼Œå®ƒèƒ½åŠ¨æ€è¡¥å…¨å‘½ä»¤ï¼Œæœ‰ç‚¹æ•ˆæœï¼Œä½†è¿˜ä¸å¤Ÿï¼Œä¸èƒ½åšåˆ°å…¨éƒ¨æ›¿æ¢ï¼Œé‚æç½®ã€‚ ç›´æ¥åœ¨ç¨‹åºé‡Œé¢è¿è¡Œè¿™æ®µå‘½ä»¤ï¼Œæˆ‘è¯•äº†ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼Œcdæ‰§è¡Œåæ²¡æœ‰ç”Ÿæ•ˆï¼Œåº”è¯¥è¿˜æ˜¯è·Ÿforkæœ‰å…³ã€‚ ç„¶åå°±åˆ°githubé‡Œé¢æ‰¾åˆ«äººçš„å®ç°ï¼Œæ²¡æƒ³åˆ°æ‰¾åˆ°äº†ä¸€ä¸ªï¼Œä½†æ˜¯è¯•è¿‡ä¹‹åè¿˜æ˜¯ä¸æ”¯æŒï¼Œä½†ç¡®å®åšçš„è¿˜ä¸é”™ã€‚\næƒ³è¦åšæˆæˆ‘æƒ³è¦çš„æ•ˆæœå°±æ˜¯å®ç°:\nåœ¨shellä¸­è¡¥å…¨èƒ½ç›´æ¥æ›¿æ¢æ‰€æœ‰ï¼Œè€Œä¸æ˜¯ä¸€æ®µã€‚ åœ¨ç¨‹åºä¸­ä¸ç”¨forkè¿è¡Œã€‚ è¿˜éœ€è¦åœ¨çœ‹çœ‹ã€‚","title":"Code:alias"},{"content":"Lab2æ–‡æ¡£ç¿»è¯‘ ç”±äºæˆ‘çš„è‹±æ–‡ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥ä½¿ç”¨ç¿»è¯‘è½¯ä»¶è¿›è¡Œç¿»è¯‘ï¼Œç„¶åäººå·¥è¿›è¡Œæ ¡å¯¹è¿›è¡Œç†è§£ã€‚\noriginalåœ°å€: \u0026nbsp;https://pdos.csail.mit.edu/6.824/labs/lab-raft.html Introduction è¿™æ˜¯ä¸€ç³»åˆ—å®éªŒä¸­çš„ç¬¬ä¸€ä¸ªï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª fault-tolerant key/value storage system ã€‚ åœ¨æœ¬å®éªŒä¸­æˆ‘ä»¬å°†å®ç° Raft (ä¸€ç§å¤åˆ¶çš„çŠ¶æ€æœºåè®®)ã€‚åœ¨ä¸‹ä¸€ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ Raft ä¸Šæ„å»ºä¸€ä¸ª key/value service ã€‚ ç„¶åï¼Œæ‚¨å°†åœ¨æœ‰å¤šä¸ªå‰¯æœ¬çš„çŠ¶æ€æœºä¸Šè¿›è¡Œ shard(åˆ†ç‰‡ï¼Ÿæ ¹æ® key è¿›è¡Œ hash æ¥å†³å®šè·¯ç”±åˆ°å“ªä¸ªå‰¯æœ¬ä¸Š) æ¥æé«˜æ€§èƒ½ã€‚\nå¤åˆ¶(replication)é€šè¿‡åœ¨å¤šä¸ªå¤åˆ¶æœåŠ¡å™¨ä¸Šå­˜å‚¨å…¶çŠ¶æ€(å³æ•°æ®)çš„å®Œæ•´å‰¯æœ¬æ¥å®ç° fault tolerance ã€‚ å³ä½¿æœ‰ä¸€äº›æœåŠ¡å™¨å‡ºç° failure (å´©æºƒæˆ–ç½‘ç»œæ–­å¼€å’ŒæŠ–åŠ¨) replication ä¹Ÿå…è®¸å®ƒä»¬ç»§ç»­è¿è¡Œã€‚ æŒ‘æˆ˜åœ¨äº failures å¯èƒ½å¯¼è‡´å‰¯æœ¬å­˜åœ¨ä¸åŒçš„æ•°æ®ã€‚\nRaft å°†å®¢æˆ·ç«¯çš„è¯·æ±‚ç»„ç»‡æˆä¸€ä¸ªåºåˆ—ï¼Œè¢«ç§°ä¸º log ï¼Œå¹¶ä¸”ç¡®ä¿æ‰€æœ‰ replica servers çœ‹åˆ°ç›¸åŒçš„ log ã€‚ æ¯ä¸ª replica æŒ‰ç…§æ—¥å¿—çš„é¡ºåºæ¥æ‰§è¡Œå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°†å®ƒä»¬åº”ç”¨äºå…¶æœ¬åœ°çš„æœåŠ¡çŠ¶æ€å‰¯æœ¬(å°±æ˜¯è¿è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤)ã€‚ ç”±äºæ‰€æœ‰å­˜æ´»çš„å‰¯æœ¬è¯»å–çš„æ—¥å¿—å†…å®¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥éƒ½ä»¥ç›¸åŒçš„é¡ºåºæ¥æ‰§è¡Œè¯·æ±‚ï¼Œå› æ­¤å®ƒä»¬éƒ½æœ‰ç›¸åŒçš„æœåŠ¡çŠ¶æ€ã€‚ å¦‚æœä¸€ä¸ªæœåŠ¡å™¨å‘ç”Ÿäº† failure ä½†æ˜¯åæ¥åˆ recovery (æ¢å¤) äº†ï¼ŒRaft ä¼šè´Ÿè´£å°†å®ƒçš„ log æ›´æ–°åˆ°æœ€æ–°çŠ¶æ€ã€‚åªè¦è‡³å°‘å¤§å¤šæ•°çš„æœåŠ¡å™¨è¿˜æ´»ç€ï¼Œå¹¶ä¸”èƒ½å¤Ÿç»§ç»­é€šä¿¡ï¼Œ é‚£ä¹ˆ Raft å°†æŒç»­è¿è¡Œã€‚å¦‚æœæ²¡æœ‰åˆ°è¾¾è¿™ä¸ªæ•°é‡ï¼Œé‚£ä¹ˆ Raft å°†ä¼šåœæ­¢è¿è¡Œï¼Œç›´åˆ°è¾¾åˆ°è¿™ä¸ªæ•°é‡æ‰ä¼šé‡æ–°å¼€å§‹è¿è¡Œã€‚\nåœ¨æœ¬ lab ä¸­ï¼Œä½ å°†æŠŠ Raft å®ç°ä¸ºä¸€ä¸ªå¸¦æœ‰ç›¸å…³æ–¹æ³•çš„ GO çš„å¯¹è±¡ç±»å‹ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½åœ¨æ›´å¤§çš„æ¨¡å—ä¸­ä½¿ç”¨ã€‚ ä¸€ç»„ Raft å®ä¾‹é€šè¿‡ RPC æ¥ç»´æŠ¤ replicated logsã€‚ä½ çš„ Raft å®ä¾‹å°†æ”¯æŒä¸€è¿ä¸²ä¸ç¡®å®šç¼–å·çš„ commandï¼Œ ä¹Ÿå¯ä»¥å« log entriesã€‚ è¿™äº› entity é€šè¿‡ index(ç´¢å¼•)æ¥è¿›è¡Œç¼–å·ã€‚å…·æœ‰ç»™å®šç´¢å¼•çš„ log entry å°†è¢« commitï¼Œ æ­¤æ—¶ï¼Œæ‚¨çš„ Raft åº”è¯¥å°†è¿™æ¡ log å‘é€åˆ° larger service ä¸Šæ‰§è¡Œã€‚\nä½ åº”è¯¥éµå¾ª\u0026nbsp;extended Raft paper ä¸­è®¾è®¡ï¼Œ ç‰¹åˆ«æ˜¯\u0026nbsp;å›¾2 .ä½ å°†å®ç°è®ºæ–‡ä¸­çš„å¤§éƒ¨åˆ†å†…å®¹ï¼ŒåŒ…æ‹¬ä¿å­˜æŒä¹…åŒ–çŠ¶æ€å’ŒèŠ‚ç‚¹æ•…éšœè‡ªåŠ¨é‡å¯åè¯»å–çŠ¶æ€ã€‚ ä½ å°†ä¸ä¼šå®ç°é›†ç¾¤æˆå‘˜çš„å˜åŒ–(Section 6)ã€‚\nä½ å¯èƒ½ä¼šå‘ç°è¿™ä¸ª\u0026nbsp;æŒ‡å— å¾ˆæœ‰ç”¨ï¼Œ è¿˜æœ‰è¿™ä¸ªå…³äºconcurrencyçš„\u0026nbsp;é” å’Œ\u0026nbsp;ç»“æ„ çš„å»ºè®®ï¼Œ å¦‚æœéœ€è¦æ›´å¹¿æ³›çš„è§†è§’ï¼Œå¯ä»¥çœ‹çœ‹ Paxos,Chubby,Paxos Made Live,Spanner,Zookeeper,Harp,Viewstamped Replication å’Œ\u0026nbsp;Bolosky et al ã€‚\nè¯·è®°ä½ï¼Œæœ¬ lab ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„éƒ¨åˆ†å¯èƒ½ä¸æ˜¯å®ç°ä½ çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯è°ƒè¯•å®ƒã€‚ä¸ºäº†å¸®åŠ©åº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œä½ å¯èƒ½éœ€è¦æŠŠäº‹ä»¶èŠ±åœ¨å¦‚ä½•ä½¿ä½ çš„å®ç°æ›´å®¹æ˜“è°ƒè¯•ã€‚ ä½ å¯ä»¥å‚è€ƒ\u0026nbsp;æŒ‡å¯¼é¡µ å’Œè¿™ç¯‡å…³äºæœ‰æ•ˆæ‰“å°å£°æ˜çš„\u0026nbsp;åšæ–‡ ã€‚\næˆ‘ä»¬è¿˜æä¾›äº†\u0026nbsp;Raft äº¤äº’å›¾ ï¼Œ å¯ä»¥å¸®åŠ©é˜æ˜Raftä»£ç å¦‚ä½•ä¸ä¸Šå±‚(ä½¿ç”¨è€…?)äº¤äº’ã€‚\nThe code é€šè¿‡å‘raft/raft.goæ·»åŠ ä»£ç æ¥å®ç°Raftã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œä½ ä¼šå‘ç°éª¨æ¶ä»£ç ï¼Œä»¥åŠå¦‚ä½•å‘é€å’Œæ¥æ”¶ RPC çš„ä¾‹å­ã€‚ ä½ çš„å®ç°å¿…é¡»æ”¯æŒä»¥ä¸‹æ¥å£ï¼Œæµ‹è¯•è€…å’Œ(æœ€ç»ˆ)ä½ çš„ key/value service å°†ä½¿ç”¨è¯¥æ¥å£ã€‚ä½ å¯ä»¥åœ¨raft.goçš„æ³¨é‡Šä¸­æ‰¾åˆ°æ›´å¤šç»†èŠ‚ã€‚\nTIP Raft å®ä¾‹åªèƒ½é€šè¿‡ rpc è¿›è¡Œé€šä¿¡ä¸”å¿…é¡»ä½¿ç”¨labrpcè¿™ä¸ªåŒ…(ä¾‹å¦‚ä¸èƒ½ä½¿ç”¨æ–‡ä»¶ä»¥åŠå…±äº«å˜é‡)ã€‚ // create a new Raft server instance: rf := Make(peers, me, persister, applyCh) // start agreement on a new log entry: rf.Start(command interface{}) (index, term, isleader) // ask a Raft for its current term, and whether it thinks it is leader rf.GetState() (term, isLeader) // each time a new entry is committed to the log, each Raft peer // should send an ApplyMsg to the service (or tester). type ApplyMsg Make Make(peers []*labrpc.ClientEnd, me int,persister *Persister, applyCh chan ApplyMsg)\nç”¨äºåˆ›å»º Raft serverã€‚\næ‰€æœ‰çš„ raft server çš„ç«¯å£éƒ½åœ¨peers[]å­˜æ”¾(åŒ…æ‹¬å½“å‰çš„æœåŠ¡)ï¼Œå½“å‰æœåŠ¡çš„ç«¯å£å¯ä»¥é€šè¿‡peers[me]æ¥è·å–ã€‚ æ‰€æœ‰çš„æœåŠ¡çš„perrs[]æ•°ç»„éƒ½å…·æœ‰ç›¸åŒçš„é¡ºåºã€‚ presisteræ˜¯ä¸€ä¸ªç”¨æ¥å­˜æ”¾persistent stateçš„åœ°æ–¹ï¼Œå¹¶ä¸”åœ¨åˆå§‹çš„æ—¶å€™ä¼šä¿å­˜æœ€å…·çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰ã€‚ applyChæ˜¯ service æˆ– tester å‘é€æ¶ˆæ¯ç»™ raft çš„é€šé“ã€‚Make() å¿…é¡»å¿«é€Ÿè¿”å›ï¼Œæ‰€ä»¥å®ƒåº”è¯¥ä¸ºä¸€äº›é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡å¯åŠ¨goruntinesã€‚ Start ä½¿ç”¨ Raft çš„æœåŠ¡ï¼ˆä¾‹å¦‚ kv æœåŠ¡å™¨ï¼‰å¸Œæœ›å°±ä¸‹ä¸€ä¸ªè¦é™„åŠ åˆ° Raft æ—¥å¿—çš„å‘½ä»¤å¼€å§‹åè®®ã€‚å¦‚æœæ­¤æœåŠ¡å™¨ä¸æ˜¯é¢†å¯¼è€…ï¼Œåˆ™è¿”å› falseã€‚å¦åˆ™å¯åŠ¨åè®®å¹¶ç«‹å³è¿”å›ã€‚æ— æ³•ä¿è¯æ­¤å‘½ä»¤å°†æ°¸è¿œæäº¤åˆ° Raft æ—¥å¿—ï¼Œå› ä¸ºé¢†å¯¼è€…å¯èƒ½ä¼šå¤±è´¥æˆ–å¤±å»é€‰ä¸¾ã€‚å³ä½¿ Raft å®ä¾‹è¢«æ€æ­»ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿåº”è¯¥ä¼˜é›…åœ°è¿”å›ã€‚ç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯è¯¥å‘½ä»¤åœ¨æäº¤æ—¶å°†å‡ºç°çš„ç´¢å¼•ã€‚ç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯å½“å‰æœ¯è¯­ã€‚å¦‚æœæ­¤æœåŠ¡å™¨è®¤ä¸ºå®ƒæ˜¯é¢†å¯¼è€…ï¼Œåˆ™ç¬¬ä¸‰ä¸ªè¿”å›å€¼ä¸º trueã€‚\nStart(command interface{}) (int, int, bool)\nä½¿ç”¨ Raft çš„æœåŠ¡(e.g k/v server)å¸Œæœ›å°±ä¸‹ä¸€ä¸ªè¦è¿½åŠ åˆ° Raft æ—¥å¿—çš„å‘½ä»¤å¼€å§‹åè®®ã€‚ å¦‚æœå½“å‰ Raft server ä¸æ˜¯ leader åˆ™è¿”å›falseã€‚å¦åˆ™å¯åŠ¨åè®®å¹¶ç«‹å³è¿”å›ï¼Œæ— éœ€ç­‰å¾…æ—¥å¿—è¿½åŠ å®Œæˆã€‚ æ‰€ä»¥æ— æ³•ä¿è¯æ­¤å‘½ä»¤å°†ä¸€å®šä¼šè¢«æäº¤åˆ° Raft æ—¥å¿—ä¸­ï¼Œå› ä¸º leader å¯èƒ½ä¼šå¤±è´¥æˆ–è€…åœ¨è¾“æ‰é€‰ä¸¾ã€‚ å³ä½¿ Raft å®ä¾‹è¢« kill è¿™ä¸ªå‡½æ•°ä¹Ÿåº”è¯¥ return gracefully(ä¼˜é›…è¿”å›)ã€‚\nç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯è¯¥å‘½ä»¤åœ¨ commit æ—¶å°†è¢«è®¾ç½®çš„ indexã€‚ç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯å½“å‰çš„ term(ä»»æœŸ)ã€‚å¦‚æœæ­¤æœåŠ¡å™¨è®¤ä¸ºè‡ªå·±æ˜¯ leader åˆ™ç¬¬ä¸‰ä¸ªè¿”å›å€¼æ˜¯trueã€‚\næ¯ä¸ªæ–°æäº¤çš„Raft log entityéƒ½åº”è¯¥å‘é€ä¸€ä¸ªAppliMsgåˆ°Make()çš„applyChä¸­ã€‚\n2A - Leader Election å®ç° Raft leader election ä»¥åŠ heartbeats(AppendEntries RPCsä¸­ä¸é™„å¸¦ log entries)ã€‚\n2Açš„ç›®æ ‡æ˜¯: é€‰å‡ºä¸€ä¸ª leaderï¼Œå¦‚æœæ²¡æœ‰ failureï¼Œå®ƒä»ç„¶æ˜¯ leaderï¼Œ å¦‚æœ old leader å¤±è´¥æˆ–è€…ä¸ old leader ä¹‹é—´çš„æ•°æ®åŒ…å‘ç”Ÿä¸¢å¤±åˆ™ç”± new leader æ¥ç®¡ã€‚\nTIP è¿™ä¸ªå¤±è´¥æ˜¯ leader å‡ºç°æ•…éšœçš„æ„æ€ï¼Ÿå°±æ˜¯è¯´åªè¦å®ƒæ²¡å‡ºç°è¿è¡Œæ•…éšœæˆ–è€…ç½‘ç»œé—®é¢˜å°±æ°¸è¿œæ˜¯leaderï¼Ÿ è¦ç‚¹:\né€šè¿‡è¿è¡Œgo test -run 2Aæ¥è¿›è¡Œæµ‹è¯•ä½ çš„å®ç°ã€‚ æŒ‰ç…§è®ºæ–‡çš„\u0026nbsp;å›¾2 ï¼Œä¸»è¦å…³å¿ƒå‘é€å’Œæ¥æ”¶RequestVote RPCs ï¼Œä¸the Rules for Servers that relate to elections ä»¥åŠthe State related to leader electionã€‚ æ·»åŠ \u0026nbsp;å›¾2 ä¸­ä¸ leader election ç›¸å…³çš„çŠ¶æ€åˆ°Raftè¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œä¸”è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªç»“æ„æ¥ä¿å­˜æ¯ä¸ªæ—¥å¿—çš„ä¿¡æ¯ã€‚ å®ç°RequestVote()ï¼Œè¿™æ · raft æœåŠ¡ä»¬å°±èƒ½äº’ç›¸æŠ•ç¥¨äº†ã€‚æ·»åŠ RequestVOteArgså’ŒRequestVoteReplyè€…ä¸¤ä¸ªç»“æ„ä½“ã€‚ä¿®æ”¹Make() ï¼Œåˆ›å»ºä¸€ä¸ª goroutineï¼Œç”¨äºæ£€æŸ¥å¿ƒè·³æ¶ˆæ¯ï¼Œå¦‚æœæœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ° peer çš„æ¶ˆæ¯æ—¶å°†å‘é€RequestVote RPCsæ¥å®šæœŸå‘èµ·é¢†å¯¼è€…é€‰ä¸¾ã€‚è¿™æ ·ï¼Œå¦‚æœæœ‰ leader äº†ï¼Œpeer å°†çŸ¥é“è°æ˜¯ leaderï¼Œæˆ–è€…è‡ªå·±æˆä¸º leaderã€‚ å®ç°å¿ƒè·³ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªAppendEntries RPCç»“æ„(å°½ç®¡ä½ å¯èƒ½è¿˜ä¸éœ€è¦æ‰€æœ‰å‚æ•°)ï¼Œ å¹¶ä¸”è®© leader å®šæœŸå‘é€å®ƒã€‚ç¼–å†™ä¸€ä¸ªAppendEntries RPCçš„ handle methodï¼Œç”¨äºé‡ç½®é€‰ä¸¾è¶…æ—¶ï¼Œ è¿™æ ·å½“æœ‰ä¸€ä¸ªäººå·²ç»å½“é€‰æ—¶ï¼Œå…¶ä»–æœåŠ¡å™¨ä¸ä¼šåˆæˆä¸º leaderã€‚ ç¡®ä¿ä¸åŒ peer çš„é€‰ä¸¾è¶…æ—¶ä¸åœ¨åŒä¸€æ—¶é—´å‘ç”Ÿï¼Œå¦åˆ™æ‰€æœ‰peerå°†åªä¸ºè‡ªå·±æŠ•ç¥¨ï¼Œè¿™æ ·å°±æ²¡æœ‰äººä¼šæˆä¸ºleaderäº†ã€‚ åœ¨æµ‹è¯•æ—¶ï¼Œleader æ¯ç§’å‘é€çš„RPCè¯·æ±‚ä¸èƒ½è¶…è¿‡ 10 æ¬¡ã€‚ åœ¨æµ‹è¯•æ—¶ï¼Œè¦æ±‚ Raft åœ¨ old leader å¤±è´¥å5ç§’å†…é€‰ä¸¾ new leader(å¦‚æœå¤§å¤šæ•°èŠ‚ç‚¹ä»ç„¶èƒ½ç»§ç»­é€šè®¯)ã€‚ ä½†æ˜¯è¯·è®°ä½ï¼Œå¦‚æœå‡ºç°split vote(å¦‚æœæ•°æ®åŒ…ä¸¢å¤±æˆ–è€…å€™é€‰äººé€‰æ‹©äº†ç›¸åŒçš„éšæœºé€€é¿æ—¶é—´å°±æœ‰å¯èƒ½å‘ç”Ÿ)ï¼Œleader é€‰ä¸¾å¯èƒ½éœ€è¦å¤šè½®ã€‚ æ‰€ä»¥å¿…é¡»è®¾ç½®è¶³å¤ŸçŸ­çš„é€‰ä¸¾è¶…æ—¶(ä¹Ÿå°±æ˜¯å¿ƒè·³é—´éš”)ï¼Œå³ä½¿ä¼šé€‰ä¸¾å¤šè½®ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨5ç§’å†…å®Œæˆã€‚ è®ºæ–‡çš„\u0026nbsp;Leader election è¿™ä¸€èŠ‚ä¸­æåˆ°çš„é€‰ä¸¾è¶…æ—¶èŒƒå›´æ˜¯150åˆ°300æ¯«ç§’ã€‚ åªæœ‰å½“ leader å‘é€å¿ƒè·³çš„é¢‘ç‡å¤§å¤§é«˜äº150æ¯«ç§’ä¸€æ¬¡æ—¶ï¼Œä¸Šé¢æåˆ°çš„èŒƒå›´æ‰æœ‰æ„ä¹‰ã€‚ç”±äºåœ¨æµ‹è¯•æ—¶é™åˆ¶æ¯ç§’10æ¬¡å¿ƒè·³ï¼Œ æ‰€ä»¥å¿…é¡»ä½¿ç”¨æ¯”è®ºæ–‡ä¸­æ›´å¤§çš„é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯ä¸èƒ½å¤ªå¤§ï¼Œå› ä¸ºå¯èƒ½ä¼šæ— æ³•åœ¨5ç§’å†…å®Œæˆé€‰ä¸¾ã€‚ å¦‚æœæ‚¨çš„ä»£ç æ— æ³•é€šè¿‡æµ‹è¯•ï¼Œè¯·å†æ¬¡é˜…è¯»è®ºæ–‡ä¸­çš„\u0026nbsp;å›¾2 ï¼Œleader é€‰ä¸¾çš„å…¨éƒ¨é€»è¾‘åˆ†å¸ƒåœ¨å›¾ä¸­å¤šä¸ªéƒ¨åˆ†ã€‚ ä¸è¦å¿˜è®°å®ç°GetState()ã€‚ åœ¨æµ‹è¯•æ—¶ï¼Œå¦‚æœè¦å…³é—­ä¸€ä¸ªraftå®ä¾‹ï¼Œä¼šè°ƒç”¨rf.kill()ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨rf.killedæ¥æ£€æŸ¥æ˜¯å¦è¢«è°ƒç”¨äº†kill()ã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨æ‰€æœ‰çš„å¾ªç¯ä¸­éƒ½è¿™æ · åšï¼Œä»¥é¿å…æ­»äº¡çš„Raftå®ä¾‹æ‰“å°æ··ä¹±çš„ä¿¡æ¯ã€‚ go RPCåªå‘é€åç§°ä»¥å¤§å†™å­—æ¯å¼€å¤´çš„ç»“æ„ä½“å­—æ®µã€‚å­ç»“æ„ä½“ä¹Ÿå¿…é¡»æ‹¥æœ‰å¤§å†™çš„å­—æ®µåã€‚ 2B - log å®ç° leader ä»¥åŠ follower çš„ä»£ç æ¥æ·»åŠ æ–°çš„æ—¥å¿—ã€‚\nè¦ç‚¹:\nä½ çš„é¦–è¦ç›®æ ‡å°±æ˜¯é€šè¿‡TestBasicAgree2Bã€‚ä»å®ç°Start()å¼€å§‹ï¼Œæ ¹æ®\u0026nbsp;å›¾2 ï¼Œç¼–å†™ä»£ç ï¼Œ é€šè¿‡AppendEntrieså‘é€å’Œæ¥æ”¶æ–°çš„æ—¥å¿—ã€‚å‘é€æœ€è¿‘æäº¤çš„æ—¥å¿—åˆ°å¯¹æ–¹çš„applyChä¸­ éœ€è¦å®ç°election restriction åœ¨æ—©æœŸçš„ Lab 2B æµ‹è¯•ä¸­æœªèƒ½è¾¾æˆåè®®çš„ä¸€ç§æ–¹æ³•æ˜¯: å³æ—¶ leader è¿˜å­˜æ´»ä¹Ÿè¦é‡å¤è¿›è¡Œé€‰ä¸¾ã€‚ åœ¨ election timer ä¸­æ‰¾ bugï¼Œæˆ–è€…åœ¨èµ¢å¾—é€‰ä¸¾åä¸ç«‹å³å‘é€å¿ƒè·³çš„é—®é¢˜ã€‚ ä½ çš„ä»£ç ä¸­å¯èƒ½æœ‰é‡å¤æ£€æŸ¥æŸäº›äº‹ä»¶çš„å¾ªç¯ã€‚ä¸è¦è®©è¿™äº›å¾ªç¯è¿ç»­çš„çš„æ‰§è¡Œè€Œæ²¡æœ‰æš‚åœï¼Œè¿™å°†ä½¿ä½ çš„å®ç°æ…¢åˆ°æ— æ³•é€šè¿‡æµ‹è¯•ã€‚ ä½¿ç”¨ Go çš„\u0026nbsp;condition variables æˆ–è€…åŠ å…¥`time.sleep(10 * Millisecond)åœ¨æ¯ä¸ªå¾ªç¯ä¸­ã€‚ è¯»æ‡‚config.goä»¥åŠtest_test.goä»¥ä¾¿äº†è§£åœ¨æµ‹è¯•ä»€ä¹ˆå†…å®¹ã€‚ ä»£ç å®ç°æ€è·¯ å¤§æ¦‚è®°å½•ä¸€ä¸‹ä»£ç çš„å®ç°æ€è·¯ä»¥åŠé‡åˆ°çš„é—®é¢˜ã€‚\n2A æ ¹æ®å›¾2ä¸­çš„ state è¿™ä¸€èŠ‚æ·»åŠ å¯¹åº”çš„å±æ€§ æ·»åŠ RaftRoleå±æ€§ï¼Œä»£è¡¨å½“å‰çš„è§’è‰²: leaderï¼Œcandidateï¼Œfollower å®ç°tickerè¿™ä¸ªå‡½æ•°: å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªtime.timeræ¥ä½œä¸ºè§¦å‘å™¨ åˆ¤æ–­æ˜¯å¦å¾ˆä¹…æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œæ¥å‘èµ·é€‰ä¸¾ åˆ¤æ–­æ˜¯å¦éœ€è¦å‘é€å¿ƒè·³ï¼Œæ¥ç»´æŒè‡ªå·±çš„æƒå¨ è¿™ä¸ªæ—¶å€™è¦æ³¨æ„è¿™æ¡è§„åˆ™: å¦‚æœ RPC çš„è¯·æ±‚æˆ–è€…å“åº”ä¸­åŒ…å«ä¸€ä¸ª term T å¤§äº currentTermï¼Œåˆ™ currentTerm èµ‹å€¼ä¸º Tï¼Œ å¹¶åˆ‡æ¢çŠ¶æ€ä¸º followerã€‚ å®ç°å‘èµ·é€‰ä¸¾çš„æµç¨‹ æ ¹æ®å›¾2ä¸­çš„Rules for Serversçš„candaidteæµç¨‹ä¸€æ­¥ä¸€æ­¥å®ç° å¹¶è¡Œå‘èµ·RequestVote RPCï¼Œå¦‚æœç¥¨æ•°å¤§äº 1/2 åˆ™è½¬æ¢ä¸º leader(å¯èƒ½éœ€è¦å¹¿æ’­å¿ƒè·³)ã€‚ å®ç°RequestVote æ ¹æ®å›¾2ä¸­çš„RequestVote RPCä¸€æ­¥ä¸€æ­¥å®ç°å°±å¥½ å®ç°AppendEntries åªéœ€è¦ç®€å•çš„å®ç°è½¬æ¢ä¸º follower ä»¥åŠåˆ·æ–°é€‰ä¸¾è¶…æ—¶æ—¶é—´å³å¯ã€‚ æ‰€æœ‰èŠ‚ç‚¹æ”¶åˆ°å“åº”ååˆ·æ–°é€‰ä¸¾è¶…æ—¶æ—¶é—´(å…·ä½“æƒ…å†µå…·ä½“åˆ¤æ–­) æˆä¸º leader åå¼€å§‹åˆ·æ–°å¿ƒè·³è¶…æ—¶æ—¶é—´(æ¥åˆ·æ–° follower çš„é€‰ä¸¾è¶…æ—¶æ—¶é—´) é‡åˆ°çš„é—®é¢˜:\n1.ç¬¬ä¸€ä¸ªæµ‹è¯•ä¼šæœ‰warning: Term changed even though there were no failureså‡ºç°\nå°±æ˜¯åœ¨æœ‰ä¸€ä¸ª leader çš„æ—¶å€™å…¶ä»– follower è¿˜æ˜¯å‘èµ·äº†é€‰ä¸¾ã€‚çŒœæµ‹åŸå› æ˜¯election timeoutå’ŒAppendEntriesçš„æ—¶é—´ç‚¹å¾ˆé‚»è¿‘ï¼Œè¿™ä¸ªåªèƒ½è°ƒè¯• ä¸¤ç§è¶…æ—¶æ—¶é—´ï¼Œæˆ‘çš„é€‰ä¸¾è¶…æ—¶æ—¶é—´æ˜¯ 200~350msï¼Œå¿ƒè·³å›ºå®šåœ¨ 125msã€‚\nç„¶åæˆ‘åœ¨è½¬æ¢è§’è‰²çš„æ—¶å€™åŠ äº†ä¸€ä¸ªif new role == old role then returnçš„åˆ¤æ–­ï¼Œè¿™é‡Œå¯¼è‡´election timeoutæ²¡æœ‰åˆ·æ–°ã€‚\n2.åœ¨å“åº”æˆ–è¯·æ±‚æ—¶è¦ç¬¬ä¸€æ—¶é—´å¤„ç†ç¬¬4æ¡ã€‚\nRaftè®ºæ–‡ç¿»è¯‘ é€‰å–ä¸€äº›é‡è¦çš„ç‰‡æ®µè¿›è¡Œç¿»è¯‘\noriginalåœ°å€: \u0026nbsp;https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf Abstract Raft æ˜¯ä¸€ç§ä¸ºäº†ç®¡ç†å¤åˆ¶æ—¥å¿—çš„å…±è¯†ç®—æ³•ã€‚å®ƒæä¾›äº†å’Œ Paxos ç®—æ³•ç›¸åŒçš„åŠŸèƒ½å’Œæ€§èƒ½ï¼Œä½†å®ƒçš„ç®—æ³•ç»“æ„å’Œ Paxos ä¸åŒï¼Œ Raft æ›´å®¹æ˜“ç†è§£å¹¶ä¸”æ›´å®¹æ˜“æ„å»ºå®é™…çš„ç³»ç»Ÿã€‚ä¸ºäº†æå‡å¯ç†è§£æ€§ï¼ŒRaft å°†å…±è¯†ç®—æ³•åˆ†æˆäº†å‡ ä¸ªå…³é”®çš„æ¨¡å—ï¼Œä¾‹å¦‚é¢†å¯¼äººé€‰ä¸¾ï¼Œæ—¥å¿—å¤åˆ¶å’Œå®‰å…¨æ€§ã€‚ åŒæ—¶å®ƒé€šè¿‡å®æ–½ä¸€ä¸ªæ›´å¼ºçš„ä¸€è‡´æ€§æ¥å‡å°‘éœ€è¦è€ƒè™‘çš„çŠ¶æ€çš„æ•°é‡ã€‚Raft è¿˜åŒ…æ‹¬ä¸€ä¸ªæœºåˆ¶æ¥å…è®¸é›†ç¾¤æˆå‘˜çš„åŠ¨æ€æ”¹å˜ï¼Œå®ƒåˆ©ç”¨é‡å çš„å¤§å¤šæ•°æ¥ä¿è¯å®‰å…¨æ€§ã€‚\nIntroduction Raft ç®—æ³•å’Œå·²ç»å­˜åœ¨çš„å…±è¯†ç®—æ³•åœ¨æŸäº›åœ°æ–¹å¾ˆç›¸ä¼¼(ä¸»è¦æ˜¯ Oki ä»¥åŠ Liskov\u0026rsquo;s Viewstamped Replication)ï¼Œä½†æ˜¯å®ƒæœ‰ä»¥ä¸‹æ–°ç‰¹æ€§:\nå¼ºé¢†å¯¼è€…: Raft ä½¿ç”¨ä¸€ç§æ¯”å…¶ä»–å…±è¯†ç®—æ³•æ›´å¼ºçš„é¢†å¯¼å½¢å¼ã€‚ä¾‹å¦‚ï¼Œæ—¥å¿—åªä» leader å‘é€ç»™å…¶ä»–æœåŠ¡å™¨ã€‚ è¿™ç®€åŒ–äº†å¯¹å¤åˆ¶æ—¥å¿—çš„ç®¡ç†å¹¶ä½¿å¾— Raft æ›´å®¹æ˜“ç†è§£ã€‚ é¢†å¯¼é€‰ä¸¾: Raft ä½¿ç”¨éšæœºçš„è®¡æ—¶å™¨æ¥é€‰å– leaderã€‚è¿™ç§æ–¹å¼ä»…ä»…æ˜¯åœ¨æ‰€æœ‰å…±è¯†ç®—æ³•éƒ½éœ€è¦æ”¹è¿›çš„å¿ƒè·³æœºåˆ¶ä¸Šæœ‰äº›è®¸æ”¹è¿›ï¼Œç„¶è€Œè¿™ä½¿å¾— Raft åœ¨è§£å†³å†²çªæ—¶æ›´ç®€å•å’Œå¿«é€Ÿã€‚ æˆå‘˜è°ƒæ•´: Raft ä½¿ç”¨äº†æ–°çš„è”åˆå…±è¯†(join consensus)ç®—æ³•æ¥å¤„ç†é›†ç¾¤æˆå‘˜å˜æ¢çš„é—®ï¼Œ åœ¨å¤„äºè°ƒæ•´è¿‡ç¨‹ä¸­çš„ä¸¤ç§ä¸åŒçš„é…ç½®çš„å¤§å¤šæ•°é›†ç¾¤ä¼šæœ‰é‡å (overlap)ï¼Œè¿™å°±å…è®¸é›†ç¾¤åœ¨æˆå‘˜å˜æ›´çš„æ—¶å€™ï¼ŒæŒç»­æ­£å¸¸è¿è¡Œã€‚ Replicated State Machine Replicated State Machine(å¤åˆ¶çŠ¶æ€æœº)åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¢«ç”¨äºè§£å†³å„ç§å®¹é”™é—®é¢˜ã€‚ä¾‹å¦‚ GFSã€HDFSã€RAMCloud ç­‰å• leader çš„å¤§å‹é›†ç¾¤ç³»ç»Ÿï¼Œ é€šå¸¸ä½¿ç”¨ç‹¬ç«‹çš„å¤åˆ¶çŠ¶æ€æœºæ¥ç®¡ç†é¢†å¯¼é€‰ä¸¾å’Œå­˜å‚¨é…ç½®ä¿¡æ¯æ¥ä¿è¯åœ¨ leader å´©æºƒçš„æƒ…å†µä¸‹ä¹Ÿè¦å­˜æ´»ä¸‹æ¥ï¼Œå¤åˆ¶çŠ¶æ€æœºçš„ä¾‹å­åŒ…æ‹¬ Chubby ä»¥åŠ Zookeeperã€‚\nFigure 1: å¤åˆ¶çŠ¶æ€æœºæ¶æ„ã€‚å…±è¯†ç®—æ³•ç®¡ç†æ¥è‡ªå®¢æˆ·ç«¯çš„åŒ…å«çŠ¶æ€æœºå‘½ä»¤çš„å¤åˆ¶æ—¥å¿—ï¼ŒçŠ¶æ€æœºæŒ‰ç…§ç›¸åŒçš„é¡ºåºæ¥å¤„ç†å®ƒä»¬ï¼Œæ‰€ä»¥å®ƒä»¬äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚ å…±è¯†ç®—æ³•æ˜¯åœ¨å¤åˆ¶çŠ¶æ€æœºçš„èƒŒæ™¯ä¸‹æå‡ºçš„ï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œåœ¨ä¸€ç»„æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€æœºå¯¹åŒä¸€ä¸ªçš„çŠ¶æ€ä¼šè®¡ç®—å‡ºç›¸åŒçš„å‰¯æœ¬ï¼Œå¹¶ä¸”åœ¨ä¸€äº›æœåŠ¡å™¨å®•æœºçš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç»§ç»­è¿è¡Œã€‚\nå¦‚å›¾ä¸€æ‰€ç¤ºï¼Œå¤åˆ¶çŠ¶æ€æœºæ˜¯é€šè¿‡å¤åˆ¶æ—¥å¿—å®ç°çš„ã€‚æ¯ä¸ªæœåŠ¡å™¨ä¿å­˜è€…ä¸€ä¸ªåŒ…å«ä¸€ç³»åˆ—å‘½ä»¤çš„æ—¥å¿—ï¼Œå…¶çŠ¶æ€æœºæŒ‰ç…§é¡ºåºæ¥æ‰§è¡Œå®ƒä»¬ã€‚ æ¯ä¸ªæ—¥å¿—åŒ…å«ç›¸åŒé¡ºåºçš„ç›¸åŒå‘½ä»¤ï¼Œæ‰€ä»¥æ¯ä¸ªçŠ¶æ€æœºéƒ½æ‰§è¡Œç›¸åŒçš„å‘½ä»¤åºåˆ—ã€‚å› ä¸ºçŠ¶æ€æœºæ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥æ¯ä¸ªçŠ¶æ€æœºä¼šè®¡ç®—å‡ºç›¸åŒçš„çŠ¶æ€å’Œç›¸åŒé¡ºåºçš„è¾“å‡ºã€‚\nå…±è¯†ç®—æ³•çš„ä»»åŠ¡æ˜¯ ä¿è¯å¤åˆ¶æ—¥å¿—çš„ä¸€è‡´æ€§ ã€‚æœåŠ¡å™¨ä¸Šçš„å…±è¯†æ¨¡å—æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤å¹¶æŠŠå®ƒä»¬æ·»åŠ åˆ°æ—¥å¿—ä¸­ï¼Œ å¹¶ä¸å…¶ä»–æœåŠ¡å™¨ä¸Šçš„å…±è¯†æ¨¡å—è¿›è¡Œé€šè®¯ä»¥ç¡®ä¿å®ƒä»¬çš„æ¯ä¸€æ¡æ—¥å¿—æœ€ç»ˆéƒ½ç›¸åŒ(ç›¸åŒçš„è¯·æ±‚æœ‰ç›¸åŒçš„é¡ºåº)ï¼Œå³ä½¿æœ‰ä¸€äº›æœåŠ¡å‘ç”Ÿæ•…éšœã€‚ ä¸€æ—¦å‘½ä»¤è¢«æ­£ç¡®çš„å¤åˆ¶ï¼Œæ¯ä¸€ä¸ªæœåŠ¡çš„çŠ¶æ€æœºä¼šæŒ‰ç…§æ—¥å¿—çš„é¡ºåºå»å¤„ç†å®ƒä»¬ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nå› æ­¤ï¼Œè¿™äº›æœåŠ¡ä¼¼ä¹æˆä¸ºäº†ä¸€ä¸ªå•ä¸€çš„ï¼Œé«˜åº¦å¯é çš„çŠ¶æ€æœºã€‚\nåœ¨å®é™…çš„å…±è¯†ç®—æ³•é€šå¸¸æœ‰ä»¥ä¸‹å±æ€§:\nç¡®ä¿éæ‹œå åº­(non-Byzantine)æ¡ä»¶ä¸‹çš„å®‰å…¨æ€§(æ°¸è¿œä¸è¿”å›é”™è¯¯çš„ç»“æœ)ï¼ŒåŒ…æ‹¬ç½‘ç»œå»¶è¿Ÿï¼Œåˆ†åŒºä»¥åŠç½‘ç»œæ•°æ®åŒ…ä¸¢å¤±ã€å†—ä½™ã€ä¹±åºã€‚ åªè¦å¤§å¤šæ•°çš„æœåŠ¡éƒ½åœ¨è¿è¡Œå¹¶èƒ½ç›¸äº’é€šä¿¡ä¸”å’Œå®¢æˆ·ç«¯é€šä¿¡ï¼Œå®ƒä»¬å°±èƒ½å‘æŒ¥å‡ºå…¨éƒ¨çš„åŠŸèƒ½(å¯ç”¨æ€§)ã€‚å› æ­¤ï¼Œä¸€ä¸ª5å°æœåŠ¡çš„é›†ç¾¤èƒ½å®¹å¿2å°æœåŠ¡å‡ºç°æ•…éšœã€‚ å‡å®šæœåŠ¡åº”ä¸ºåœæœºè€Œå‡ºç°æ•…éšœï¼Œå®ƒä»¬å¯èƒ½ç¨åä¼šä»stable storageä¸­æ¢å¤çŠ¶æ€å¹¶ä»æ–°åŠ å…¥é›†ç¾¤ã€‚ ä¸ä¾èµ–ä¸æ—¶åºæ¥ä¿è¯æ—¥å¿—çš„ä¸€è‡´æ€§: é”™è¯¯çš„æ—¶é’Ÿå’Œæç«¯çš„ä¿¡æ¯å»¶è¿Ÿå»¶è¿Ÿåœ¨æœ€åçš„æƒ…å†µä¸‹ä¼šå¯¼è‡´å¯ç”¨æ€§é—®é¢˜ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå‘½ä»¤çš„å®Œæˆåœ¨äºé›†ç¾¤ä¸­çš„å¤§å¤šæ•°å¯¹å•è½®è¿œç¨‹è°ƒç”¨ä½œå‡ºå“åº”ï¼Œå°‘æ•°æ¯”è¾ƒæ…¢çš„æœåŠ¡ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚ The Raft consensus algorithm Raftå°±æ˜¯ç”¨äºç®¡ç†ä¸Šä¸€è§£æè¿°çš„å¤åˆ¶æ—¥å¿—çš„ç®—æ³•ã€‚\u0026nbsp;å›¾2 æ˜¯å¯¹è¯¥ç®—æ³•çš„ç²¾ç®€å‹å¼çš„æ€»ç»“ï¼Œ\u0026nbsp;å›¾3 åˆ—å‡ºæ¥è¯¥ç®—æ³•çš„å…³é”®å±æ€§ï¼Œæ¥ä¸‹æ¥å¯¹è¿™äº›éƒ¨åˆ†è¿›è¡Œé€ä¸€è®¨è®ºã€‚\nRaft é€šè¿‡é€‰å‡ºä¸€ä½ leader ç„¶åç»™äºˆå®ƒå®Œå…¨ç®¡ç†æ—¥å¿—å¤åˆ¶çš„è´£ä»»æ¥å®ç°å…±è¯†ã€‚leader æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ—¥å¿—ï¼Œç„¶åå¤åˆ¶ç»™å…¶ä»–æœåŠ¡ï¼Œå¹¶ä¸”é€šçŸ¥åœ¨ä½•æ—¶ å®ƒä»¬å¯ä»¥å®‰å…¨çš„æ¶ˆè´¹(ä½œç”¨åˆ°çŠ¶æ€æœºä¸Š)è¿™äº›æ—¥å¿—ã€‚leader ç®€åŒ–äº†æ—¥å¿—å¤åˆ¶çš„ç®¡ç†ã€‚ä¾‹å¦‚: leader å¯ä»¥è‡ªä¸»ç¡®å®šæ–°æ—¥å¿—å­˜æ”¾åœ¨å“ªä¸ªä½ç½®è€Œä¸ç”¨è¯¢é—®å…¶ä»–æœåŠ¡ï¼Œ å¹¶ä¸”æ•°æ®éƒ½ä» leader æµå‘å…¶ä»–æœåŠ¡å™¨ã€‚leader å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœï¼Œæˆ–è€…å’Œå…¶ä»–æœåŠ¡å™¨å¤±å»è¿æ¥ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦é‡æ–°é€‰ä¸¾ leaderã€‚\nåŸºäº leader çš„æ–¹æ³•ï¼ŒRaft å°†ä¸€è‡´æ€§é—®é¢˜ä¸ºäº†ä¸‰ä¸ªå­è¿‡ç¨‹æ¥è§£å†³:\nleader é€‰ä¸¾: å½“ leader å¤±è´¥(å®•æœº)æ—¶éœ€è¦é€‰ä¸¾æ–° leader æ—¥å¿—å¤åˆ¶: leader æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ—¥å¿—ï¼Œå¹¶å¤åˆ¶ç»™é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ï¼Œå¼ºåˆ¶å…¶ä»–æœåŠ¡å™¨ä¸è‡ªå·±çš„ä¸€è‡´ å®‰å…¨: Raft çš„å®‰å…¨å°±åœ¨äº\u0026nbsp;å›¾3 ä¸­çš„å®‰å…¨å±æ€§: å¦‚æœä»»ä½•æœåŠ¡å™¨æ¶ˆè´¹äº†ä¸€ä¸ªæ—¥å¿—ï¼Œé‚£ä¹ˆå…¶ä»–ä»»ä½•æœåŠ¡å™¨å°±ä¸ èƒ½åœ¨ç›¸åŒçš„æ—¥å¿—ç´¢å¼•æ¶ˆè´¹ä¸åŒçš„æ—¥å¿— Figure 2 Figure 2: Raftå…±è¯†ç®—æ³•çš„ç²¾ç®€æ‘˜è¦(ä¸åŒ…æ‹¬æˆå‘˜æ›´æ”¹ä»¥åŠæ—¥å¿—å‹ç¼©)ã€‚å·¦ä¸Šè§’çš„æœåŠ¡å™¨è¡Œä¸ºè¢«æè¿°ä¸ºä¸€ç»„ç‹¬ç«‹ä¸”é‡å¤è§¦å‘çš„è§„åˆ™ã€‚ state:\nåœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸ŠæŒä¹…åŒ–(åœ¨å“åº” RPC è¯·æ±‚ä¹‹å‰ï¼Œå·²ç»æ›´æ–°åˆ°äº†ç¨³å®šçš„å­˜å‚¨è®¾å¤‡) currentTerm: æœåŠ¡å™¨å·²çŸ¥æœ€æ–°çš„ä»»æœŸï¼ˆåœ¨æœåŠ¡å™¨é¦–æ¬¡å¯åŠ¨æ—¶åˆå§‹åŒ–ä¸º0ï¼Œå•è°ƒé€’å¢ï¼‰ votedFor: å½“å‰ä»»æœŸå†…æ”¶åˆ°é€‰ç¥¨çš„ candidate Idï¼Œå¦‚æœæ²¡æœ‰æŠ•ç»™ä»»ä½•å€™é€‰äººåˆ™ä¸ºç©º log[]: æ—¥å¿—æ¡ç›®,æ¯ä¸ªæ¡ç›®åŒ…å«äº†ç”¨äºçŠ¶æ€æœºçš„å‘½ä»¤ï¼Œä»¥åŠé¢†å¯¼äººæ¥æ”¶åˆ°è¯¥æ¡ç›®æ—¶çš„ä»»æœŸ(åˆå§‹ç´¢å¼•ä¸º1) æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ˜“å¤±æ€§çŠ¶æ€ commitIndex: å·²çŸ¥çš„æäº¤çš„æ—¥å¿—ä¸­çš„æœ€å¤§ç´¢å¼•(åˆå§‹0ï¼Œå•è°ƒé€’å¢) lastApplied: çŠ¶æ€æœºå·²ç»æ‰§è¡Œçš„æ—¥å¿—ä¸­çš„æœ€å¤§ç´¢å¼•(åˆå§‹0ï¼Œå•è°ƒé€’å¢) åœ¨ leader ä¸Šä¸ç¨³å®šå­˜åœ¨(åœ¨æ¯æ¬¡é‡æ–°é€‰ä¸¾ååˆå§‹åŒ–) nextIndex[]: å¯¹äºæ¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå‘é€åˆ°è¯¥æœåŠ¡å™¨çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ç´¢å¼•(åˆå§‹ä¸ºleaderçš„æœ€åä¸€æ¡æ—¥å¿—ç´¢å¼•+1) matchIndex[]: å¯¹äºæ¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå·²çŸ¥çš„å·²ç»å¤åˆ¶åˆ°è¯¥æœåŠ¡å™¨çš„æœ€é«˜æ—¥å¿—æ¡ç›®çš„ç´¢å¼•(åˆå§‹0ï¼Œå•è°ƒé€’å¢) AppendEntries RPC\nç”±leaderå‘èµ·è°ƒç”¨æ¥å¤åˆ¶æ—¥å¿—ï¼ŒåŒæ—¶ä¹Ÿç”¨äºå¿ƒè·³æ£€æµ‹\nArguments: term: leader çš„ä»»æœŸ leaderId: ç”¨äº follower æ‰¾åˆ° leader(æœ‰æ—¶ client æŠŠè¯·æ±‚å‘é€ç»™äº† follower) prevLogIndex: ç´§é‚»æ–°æ—¥å¿—æ¡ç›®ä¹‹å‰çš„é‚£ä¸ªæ—¥å¿—æ¡ç›®çš„ç´¢å¼• prevLogTerm: ç´§é‚»æ–°æ—¥å¿—æ¡ç›®ä¹‹å‰çš„é‚£ä¸ªæ—¥å¿—æ¡ç›®çš„ä»»æœŸ entries[]: éœ€è¦è¢«ä¿å­˜çš„æ—¥å¿—(ä¸ºç©ºæ—¶æ˜¯å¿ƒè·³æ£€æµ‹ï¼Œå¯èƒ½ä¸€æ¬¡ä¼šå‘é€å¤šæ¡æ¥æå‡æ•ˆç‡) leaderCommit: leader å·²æäº¤çš„æœ€é«˜çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼• Results: term: currentTermï¼Œç”¨äº leader æ›´æ–°è‡ªå·±çš„term success: å¦‚æœfollowerçš„pervLogIndexä»¥åŠprevLogTermèƒ½å¤ŸåŒ¹é…ä¸Šåˆ™ä¸ºtrue Receiver implementation: if term \u0026lt; currentTerm then return false(å¦‚æœ leader çš„ä»»æœŸå°äºæ¥æ”¶è€…çš„å½“å‰ä»»æœŸï¼Œæ¥æ”¶è€…å¯ä»¥æ˜¯ follower ä»¥åŠ candidate) if log[prevLogIndex].term != prevLogTerm then return false(åœ¨æ¥æ”¶è€…æ—¥å¿—ä¸­ å¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªå’Œ prevLogIndex ä»¥åŠ prevLogTerm ä¸€æ ·çš„ç´¢å¼•å’Œä»»æœŸçš„æ—¥å¿—æ¡ç›®åˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤å¦åˆ™è¿”å›å‡) if log[oldIndex].term != log[newIndex].term then remove log[oldIndex,lastIndex]( å¦‚æœä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ—¥å¿—ä¸æ–°çš„æ—¥å¿—(è¯·æ±‚ä¸­çš„æ—¥å¿—æ¡ç›®)å†²çª(ç´¢å¼•ç›¸åŒï¼Œä»»æœŸä¸åŒ)ï¼Œåˆ™åˆ é™¤è¯¥ç´¢å¼•å¤„ä»¥åŠä¹‹åçš„æ‰€æœ‰æ—¥å¿—) æ·»åŠ åœ¨æ—¥å¿—åˆ—è¡¨ä¸­ä¸å­˜åœ¨çš„æ–°æ—¥å¿— if leaderCommit \u0026gt; commitIndex then commitIndex=min(leaderCommit,log[].last.commitIndex)( å¦‚æœ leader çš„å·²çŸ¥å·²æäº¤çš„æœ€é«˜æ—¥å¿—æ¡ç›®çš„ç´¢å¼•å¤§äºæ¥æ”¶è€…çš„å·²çŸ¥å·²æäº¤æœ€é«˜æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ï¼Œåˆ™æŠŠæ¥æ”¶è€…çš„å·²çŸ¥å·²ç»æäº¤çš„æœ€é«˜çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼•commitIndex é‡ç½®ä¸º leader çš„å·²çŸ¥å·²ç»æäº¤çš„æœ€é«˜çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼• leaderCommit æˆ–è€…æ˜¯ ä¸Šä¸€ä¸ªæ–°æ¡ç›®çš„ç´¢å¼• å–ä¸¤è€…çš„æœ€å°å€¼) RequestVote RPC\nå€™é€‰äººè°ƒç”¨ï¼Œæ”¶é›†é€‰ç¥¨\nArguments: term: candidate çš„ä»»æœŸå· candidateId: å‘èµ·è¯·æ±‚çš„ candidate çš„ id lastLogIndex: candidate çš„æœ€åä¸€æ¡æ—¥å¿—çš„ç´¢å¼• lastLogTerm: candidate æœ€åä¸€æ¡æ—¥å¿—å¯¹åº”çš„ä»»æœŸå· Results: term: å½“å‰ä»»æœŸå·ï¼Œç”¨äºcandidateæ›´æ–°è‡ªå·±çš„term voteGranted: trueè¡¨ç¤ºå€™é€‰äººè·å¾—äº†é€‰ç¥¨ Receiver implementation: if term \u0026lt; currentTerm then return false(å¦‚æœterm \u0026lt; currentTermè¿”å› false) if (votedFor==null||votedFor==candidateId)\u0026amp;\u0026amp;(lastLogIndex,lastLogTerm)==log[].last then return true (å¦‚æœ votedFor ä¸ºç©ºæˆ–è€…ä¸ candidateId ç›¸åŒï¼Œå¹¶ä¸”å€™é€‰äººçš„æ—¥å¿—å’Œè‡ªå·±çš„æ—¥å¿—ä¸€æ ·æ–°ï¼Œåˆ™ç»™è¯¥å€™é€‰äººæŠ•ç¥¨) Rules for Servers\nAll Servers: if commitIndex \u0026gt; lastApplied then incr lastApplied and exec log[lastApplied]ï¼ˆå¦‚æœcommitIndex \u0026gt; lastAppliedï¼ŒlastAppliedè‡ªå¢ï¼Œå°†log[lastApplied]åº”ç”¨åˆ°çŠ¶æ€æœºï¼‰ if appendEntries.logs exist (log.term \u0026gt; currentTerm) then currentTerm = log.term and set status = follower(å¦‚æœ RPC çš„è¯·æ±‚æˆ–è€…å“åº”ä¸­åŒ…å«ä¸€ä¸ª term T å¤§äº currentTermï¼Œåˆ™ currentTerm èµ‹å€¼ä¸º Tï¼Œå¹¶åˆ‡æ¢çŠ¶æ€ä¸º follower) Followers: ä¸ä¼šå‘å‡ºä»»ä½•è¯·æ±‚ï¼Œåªä¼šå¯¹æ¥è‡ª candidates ä»¥åŠ leader çš„è¯·æ±‚åšå‡ºå“åº” é€‰ä¸¾è¶…æ—¶åï¼Œå¦‚æœæœªæ”¶åˆ°å½“å‰ leader(term ç›¸åŒ)çš„AppendEntries RPCæˆ–æŠ•ç¥¨ç»™äº† candidateï¼Œåˆ™è½¬æ¢ä¸º candidate Candidates: è½¬æ¢æˆcandidateä¹‹åå¼€å§‹é€‰ä¸¾ incr currentTerm æŠ•ç¥¨ç»™è‡ªå·± reset election timer å‘é€RequestVote RPCç»™å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨ å¦‚æœæ”¶åˆ°äº†å¤šæ•°çš„é€‰ç¥¨åˆ™æˆä¸º leader å¦‚æœæ”¶åˆ° new leader çš„AppendEntries RPCåˆ™æˆä¸º follower å¦‚æœé€‰ä¸¾è¶…æ—¶åˆ™å¼€å§‹æ–°ä¸€è½®çš„é€‰ä¸¾ Leaders: ä¸€æ—¦æˆä¸º leader åˆ™å‘å…¶ä»–æœåŠ¡å™¨å‘é€ç©ºçš„AppendEntries RPCï¼Œåœ¨ç©ºé—²æ—¶é‡å¤å‘é€ä»¥é˜²æ­¢é€‰ä¸¾è¶…æ—¶ å¦‚æœæ”¶åˆ°æ¥è‡ª client çš„å‘½ä»¤: æ·»åŠ åˆ°æœ¬åœ°æ—¥å¿—ï¼Œåœ¨æ‰§è¡Œå¹¶ä½œç”¨åˆ°çŠ¶æ€æœºåä½œå‡ºå“åº”ç»™ client å¯¹äº follower if last log index \u0026gt;= nextIndex(æœ€åæ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼å¤§äºç­‰äº nextIndex): åˆ™é€šè¿‡AppendEntries RPCå°†nextIndexä¹‹åçš„æ‰€æœ‰æ—¥å¿—éƒ½å‘é€å‘é€å‡ºå» å¦‚æœæˆåŠŸ: å°†è¯¥ follower çš„nextIndexä»¥åŠmatchIndexæ›´æ–° å¦‚æœå› ä¸ºæ—¥å¿—ä¸ä¸€è‡´å¯¼è‡´å¤±è´¥: nextIndexé€’å‡å¹¶é‡æ–°å‘é€ å¦‚æœå­˜åœ¨ä¸€ä¸ªæ•°Nï¼Œæ»¡è¶³N \u0026gt; commitIndexï¼Œå¤§å¤šæ•°çš„matchIndex[i] \u0026gt;= N ä»¥åŠlog[N].term == currentTerm: set commitIndex = N Figure 3 Figure 3: Raftä¿è¯è¿™äº›å±æ€§åœ¨åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸Šæ­£ç¡®çš„ã€‚ Election Safety: åœ¨ç»™å®š term å†…åªèƒ½é€‰å‡ºä¸€ä¸ª leader Leader Append-Only: leader æ°¸è¿œä¸è¦†ç›–æˆ–åˆ é™¤æ—¥å¿—ï¼Œåªä¼šæ·»åŠ  Log Matching: å¦‚æœä¸¤ä¸ªæ—¥å¿—åœ¨åŒ…å«ç›¸åŒçš„ index ä»¥åŠ termï¼Œé‚£ä¹ˆå°±è®¤å®šå®ƒä»¬å®Œå…¨ç›¸åŒ Leader Completeness: å¦‚æœä¸€æ¡æ—¥å¿—åœ¨ç»™å®šçš„ term å†…æäº¤ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¼šå‡ºç°åœ¨ term æ›´å¤§çš„ leader çš„æ—¥å¿—ä¸­ State Machine Safety: å¦‚æœä¸€ä¸ªæœåŠ¡å™¨å·²ç»å°†ç»™å®šç´¢å¼•ä½ç½®çš„æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°çŠ¶æ€æœºä¹‹ä¸­ï¼Œåˆ™å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨ä¸ä¼šåœ¨ç›¸åŒç´¢å¼•å¤„å‡ºç°ä¸åŒçš„æ—¥å¿— Raft basics ä¸€ä¸ª Raft é›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªæœåŠ¡å™¨ï¼›5 æ˜¯ä¸€ä¸ªå…¸å‹çš„æ•°é‡ï¼Œå®ƒå…è®¸ç³»ç»Ÿå®¹å¿2æ¬¡æ•…éšœ(æœ‰ä¸¤å°æœåŠ¡å®•æœº)ã€‚ åœ¨ç»™å®šçš„æ—¶é—´ä¸­æ¯ä¸ªæœåŠ¡éƒ½å¤„åœ¨ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€: leader, follower, candidateã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ°å¥½åªæœ‰ä¸€ä¸ª leaderï¼Œæ‰€æœ‰å…¶ä»–æœåŠ¡å™¨éƒ½æ˜¯ followerã€‚\nfollower æ˜¯è¢«åŠ¨çš„: å®ƒä»¬ä¸ä¼šè‡ªå·±å‘å‡ºè¯·æ±‚ï¼Œè€Œåªæ˜¯å“åº”æ¥è‡ª leader å’Œ candidate çš„è¯·æ±‚ã€‚ leader å¤„ç†æ‰€æœ‰ client çš„è¯·æ±‚(å¦‚æœ client è”ç³»åˆ° followerï¼Œåˆ™ follower é‡å®šå‘åˆ° leader)ã€‚ candidate ç”¨äºé€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„ leader(å¯ä»¥çœ‹\u0026nbsp;å›¾4 )ã€‚ Figure 4 Figure 4: Server statesã€‚follow åªå“åº”å…¶ä»–æœåŠ¡çš„è¯·æ±‚ï¼Œå¦‚æœ follow æ¥æ”¶ä¸åˆ°ä»»ä½•æ¶ˆæ¯ï¼Œå°±ä¼šå˜æˆ candidate å¹¶å‘èµ·é€‰ä¸¾ã€‚è·å¾—æ•´ä¸ªé›†ç¾¤ ä¸­å¤§å¤šæ•°äººæŠ•ç¥¨çš„ candidate æˆä¸ºå€™é€‰äººã€‚leader é€šå¸¸è¿è¡Œåˆ°å®ƒä»¬å¤±è´¥ä¸ºæ­¢ã€‚ å¦‚å›¾5æ‰€ç¤º: Raftå°†æ—¶é—´åˆ†ä¸ºä»»æ„é•¿åº¦çš„ termsã€‚terms çš„ç¼–å·æ˜¯è¿ç»­çš„æ•´æ•°ã€‚æ¯ä¸€ä¸ª term å¼€å§‹äº electionï¼Œä¸€ä¸ªæˆ–å¤šä¸ª candidate å°è¯•æˆä¸º leaderã€‚å¦‚æœä¸€ä¸ª candidate èµ¢å¾—äº†é€‰ä¸¾ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨å‰©ä¸‹çš„ term å†…æ‹…ä»» leaderã€‚\nåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹é€‰ä¸¾çš„ç»“æœæ˜¯ split voteã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œterm å°†ä¼šç»“æŸå¹¶ä¸”æ²¡æœ‰ leaderã€‚ä¸€ä¸ªæ–°çš„ term(ä¼´éšæ–°ä¸€è½®çš„é€‰ä¸¾)å°†å¾ˆå¿«å¼€å§‹ã€‚ Raftä¿è¯åœ¨ç»™å®šçš„ term å†…æœ€å¤šåªæœ‰ä¸€ä¸ª leaderã€‚\nFigure 5 Figure 5: å°†æ—¶é—´åˆ’åˆ†ä¸º termsï¼Œæ¯ä¸ª term éƒ½ä»¥é€‰ä¸¾å¼€å§‹ã€‚é€‰ä¸¾æˆåŠŸåï¼Œä¸€ä¸ª leader ç®¡ç†é›†ç¾¤ç›´åˆ° term ç»“æŸã€‚ æœ‰æ—¶å€™é€‰ä¸¾ä¼šå¤±è´¥ï¼Œé‚£ä¹ˆè¿™ä¸ª term å°±ä¼šæ²¡æœ‰ leader è€Œç»“æŸã€‚ term ä¹‹é—´çš„åˆ‡æ¢å¯ä»¥åœ¨ä¸åŒçš„æ—¶é—´ä¸åŒçš„æœåŠ¡å™¨ä¸Šè§‚å¯Ÿåˆ° ä¸åŒçš„æœåŠ¡å™¨å¯èƒ½ä¼šåœ¨ä¸åŒçš„æ—¶é—´è§‚å¯Ÿåˆ° term ä¹‹é—´çš„è½¬æ¢ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½ä¸ä¼šè§‚å¯Ÿåˆ°é€‰ä¸¾ç”šè‡³æ•´ä¸ª term çš„å…¨ç¨‹ã€‚ term åœ¨ Raft ä¸­å……å½“äº†é€»è¾‘æ—¶é’Ÿï¼Œterm ä½¿å¾—å¯ä»¥æœåŠ¡å™¨æ£€æµ‹è¿‡æ—¶çš„ä¿¡æ¯: å¦‚è¿‡æ—¶çš„ leaderã€‚\næ¯ä¸ªæœåŠ¡å™¨éƒ½å­˜å‚¨ä¸€ä¸ªå½“å‰çš„ term ç¼–å·ï¼Œè¯¥ç¼–å·éšæ—¶é—´å•è°ƒåœ°å¢åŠ ã€‚æ¯å½“æœåŠ¡å™¨è¿›è¡Œé€šä¿¡æ—¶ï¼Œå°±ä¼šäº¤æ¢å½“å‰ termï¼› å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„å½“å‰ term æ¯”å¦ä¸€ä¸ªæœåŠ¡å™¨çš„å°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå°†å…¶å½“å‰ term æ›´æ–°ä¸ºè¾ƒå¤§çš„å€¼ã€‚\nå¦‚æœä¸€ä¸ª candidate æˆ– leader å‘ç°å®ƒçš„ term å·²ç»è¿‡æ—¶ï¼Œå®ƒå°†ç«‹å³æ¢å¤åˆ° follower çš„çŠ¶æ€ã€‚\nå¦‚æœä¸€ä¸ªæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚æ˜¯ä¸€ä¸ªè¿‡æ—¶çš„ term ç¼–å·ï¼Œå®ƒå°†æ‹’ç»è¯¥è¯·æ±‚ã€‚\nRaft æœåŠ¡å™¨ä½¿ç”¨ RPC è¿›è¡Œé€šä¿¡ï¼Œè€ŒåŸºæœ¬çš„å…±è¯†ç®—æ³•åªéœ€è¦ä¸¤ç§ç±»å‹çš„RPCã€‚RequestVote RPCsç”± candidate åœ¨é€‰ä¸¾æœŸé—´å‘èµ·ï¼› AppendEntries RPCsç”± leader å‘èµ·ï¼Œç”¨äºå¤åˆ¶æ—¥å¿—æ¡ç›®å¹¶æä¾›ä¸€ç§å¿ƒè·³æœºåˆ¶ã€‚åœ¨ä¸‹é¢çš„ç« èŠ‚è¿˜å¢åŠ äº†ç¬¬ä¸‰ä¸ªRPCï¼Œç”¨äºåœ¨æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“å¿«ç…§ã€‚ å¦‚æœæœåŠ¡å™¨æ²¡æœ‰åŠæ—¶æ”¶åˆ°å“åº”ï¼Œå®ƒä»¬ä¼šé‡è¯• RPCï¼Œå¹¶ä¸”ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œå®ƒä»¬ä¼šå¹¶è¡Œåœ°å‘å‡º RPCã€‚\nLeader election Raft ä½¿ç”¨å¿ƒè·³æœºåˆ¶æ¥è§¦å‘ leader é€‰ä¸¾ã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œåˆå§‹çŠ¶æ€éƒ½æ˜¯ follower ã€‚åªè¦æœåŠ¡å™¨æ”¶åˆ°æ¥è‡ª leader æˆ– candidate çš„æœ‰æ•ˆRPCï¼Œ å®ƒå°±ä¸€ç›´å¤„äº follower çŠ¶æ€ã€‚ leader å®šæœŸå‘æ‰€æœ‰ follower å‘é€å¿ƒè·³ï¼ˆAppendEntries RPCsï¼Œä¸æºå¸¦æ—¥å¿—æ¡ç›®ï¼‰ï¼Œä»¥ä¿æŒä»–ä»¬çš„æƒå¨ã€‚ å¦‚æœ follower åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•é€šä¿¡(election timeout)ï¼Œé‚£ä¹ˆå®ƒå°±è®¤ä¸ºæ²¡æœ‰å¯ç”¨çš„ leaderï¼Œå¹¶å¼€å§‹é€‰ä¸¾ä»¥é€‰æ‹©ä¸€ä¸ªæ–°çš„ leaderã€‚\nè¦å¼€å§‹ä¸€åœºé€‰ä¸¾ï¼Œfollower è¦å¢åŠ å®ƒçš„å½“å‰ term å¹¶è¿‡è½¬æ¢åˆ° candidate çŠ¶æ€ã€‚ ç„¶åï¼Œå®ƒä¸ºè‡ªå·±æŠ•ç¥¨ï¼Œå¹¶è¡Œçš„å‘é›†ç¾¤ä¸­çš„æ¯ä¸ªå…¶ä»–æœåŠ¡å™¨å‘å‡ºRequestVote RPCsã€‚ candidate å°†ä¸€ç›´å¤„äºè¿™ç§çŠ¶æ€ï¼Œç›´åˆ°å‘ç”Ÿä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€:\nå®ƒèµ¢å¾—äº†é€‰ä¸¾ å¦ä¸€ä¸ªæœåŠ¡å™¨ç¡®ç«‹äº†è‡ªå·±çš„é¢†å¯¼åœ°ä½ ä¸€æ®µæ—¶é—´ä¹‹åæ²¡æœ‰ä»»ä½•äººè·èƒœã€‚ æ¥ä¸‹æ¥å°±å¯¹è¿™äº›ç»“æœè¿›è¡Œè®¨è®º:\nå®ƒèµ¢å¾—äº†é€‰ä¸¾\nå¦‚æœä¸€ä¸ª candidate åœ¨åŒä¸€ä»»æœŸ( term )å†…è·å¾—äº†æ•´ä¸ªé›†ç¾¤ä¸­å¤§å¤šæ•°æœåŠ¡å™¨çš„æŠ•ç¥¨ï¼Œé‚£ä¹ˆå®ƒå°±èµ¢å¾—äº†é€‰ä¸¾ã€‚ æ¯å°æœåŠ¡å™¨åœ¨ç»™å®šçš„ term å†…æœ€å¤šä¸ºä¸€å candidate æŠ•ç¥¨ï¼Œä»¥å…ˆæ¥ååˆ°ä¸ºåŸåˆ™ã€‚\nå°‘æ•°æœä»å¤šæ•°çš„åŸåˆ™ä¿è¯äº†æœ€å¤šåªæœ‰ä¸€å candidateèƒ½å¤Ÿåœ¨æŸä¸€ term å†…èµ¢å¾—é€‰ä¸¾ (\u0026nbsp;å›¾3 ä¸­çš„é€‰ä¸¾ Safety å±æ€§)ã€‚ ä¸€æ—¦ä¸€ä¸ª candidate åœ¨é€‰ä¸¾ä¸­è·èƒœï¼Œå®ƒå°±æˆä¸º leaderã€‚ç„¶åï¼Œå®ƒå‘æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨å‘é€å¿ƒè·³ä¿¡æ¯(ä¸æºå¸¦æ—¥å¿—çš„AppendEntries RPC)ï¼Œ ä»¥å»ºç«‹å…¶æƒå¨å¹¶é˜²æ­¢æ–°çš„é€‰ä¸¾å‘ç”Ÿã€‚\nå¦ä¸€ä¸ªæœåŠ¡å™¨ç¡®ç«‹äº†è‡ªå·±çš„é¢†å¯¼åœ°ä½\nåœ¨ç­‰å¾…æŠ•ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œcandidate å¯èƒ½ä¼šæ”¶åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨çš„AppendEntries RPCï¼Œå£°ç§°è‡ªå·±æ˜¯é¢†å¯¼è€…ã€‚ å¦‚æœè¿™ä¸ª leader çš„term(ä¼šæºå¸¦åœ¨ RPC ä¸­)ä¸å°äº candidate å½“å‰çš„ termï¼Œ é‚£ä¹ˆ candidate å°±ä¼šæ‰¿è®¤ leader æ˜¯åˆæ³•çš„å¹¶è¿”å›åˆ° follower çŠ¶æ€ã€‚ å¦‚æœ RPC ä¸­çš„ term æ¯” candidate å½“å‰çš„ term å°ï¼Œé‚£ä¹ˆå€™é€‰è€…ä¼šæ‹’ç» RPCï¼Œå¹¶ç»§ç»­å¤„äº candidate çŠ¶æ€ã€‚\nä¸€æ®µæ—¶é—´ä¹‹åæ²¡æœ‰ä»»ä½•äººè·èƒœ\nç¬¬ä¸‰ä¸ªå¯èƒ½çš„ç»“æœæ˜¯ candidate æ—¢æ²¡æœ‰èµ¢å¾—é€‰ä¸¾ï¼Œä¹Ÿæ²¡æœ‰è¾“æ‰é€‰ä¸¾: å¦‚æœè®¸å¤š follower åŒæ—¶æˆä¸º candidateï¼Œé‚£ä¹ˆç¥¨æ•°å¯èƒ½è¢«åˆ†å‰²ï¼Œ å› æ­¤æ²¡æœ‰ candidate èƒ½è·å¾—è¶³å¤Ÿçš„æŠ•ç¥¨ã€‚ å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæ¯ä¸ª candidate éƒ½ä¼šè¶…æ—¶ï¼Œç„¶åé€šè¿‡å¢åŠ å…¶ term å’Œå‘èµ·æ–°ä¸€è½®çš„RequestVote RPCæ¥å¼€å§‹æ–°çš„é€‰ä¸¾ã€‚ ç„¶è€Œï¼Œå¦‚æœæ²¡æœ‰é¢å¤–çš„æªæ–½ï¼Œsplit voteå¯èƒ½ä¼šæ— é™æœŸåœ°é‡å¤ã€‚\nRaft ä½¿ç”¨éšæœºçš„é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œä»¥ç¡®ä¿ split vote å¾ˆå°‘å‘ç”Ÿï¼Œå¹¶èƒ½è¿…é€Ÿè§£å†³ã€‚ ä¸ºäº†ä»ä¸€å¼€å§‹å°±é˜²æ­¢ split voteï¼Œé€‰ä¸¾è¶…æ—¶æ—¶é—´æ˜¯ä»ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”(ä¾‹å¦‚150-300ms)ä¸­éšæœºé€‰æ‹©çš„ã€‚ è¿™æ ·æ¯ä¸ªæœåŠ¡å™¨çš„é€‰ä¸¾è¶…æ—¶æ—¶é—´å°±ä¸åŒäº†ï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ä¼šè¶…æ—¶ã€‚\nå¦‚æœä¸€ä¸ªæœåŠ¡èµ¢å¾—äº†é€‰ä¸¾ï¼Œå°±åœ¨å…¶ä»–æœåŠ¡è¶…æ—¶ä¹‹å‰å‘é€å¿ƒè·³ï¼Œsplit voteå°±æ˜¯ä½¿ç”¨è¿™æ ·çš„æœºåˆ¶æ¥å¤„ç†ã€‚ æ¯ä¸ª candidate åœ¨é€‰ä¸¾å¼€å§‹æ—¶é‡æ–°å¯åŠ¨å…¶éšæœºé€‰ä¸¾è¶…æ—¶(é‡æ–°è®¡æ—¶ï¼Ÿ)ï¼Œå¹¶ç­‰å¾…è¶…æ—¶è¿‡åå†å¼€å§‹ä¸‹ä¸€æ¬¡é€‰ä¸¾ï¼› è¿™å‡å°‘äº†åœ¨æ–°çš„é€‰ä¸¾ä¸­å†æ¬¡å‡ºç° split vote çš„å¯èƒ½æ€§ã€‚\né€‰ä¸¾æ˜¯ä¸€ä¸ªç”¨äºè¯´æ˜å¯ç†è§£æ€§æ˜¯å¦‚ä½•æŒ‡å¯¼æˆ‘ä»¬åœ¨è®¾è®¡æ–¹æ¡ˆåšæƒè¡¡çš„ä¾‹å­ã€‚ æœ€åˆæˆ‘ä»¬è®¡åˆ’ä½¿ç”¨ä¸€ä¸ªæ’åç³»ç»Ÿ: æ¯ä¸ª candidate è¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ’åï¼Œç”¨æ¥åœ¨ç«äº‰çš„ candidate ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚ å¦‚æœä¸€ä¸ªå€™é€‰äººå‘ç°äº†å¦ä¸€ä¸ªæ’åæ›´é«˜çš„å€™é€‰äººï¼Œå®ƒå°±ä¼šå›åˆ° follower çš„çŠ¶æ€ï¼Œè¿™æ ·æ’åæ›´é«˜çš„å€™é€‰äººå°±èƒ½æ›´å®¹æ˜“åœ°èµ¢å¾—ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚ æˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ³•åœ¨å¯ç”¨æ€§æ–¹é¢äº§ç”Ÿäº†ä¸€äº›å¾®å¦™çš„é—®é¢˜(å¦‚æœä¸€ä¸ªæ’åè¾ƒé«˜çš„æœåŠ¡å‘ç”Ÿæ•…éšœäº†ï¼Œä¸€ä¸ªæ’åè¾ƒä½çš„æœåŠ¡å™¨å¯èƒ½éœ€è¶…æ—¶å¹¶å†æ¬¡æˆä¸º candidate ï¼Œä½†å¦‚æœå®ƒè¿‡æ—©åœ°è¿™æ ·åšï¼Œå®ƒå¯èƒ½ä¼šé‡ç½®é€‰ä¸¾ leader çš„è¿›å±•)ã€‚æˆ‘ä»¬å¯¹ç®—æ³•è¿›è¡Œäº†å¤šæ¬¡è°ƒæ•´ï¼Œä½†æ¯æ¬¡è°ƒæ•´åéƒ½ä¼šå‡ºç°æ–°çš„è§’è½æ¡ˆä¾‹ã€‚ æœ€ç»ˆæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œéšæœºé‡è¯•çš„æ–¹æ³•æ›´æ˜æ˜¾ï¼Œæ›´å®¹æ˜“ç†è§£ã€‚\nLog replication ä¸€æ—¦ä¸€ä¸ªé¢†å¯¼è€…è¢«é€‰å‡ºï¼Œå®ƒå°±å¼€å§‹ä¸º client çš„è¯·æ±‚æä¾›æœåŠ¡ã€‚æ¯ä¸ª client çš„è¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªè¦ç”±å¤åˆ¶çš„çŠ¶æ€æœºæ‰§è¡Œçš„ commandã€‚ leader å°†è¯¥ command ä½œä¸ºä¸€ä¸ªæ–°çš„æ¡ç›®é™„åŠ åˆ°å®ƒçš„æ—¥å¿—ä¸­ï¼Œç„¶åå¹¶è¡Œå‘èµ·AppendEntries RPCç»™å…¶ä»–æ¯ä¸ªæœåŠ¡å™¨ä»¥å¤åˆ¶è¯¥æ¡æ—¥å¿—ã€‚ å½“æ¡ç›®è¢«å®‰å…¨çš„å¤åˆ¶å(ä¸‹é¢ä¼šä»‹ç»)ï¼Œleader å°†è¿™æ¡æ—¥å¿—åº”ç”¨äºå…¶çŠ¶æ€æœºï¼Œå¹¶å°†æ‰§è¡Œç»“æœè¿”å›ç»™ clientã€‚ å¦‚æœ follower å´©æºƒæˆ–è¿è¡Œç¼“æ…¢ï¼Œåˆæˆ–è€…ç½‘ç»œæ•°æ®åŒ…ä¸¢å¤±ï¼Œleader ä¼šæ— é™æœŸåœ°é‡è¯•AppendEntries RPC(ç”šè‡³åœ¨å®ƒå›åº”äº†å®¢æˆ·ç«¯ä¹‹å)ï¼Œ ç›´åˆ°æ‰€æœ‰ follower æœ€ç»ˆå­˜å‚¨æ‰€æœ‰æ—¥å¿—æ¡ç›®ã€‚\nFigure 6: æ—¥å¿—ç”±æœ‰åºåºå·æ ‡è®°çš„æ¡ç›®ç»„æˆã€‚æ¯ä¸ªæ¡ç›®éƒ½åŒ…å«åˆ›å»ºå®ƒçš„ term(æ¯ä¸ªæ¡†ä¸­çš„æ•°å­—)å’Œä¸€ä¸ªçŠ¶æ€æœºéœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ å¦‚æœä¸€ä¸ªæ¡ç›®å¯ä»¥å®‰å…¨åœ°åº”ç”¨äºçŠ¶æ€æœºï¼Œé‚£ä¹ˆè¯¥æ¡ç›®å°±è¢«è®¤ä¸ºæ˜¯ committed çš„ æ—¥å¿—çš„ç»„ç»‡æ–¹å¼å¦‚\u0026nbsp;å›¾6 æ‰€ç¤ºã€‚æ¯ä¸ªæ—¥å¿—æ¡ç›®éƒ½å­˜å‚¨äº†ä¸€ä¸ªçŠ¶æ€æœºå‘½ä»¤ï¼Œ ä»¥åŠ leader æ”¶åˆ°è¯¥æ¡ç›®æ—¶çš„ term ç¼–å·ã€‚æ—¥å¿—æ¡ç›®ä¸­çš„ term ç¼–å·è¢«ç”¨æ¥æ£€æµ‹æ—¥å¿—ä¹‹é—´çš„ä¸ä¸€è‡´ï¼Œ å¹¶ç¡®ä¿\u0026nbsp;å›¾3 ä¸­çš„ä¸€äº›å±æ€§ã€‚æ¯ä¸ªæ—¥å¿—æ¡ç›®ä¹Ÿæœ‰ä¸€ä¸ªæ•´æ•°çš„ç´¢å¼•æ¥æ ‡è¯†å®ƒåœ¨æ—¥å¿—ä¸­çš„ä½ç½®ã€‚\nleader å†³å®šä½•æ—¶å°†æ—¥å¿—æ¡ç›®åº”ç”¨äºçŠ¶æ€æœºæ˜¯å®‰å…¨çš„ï¼Œè¿™æ ·çš„æ¡ç›®è¢«ç§°ä¸º committed ã€‚ Raft ä¿è¯æ‰€æäº¤çš„æ¡ç›®æ˜¯æŒä¹…åŒ–çš„å¹¶ä¸”æœ€ç»ˆä¼šè¢«æ‰€æœ‰å¯ç”¨çš„çŠ¶æ€æœºæ‰§è¡Œã€‚ ä¸€æ—¦åˆ›å»ºè¯¥æ¡ç›®çš„ leader å°†å…¶å¤åˆ¶åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šï¼Œè¯¥æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤(ä¾‹å¦‚ï¼Œå›¾6ä¸­çš„æ¡ç›®7)ã€‚ è¿™ä¹Ÿä¼šæäº¤ leader æ—¥å¿—ä¸­æ‰€æœ‰ä¹‹å‰çš„æ¡ç›®ï¼ŒåŒ…æ‹¬ä¹‹å‰é¢†å¯¼è€…åˆ›å»ºçš„æ¡ç›®ã€‚ leader ä¼šè·Ÿè¸ªå®ƒæ‰€çŸ¥é“çš„å·²æäº¤çš„æœ€å¤§ç´¢å¼•ï¼Œå¹¶ä¸”å®ƒåœ¨æœªæ¥çš„AppendEntries RPC(åŒ…æ‹¬å¿ƒè·³)ä¸­åŒ…æ‹¬è¯¥ç´¢å¼•ï¼Œä»¥ä¾¿å…¶ä»–æœåŠ¡å™¨æœ€ç»ˆå‘ç°ã€‚ ä¸€æ—¦ follower å¾—çŸ¥ä¸€ä¸ªæ—¥å¿—æ¡ç›®è¢«æäº¤ï¼Œå®ƒå°±ä¼šå°†è¯¥æ¡ç›®åº”ç”¨äºå…¶æœ¬åœ°çŠ¶æ€æœº(æŒ‰æ—¥å¿—é¡ºåº)ã€‚\næˆ‘ä»¬è®¾è®¡çš„ Raft æ—¥å¿—æœºåˆ¶åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„æ—¥å¿—ä¹‹é—´ä¿æŒé«˜åº¦çš„ä¸€è‡´æ€§ã€‚è¿™ä¸ä»…ç®€åŒ–äº†ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä½¿å…¶æ›´å…·å¯é¢„æµ‹æ€§ï¼Œè€Œä¸”æ˜¯ç¡®ä¿å®‰å…¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ Raft ç»´æŠ¤äº†ä»¥ä¸‹ç‰¹æ€§ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†\u0026nbsp;å›¾3 ä¸­çš„Log Matchingç‰¹æ€§:\nå¦‚æœä¸åŒçš„ä¸¤ä¸ªæ—¥å¿—å…·æœ‰ç›¸åŒçš„ index ä»¥åŠ term\né‚£ä¹ˆå°±è®¤ä¸ºå®ƒä»¬å­˜å‚¨çš„æ˜¯åŒä¸€ä¸ª command é‚£ä¹ˆå°±è®¤ä¸ºå®ƒä»¬ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ä¹Ÿæ˜¯ç›¸åŒçš„ ç¬¬ä¸€ä¸ªå±æ€§æ¥è‡ªäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³ä¸€ä¸ª leader åœ¨ä¸€ä¸ª term å†…åªèƒ½åœ¨ä¸€ä¸ª index ä¸Šåˆ›å»ºä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œå¹¶ä¸”æ—¥å¿—æ¡ç›®æ°¸è¿œä¸ä¼šæ”¹å˜å®ƒä»¬åœ¨æ—¥å¿—ä¸­çš„ä½ç½®ã€‚ ç¬¬äºŒä¸ªå±æ€§ç”±AppendEntries RPCæ‰§è¡Œçš„ç®€å•ä¸€è‡´æ€§æ£€æŸ¥æ¥ä¿è¯ã€‚ å½“å‘é€AppendEntries RPCæ—¶ï¼Œleader ä¼šåŒ…å«å…¶æ—¥å¿—ä¸­ç´§æ¥æ–°æ¡ç›®ä¹‹å‰çš„æ¡ç›®çš„ index å’Œ term ã€‚ å¦‚æœ follower åœ¨å…¶æ—¥å¿—ä¸­æ²¡æœ‰æ‰¾åˆ°å…·æœ‰ç›¸åŒ index å’Œ term çš„æ¡ç›®ï¼Œé‚£ä¹ˆå®ƒå°†æ‹’ç»æ–°æ¡ç›®ã€‚ ä¸€è‡´æ€§æ£€æŸ¥å°±åƒä¸€ä¸ªå½’çº³æ­¥éª¤: æ—¥å¿—çš„åˆå§‹çŠ¶æ€æ˜¯è‚¯å®šæ»¡è¶³Log Matchingå±æ€§çš„ï¼Œ å¹¶ä¸”æ¯å½“æ—¥å¿—è¢«æ‰©å±•æ—¶ï¼Œä¸€è‡´æ€§æ£€æŸ¥éƒ½ä¼šä¿ç•™Log Matchingå±æ€§ã€‚ å› æ­¤ï¼Œæ¯å½“AppendEntriesæˆåŠŸè¿”å›æ—¶ï¼Œleader çŸ¥é“ follower çš„æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—åœ¨æ–°æ¡ç›®ä¹‹å‰æ˜¯ç›¸åŒçš„\nåœ¨æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œleader å’Œ follower çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥AppendEntriesä¸€è‡´æ€§æ£€æŸ¥ä¸ä¼šå¤±è´¥ã€‚ ç„¶è€Œï¼Œleader å´©æºƒä¼šä½¿æ—¥å¿—ä¸ä¸€è‡´(old leader å¯èƒ½æ²¡æœ‰å®Œå…¨å¤åˆ¶å…¶æ—¥å¿—ä¸­çš„æ‰€æœ‰æ¡ç›®)ã€‚ è¿™äº›ä¸ä¸€è‡´ä¼šåœ¨ä¸€ç³»åˆ— leader å’Œ follower çš„å´©æºƒä¸­åŠ å‰§ã€‚å›¾7è¯´æ˜äº† follower çš„æ—¥å¿—å¯èƒ½ä¸new leader çš„æ—¥å¿—ä¸åŒçš„æ–¹å¼ã€‚\nfollower å¯èƒ½ä¼šä¸¢å¤± leader çš„æ¡ç›® follower å¯èƒ½ä¼šæœ‰ leader æ²¡æœ‰çš„é¢å¤–æ¡ç›® æˆ–è€…ä¸¤è€…éƒ½æœ‰ æ—¥å¿—ä¸­ç¼ºå¤±å’Œå¤šä½™çš„æ¡ç›®å¯èƒ½è·¨è¶Šå¤šä¸ª term ã€‚\nFigure 7: å½“ä¸€ä¸ª leader æˆåŠŸå½“é€‰æ—¶ï¼Œfollower å¯èƒ½æ˜¯(a-f)ä¸­çš„ä»»ä½•ä¸€ç§æƒ…å†µã€‚ æ¯ä¸ªç›’å­ä»£è¡¨ä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼›ç›’å­é‡Œçš„æ•°å­—æ˜¯å…¶ termã€‚ä¸€ä¸ª follower å¯èƒ½ç¼ºå°‘æ¡ç›®(a-b)ï¼Œå¯èƒ½æœ‰é¢å¤–çš„æœªæ‰¿è¯ºçš„æ¡ç›®(c-d)ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰(e-f)ã€‚ ä¾‹å¦‚fçš„å‘ç”Ÿæ¡ä»¶: å¦‚æœè¯¥æœåŠ¡å™¨æ˜¯ç¬¬2æœŸçš„ leader ï¼Œåœ¨å…¶æ—¥å¿—ä¸­ä¸­å·²ç»å¢åŠ äº†å‡ ä¸ªæ¡ç›®ï¼Œç„¶ååœ¨æäº¤æ¡ç›®ä¹‹å‰å°±å´©æºƒäº†ï¼›å®ƒå¾ˆå¿«é‡æ–°å¯åŠ¨ï¼Œæˆä¸ºç¬¬3æœŸçš„ leaderï¼Œ å¹¶åœ¨å…¶æ—¥å¿—ä¸­å¢åŠ äº†å‡ ä¸ªæ¡ç›®ï¼›åœ¨ç¬¬2æœŸæˆ–ç¬¬3æœŸçš„æ¡ç›®è¢«æäº¤ä¹‹å‰ï¼Œè¯¥æœåŠ¡å™¨åˆå´©æºƒäº†ï¼Œå¹¶æŒç»­äº†å‡ ä¸ªä»»æœŸã€‚ åœ¨ Raft ä¸­ï¼Œleader é€šè¿‡å¼ºè¿« follower çš„æ—¥å¿—é‡å¤è‡ªå·±çš„æ—¥å¿—æ¥å¤„ç†ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™æ„å‘³ç€ follower æ—¥å¿—ä¸­çš„å†²çªæ¡ç›®å°†è¢« leader æ—¥å¿—ä¸­çš„æ¡ç›®è¦†ç›–ã€‚åœ¨ä¸‹ä¸€èŠ‚å°†è¡¨æ˜ï¼Œå¦‚æœå†åŠ ä¸Šä¸€ä¸ªé™åˆ¶ï¼Œè¿™å°±æ˜¯å®‰å…¨çš„ã€‚\nä¸ºäº†ä½¿ follower çš„æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œleader å¿…é¡»æ‰¾åˆ°ä¸¤ä¸ªæ—¥å¿—ä¸€è‡´çš„æœ€æ–°æ—¥å¿—æ¡ç›®ï¼Œåˆ é™¤è¯¥ç‚¹ä¹‹å follower æ—¥å¿—ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼Œ å¹¶å°†è¯¥ç‚¹ä¹‹åçš„æ‰€æœ‰ leader æ¡ç›®å‘é€ç»™ followerã€‚æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯ä¸ºäº†å“åº”AppendEntries RPCæ‰§è¡Œçš„ä¸€è‡´æ€§æ£€æŸ¥è€Œå‘ç”Ÿçš„ã€‚ leader ä¸ºæ¯ä¸ª follower ç»´æŠ¤ä¸€ä¸ª nextIndex ï¼Œè¿™æ˜¯ leader å°†å‘é€ç»™è¯¥ follower çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ index ã€‚ å½“ leader å½“é€‰æ—¶ï¼Œå®ƒä¼šåˆå§‹åŒ–æ‰€æœ‰ nextIndex çš„å€¼ä¸ºè‡ªå·±æœ€åä¸€æ¡æ—¥å¿—çš„ index + 1(å›¾ 7 ä¸­çš„ 11)ã€‚ å¦‚æœ follower çš„æ—¥å¿—ä¸ leader çš„æ—¥å¿—ä¸ä¸€è‡´ï¼Œåˆ™AppendEntriesä¸€è‡´æ€§æ£€æŸ¥å°†åœ¨ä¸‹ä¸€ä¸ªAppendEntries RPCä¸­å¤±è´¥ã€‚ follower æ‹’ç»åï¼Œleader ä¼šå‡å°‘ nextIndex çš„å€¼å¹¶é‡è¯•AppendEntries RPCã€‚ æœ€ç»ˆnextIndexå°†è¾¾åˆ° leader å’Œ follower æ—¥å¿—åŒ¹é…çš„ç‚¹ã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼ŒAppendEntrieså°†æˆåŠŸï¼Œè¿™å°†åˆ é™¤ follower æ—¥å¿—ä¸­çš„ä»»ä½•å†²çªæ¡ç›®ï¼Œå¹¶ä» leader æ—¥å¿—ä¸­æ·»åŠ æ¡ç›®(å¦‚æœæœ‰)ã€‚ ä¸€æ—¦AppendEntriesæˆåŠŸï¼Œfollower çš„ log å°±ä¼šå’Œ leader çš„ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨æ¥ä¸‹æ¥çš„ä»»æœŸå†…ä¿æŒè¿™ç§çŠ¶æ€ã€‚\nå¦‚æœéœ€è¦ï¼Œå¯ä»¥ä¼˜åŒ–åè®®ä»¥å‡å°‘è¢«æ‹’ç»çš„AppendEntries RPCçš„æ•°é‡ã€‚ä¾‹å¦‚ï¼Œå½“æ‹’ç»AppendEntriesè¯·æ±‚æ—¶ï¼Œ follower å¯ä»¥åŒ…å«å†²çªæ¡ç›®çš„ term ä»¥å®ƒåœ¨ term ä¸­å­˜å‚¨çš„ç¬¬ä¸€ä¸ªç´¢å¼•ã€‚ æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œleader å¯ä»¥å‡å°‘ nextIndex ä»¥ç»•è¿‡è¯¥ term ä¸­çš„æ‰€æœ‰å†²çªæ¡ç›®ï¼› æ¯ä¸ªæœ‰æ—¥å¿—å†²çªçš„ term éƒ½åªéœ€è¦ä¸€ä¸ªAppendEntries RPCï¼Œè€Œä¸æ˜¯æ¯ä¸ªæ—¥å¿—æ¡ç›®ä¸€ä¸ª RPCã€‚ åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬æ€€ç–‘è¿™ç§ä¼˜åŒ–æ˜¯å¦å¿…è¦ï¼Œå› ä¸ºå¤±è´¥å¾ˆå°‘å‘ç”Ÿï¼Œè€Œä¸”ä¸å¤ªå¯èƒ½æœ‰å¾ˆå¤šä¸ä¸€è‡´çš„æ¡ç›®ã€‚\né€šè¿‡è¿™ç§æœºåˆ¶ï¼Œleader åœ¨ä¸Šå°æ—¶æ— éœ€é‡‡å–ä»»ä½•ç‰¹æ®Šæªæ–½æ¥æ¢å¤æ—¥å¿—ä¸€è‡´æ€§ã€‚å®ƒåˆšåˆšå¼€å§‹æ­£å¸¸è¿è¡Œï¼Œ å¹¶ä¸”æ—¥å¿—ä¼šè‡ªåŠ¨æ”¶æ•›ä»¥å“åº”AppendEntriesä¸€è‡´æ€§æ£€æŸ¥çš„å¤±è´¥ã€‚ leader æ°¸è¿œä¸ä¼šè¦†ç›–æˆ–åˆ é™¤è‡ªå·±æ—¥å¿—ä¸­çš„æ¡ç›®(\u0026nbsp;å›¾3 ä¸­çš„Leader Append-Only)ã€‚\nç†æƒ³çš„ Raft:\nåªè¦å¤§å¤šæ•°æœåŠ¡å™¨å¯åŠ¨ï¼ŒRaft å°±å¯ä»¥æ¥å—ã€å¤åˆ¶å’Œåº”ç”¨æ–°çš„æ—¥å¿—æ¡ç›® å¯ä»¥é€šè¿‡å•è½® RPC å°†æ–°æ¡ç›®å¤åˆ¶åˆ°é›†ç¾¤çš„å¤§éƒ¨åˆ†ï¼› å¹¶ä¸”å•ä¸ªæ…¢é€Ÿ follower ä¸ä¼šå½±å“æ€§èƒ½ã€‚ Safety åœ¨å‰é¢çš„ç« èŠ‚é‡Œé¢ä»‹ç»äº† Raft æ€æ ·é€‰ä¸¾é¢†å¯¼ä»¥åŠå¤åˆ¶æ—¥å¿—ã€‚ ç„¶è€Œï¼Œè¿™äº›æœºåˆ¶è¿˜è¿œä¸å¤Ÿæ¥ä¿è¯æ¯ä¸ªçŠ¶æ€æœºä»¥ç›¸åŒçš„é¡ºåºæ¥æ‰§è¡Œç›¸åŒçš„ commandã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ª follower å¯èƒ½æ˜¯ä¸å¯ç”¨çŠ¶æ€(unavailable)è€Œ leader æäº¤äº†è‹¥å¹²ä¸ªæ—¥å¿—ï¼Œç„¶åå®ƒå¯èƒ½ä¼šè¢«é€‰ä¸º leader ç„¶åè¦†ç›–è¿™äº›æ—¥å¿—ï¼› ç»“æœå°±æ˜¯ä¸åŒçš„çŠ¶æ€æœºå¯èƒ½æ‰§è¡Œäº†ä¸åŒçš„ command sequenceã€‚\nåœ¨è¿™ä¸€èŠ‚é€šè¿‡æ·»åŠ å¯¹å“ªäº›æœåŠ¡å™¨å¯ä»¥è¢«é€‰ä¸¾ä¸º leaderçš„é™åˆ¶æ¥å®Œå–„ Raftã€‚ è¿™ä¸ªé™åˆ¶ç¡®ä¿ leader åœ¨ä»»æ„ç»™å®š term å†…ï¼ŒåŒ…å«äº†ä¹‹å‰ä»»èŒæœŸé—´çš„æ‰€æœ‰è¢«æäº¤çš„æ—¥å¿—(\u0026nbsp;å›¾3 ä¸­çš„Leader Completeness Property) å¢åŠ è¿™ä¸ªé€‰ä¸¾é™åˆ¶ï¼Œè®©æˆ‘ä»¬ä½¿æäº¤æ—¶çš„è§„åˆ™æ›´åŠ å‡†ç¡®ã€‚ æœ€åï¼Œæˆ‘ä»¬ä¼šå±•ç¤ºä¸€ä¸ªç®€è¦çš„è¯æ˜ä¸ºLeader Completeness Propertyå¹¶ä¸”è¯´æ˜æ˜¯æ€æ ·å¼•å¯¼å‡ºæ­£ç¡®è¡Œä¸ºçš„å¤åˆ¶çŠ¶æ€æœºã€‚\nElection restriction åœ¨ä»»ä½•åŸºäº leader çš„å…±è¯†ç®—æ³•ä¸­ï¼Œleader å¿…é¡»å°†å·²æäº¤çš„æ—¥å¿—å­˜å‚¨ã€‚åœ¨ä¸€äº›å…±è¯†ç®—æ³•ä¸­ï¼Œæ¯”å¦‚Viewstamped Replicationï¼Œ ä¸€ä¸ªèŠ‚ç‚¹èƒ½å½“é€‰ leaderï¼Œå³ä½¿å®ƒä¸€å¼€å§‹æ²¡æœ‰åŒ…å«æ‰€æœ‰å·²æäº¤çš„æ—¥å¿—ã€‚ è¿™äº›ç®—æ³•éƒ½æœ‰é¢å¤–çš„æœºåˆ¶æ¥è¯†åˆ«ä¸¢å¤±çš„æ—¥å¿—å¹¶å‘é€ç»™ new leaderï¼Œè¦ä¹ˆåœ¨é€‰ä¸¾çš„è¿‡ç¨‹ä¸­æˆ–è€…åœ¨é€‰ä¸¾ä¹‹åä¸ä¹…ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´ç›¸å½“å¤§çš„é¢å¤–çš„æœºåˆ¶å’Œå¤æ‚æ€§ã€‚\nRaft ä½¿ç”¨äº†ä¸€ç§æ›´åŠ ç®€å•çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¿è¯åœ¨é€‰ä¸¾çš„æ—¶å€™æ–°çš„ leader æ‹¥æœ‰æ‰€æœ‰ä¹‹å‰ä»»æœŸä¸­å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ï¼Œ è€Œä¸éœ€è¦ä¼ é€è¿™äº›æ—¥å¿—æ¡ç›®ç»™ leader ã€‚è¿™æ„å‘³ç€æ—¥å¿—æ¡ç›®çš„ä¼ é€æ˜¯å•å‘çš„ï¼Œåªä» leader ä¼ ç»™ followerï¼Œ å¹¶ä¸” leader ä»ä¸ä¼šè¦†ç›–è‡ªèº«æœ¬åœ°æ—¥å¿—ä¸­å·²ç»å­˜åœ¨çš„æ¡ç›®ã€‚\nRaft ä½¿ç”¨æŠ•ç¥¨çš„è¿‡ç¨‹æ¥é˜»æ­¢ candidate èµ¢å¾—é€‰ä¸¾ï¼Œé™¤éå®ƒçš„æ—¥å¿—åŒ…å«æ‰€æœ‰å·²ç»æäº¤çš„æ¡ç›®ã€‚cand- idate ä¸ºäº†è¢«é€‰ä¸¾å¿…é¡»è”ç³»é›†ç¾¤ä¸­çš„å¤§éƒ¨åˆ†èŠ‚ç‚¹ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¢«æäº¤çš„æ—¥å¿—åœ¨è¿™äº›æœåŠ¡ä¸Šè‡³å°‘å­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ å¦‚æœ candidate çš„æ—¥å¿—è‡³å°‘ä¸å¤§å¤šæ•°æ—¥å¿—ä¸­çš„ä»»ä½•å…¶ä»–æ—¥å¿—ä¸€æ ·æœ€æ–°(â€œæœ€æ–°â€çš„å®šä¹‰åœ¨ä¸‹é¢)ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¿å­˜äº†æ‰€æœ‰å·²æäº¤çš„æ—¥å¿—ã€‚\nRequestVote RPCå®ç°çš„é™åˆ¶: RPC ä¼šåŒ…å«å…³äº candidate çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¦‚æœ voter è‡ªå·±çš„æ—¥å¿—æ¯” candidate çš„æ—¥å¿—æ›´æ–°ï¼Œ é‚£ä¹ˆ vote ä¼šæ‹’ç»æŠ•ç¥¨ã€‚\nRaft é€šè¿‡æ¯”è¾ƒæœ€åä¸€ä¸ªæ—¥å¿—çš„ index ä»¥åŠ termæ¥å†³å®šä¸¤ä¸ªæ—¥å¿—ä¸­çš„é‚£ä¸ªæ˜¯æœ€æ–°çš„ã€‚ å¦‚æœæœ€åä¸€æ¡æ—¥å¿—çš„ term ä¸åŒï¼Œåˆ™æ›´å¤§çš„é‚£ä»½å°±æ˜¯æ›´æ–°çš„ã€‚ å¦‚æœæ—¥å¿—æœ‰ç›¸åŒçš„ termï¼Œé‚£ä¹ˆå“ªä¸ªæ—¥å¿—é•¿(æ—¥å¿—æ•°ç»„çš„é•¿åº¦ï¼Ÿè¿˜æ˜¯ index çš„å¤§å°ï¼Ÿ)ï¼Œå“ªä¸ªå°±æ˜¯æœ€æ–°çš„ã€‚\nCommitting entries from previous terms å¦‚\u0026nbsp;Log replication ä»‹ç»çš„é‚£æ ·ï¼Œ åªè¦æ—¥å¿—è¢«å­˜å‚¨åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸­ï¼Œleader å°±çŸ¥é“è¿™æ¡æ—¥å¿—æ˜¯å¯ä»¥åœ¨å½“å‰ term å†…è¢«æäº¤çš„ã€‚ å¦‚æœ leader åœ¨æäº¤æ—¥å¿—ä¹‹å‰å´©æºƒäº†ï¼Œæœªæ¥çš„ leader å°†ä¼šå°è¯•å®Œæˆè¿™æ¡æ—¥å¿—çš„å¤åˆ¶ã€‚ ç„¶è€Œï¼Œleader ä¸èƒ½ç«‹å³æ¨æ–­å‡ºåœ¨å‰ä¸€ä¸ª term çš„æ—¥å¿—åœ¨ä¿å­˜åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šæ—¶å°±ä¸€å®šè¢«æäº¤äº†ã€‚ å›¾8è¯´æ˜äº†ä¸€ç§æƒ…å†µ: ä¸€æ¡å·²ç»è¢«å­˜å‚¨åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šçš„è€æ—¥å¿—æ¡ç›®ï¼Œä¹Ÿä¾ç„¶æœ‰å¯èƒ½ä¼šè¢«æœªæ¥çš„é¢†å¯¼è€…è¦†ç›–æ‰ã€‚\nFigure 8: å¦‚å›¾çš„æ—¶é—´åºåˆ—å±•ç¤ºäº†ä¸ºä»€ä¹ˆé¢†å¯¼è€…æ— æ³•å†³å®šå¯¹è€ä»»æœŸå·çš„æ—¥å¿—æ¡ç›®è¿›è¡Œæäº¤ã€‚åœ¨ (a) ä¸­ï¼ŒS1 æ˜¯é¢†å¯¼è€…ï¼Œéƒ¨åˆ†çš„å¤åˆ¶äº†ç´¢å¼•ä½ç½® 2 çš„æ—¥å¿—æ¡ç›®ã€‚åœ¨ (b) ä¸­ï¼ŒS1 å´©æºƒäº†ï¼Œç„¶å S5 åœ¨ä»»æœŸ 3 é‡Œé€šè¿‡ S3ã€S4 å’Œè‡ªå·±çš„é€‰ç¥¨èµ¢å¾—é€‰ä¸¾ï¼Œç„¶åä»å®¢æˆ·ç«¯æ¥æ”¶äº†ä¸€æ¡ä¸ä¸€æ ·çš„æ—¥å¿—æ¡ç›®æ”¾åœ¨äº†ç´¢å¼• 2 å¤„ã€‚ç„¶ååˆ° (c)ï¼ŒS5 åˆå´©æºƒäº†ï¼›S1 é‡æ–°å¯åŠ¨ï¼Œé€‰ä¸¾æˆåŠŸï¼Œå¼€å§‹å¤åˆ¶æ—¥å¿—ã€‚åœ¨è¿™æ—¶ï¼Œæ¥è‡ªä»»æœŸ 2 çš„é‚£æ¡æ—¥å¿—å·²ç»è¢«å¤åˆ¶åˆ°äº†é›†ç¾¤ä¸­çš„å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æäº¤ã€‚å¦‚æœ S1 åœ¨ (d1) ä¸­åˆå´©æºƒäº†ï¼ŒS5 å¯ä»¥é‡æ–°è¢«é€‰ä¸¾æˆåŠŸï¼ˆé€šè¿‡æ¥è‡ª S2ï¼ŒS3 å’Œ S4 çš„é€‰ç¥¨ï¼‰ï¼Œç„¶åè¦†ç›–äº†ä»–ä»¬åœ¨ç´¢å¼• 2 å¤„çš„æ—¥å¿—ã€‚åä¹‹ï¼Œå¦‚æœåœ¨å´©æºƒä¹‹å‰ï¼ŒS1 æŠŠè‡ªå·±ä¸»å¯¼çš„æ–°ä»»æœŸé‡Œäº§ç”Ÿçš„æ—¥å¿—æ¡ç›®å¤åˆ¶åˆ°äº†å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œå°±å¦‚ (d2) ä¸­é‚£æ ·ï¼Œé‚£ä¹ˆåœ¨åé¢ä»»æœŸé‡Œé¢è¿™äº›æ–°çš„æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ï¼ˆå› ä¸º S5 å°±ä¸å¯èƒ½é€‰ä¸¾æˆåŠŸï¼‰ã€‚ è¿™æ ·åœ¨åŒä¸€æ—¶åˆ»å°±åŒæ—¶ä¿è¯äº†ï¼Œä¹‹å‰çš„æ‰€æœ‰è€çš„æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ã€‚ ä¸ºäº†æ¶ˆé™¤å›¾8ä¸­çš„é—®é¢˜ï¼ŒRaft æ°¸è¿œä¸ä½¿ç”¨é€šè¿‡è®¡ç®—å‰¯æœ¬æ•°é‡çš„æ–¹å¼å»æäº¤å‰ä¸€ä¸ª term çš„æ—¥å¿—ã€‚ åªæœ‰ leader å½“å‰ term å†…çš„æ—¥å¿—æ¡ç›®æ‰ä¼šé€šè¿‡è®¡ç®—å‰¯æœ¬æ•°é‡çš„æ–¹å¼æ¥æäº¤ï¼› ä¸€æ—¦å½“å‰ term çš„æ—¥å¿—ä»¥è¿™ç§æ–¹å¼æäº¤ï¼Œé‚£ä¹ˆç”±äºLog Matchingåˆ™ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—æ¡ç›®ä¹Ÿè¢«é—´æ¥æäº¤ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œleaderèƒ½å®‰å…¨çš„çŸ¥é“ä¸€ä¸ªè€çš„æ—¥å¿—æ˜¯å¦å·²ç»è¢«æäº¤(ä¾‹å¦‚ï¼Œè¯¥æ—¥å¿—æ˜¯å¦å­˜å‚¨åˆ°æœåŠ¡å™¨ä¸Š)ï¼Œ ä½†æ˜¯ Raft ä¸ºäº†ç®€åŒ–é—®é¢˜ä½¿ç”¨äº†ä¸€ç§æ›´åŠ ä¿å®ˆçš„æ–¹æ³•ã€‚\nå½“ leader å¤åˆ¶ä¹‹å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ—¶ï¼ŒRaft ä¼šä¸ºæ‰€æœ‰æ—¥å¿—ä¿ç•™åŸå§‹çš„ä»»æœŸå·ï¼Œè¿™åœ¨æäº¤è§„åˆ™ä¸Šäº§ç”Ÿäº†é¢å¤–çš„å¤æ‚æ€§ã€‚ åœ¨å…¶ä»–çš„å…±è¯†ç®—æ³•ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–°çš„ leader è¦é‡æ–°å¤åˆ¶ä¹‹å‰çš„ä»»æœŸé‡Œçš„æ—¥å¿—æ—¶ï¼Œå®ƒå¿…é¡»ä½¿ç”¨å½“å‰æ–°çš„ä»»æœŸå·ã€‚ Raft ä½¿ç”¨çš„æ–¹æ³•æ›´åŠ å®¹æ˜“è¾¨åˆ«å‡ºæ—¥å¿—ï¼Œå› ä¸ºå®ƒå¯ä»¥éšç€æ—¶é—´å’Œæ—¥å¿—çš„å˜åŒ–å¯¹æ—¥å¿—ç»´æŠ¤ç€åŒä¸€ä¸ªä»»æœŸç¼–å·ã€‚ å¦å¤–ï¼Œå’Œå…¶ä»–çš„ç®—æ³•ç›¸æ¯”ï¼ŒRaft ä¸­çš„ new leader åªéœ€è¦å‘é€æ›´å°‘æ—¥å¿—æ¡ç›®( å…¶ä»–ç®—æ³•ä¸­å¿…é¡»åœ¨ä»–ä»¬è¢«æäº¤ä¹‹å‰å‘é€æ›´å¤šçš„å†—ä½™æ—¥å¿—æ¡ç›®æ¥ä¸ºä»–ä»¬é‡æ–°ç¼–å·)ã€‚ ä½†æ˜¯ï¼Œè¿™åœ¨å®è·µä¸­å¯èƒ½å¹¶ä¸ååˆ†é‡è¦ï¼Œå› ä¸ºé¢†å¯¼è€…æ›´æ¢å¾ˆå°‘ä¼šå‘ç”Ÿã€‚\nFollower and candidate crashes å¦‚æœ follower æˆ–è€… candidate å´©æºƒäº†ï¼Œé‚£ä¹ˆåç»­å‘ç»™ä»–ä»¬çš„ RPC éƒ½ä¼šå¤±è´¥ã€‚ Raft çš„å¤„ç†æ–¹å¼å°±æ˜¯æ— é™é‡è¯•ï¼Œå¦‚æœåç»­å®ƒä»¬æ¢å¤äº†ï¼Œè¿™äº›è¯·æ±‚å°±ä¼šæˆåŠŸã€‚ å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨æ¥æ”¶äº†ä¸€ä¸ª RPC è¯·æ±‚åï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å“åº”çš„æ—¶å€™å´©æºƒäº†ï¼Œé‚£ä¹ˆå®ƒåœ¨æ¢å¤çš„æ—¶å€™ä¼šå†æ¬¡æ”¶åˆ°åŒæ ·çš„è¯·æ±‚ã€‚ Raft çš„ RPC éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥é‡è¯•ä¸ä¼šé€ æˆä»»ä½•é—®é¢˜ã€‚ å¦‚æœä¸€ä¸ª follower æ”¶åˆ°AppendEntires RPCä¸­åŒ…å«å·²ç»å­˜åœ¨çš„æ—¥å¿—ï¼Œé‚£ä¹ˆå®ƒä¼šç›´æ¥å¿½ç•¥è¿™ä¸ªæ–°çš„è¯·æ±‚ã€‚\nTiming and availability Raft çš„è¦æ±‚ä¹‹ä¸€å°±æ˜¯å®‰å…¨æ€§ä¸èƒ½ä¾èµ–æ—¶é—´ï¼šæ•´ä¸ªç³»ç»Ÿä¸èƒ½å› ä¸ºæŸäº›äº‹ä»¶è¿è¡Œçš„æ¯”é¢„æœŸå¿«ä¸€ç‚¹æˆ–è€…æ…¢ä¸€ç‚¹å°±äº§ç”Ÿäº†é”™è¯¯çš„ç»“æœã€‚ ä½†æ˜¯ï¼Œå¯ç”¨æ€§ï¼ˆç³»ç»Ÿå¯ä»¥åŠæ—¶çš„å“åº”å®¢æˆ·ç«¯ï¼‰ä¸å¯é¿å…çš„è¦ä¾èµ–äºæ—¶é—´ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ¶ˆæ¯äº¤æ¢æ¯”æœåŠ¡å™¨æ•…éšœé—´éš”æ—¶é—´é•¿ï¼Œå€™é€‰äººå°†æ²¡æœ‰è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥èµ¢å¾—é€‰ä¸¾ï¼›æ²¡æœ‰ä¸€ä¸ªç¨³å®šçš„é¢†å¯¼äººï¼ŒRaft å°†æ— æ³•å·¥ä½œã€‚\né¢†å¯¼äººé€‰ä¸¾æ˜¯ Raft ä¸­å¯¹æ—¶é—´è¦æ±‚æœ€ä¸ºå…³é”®çš„æ–¹é¢ã€‚Raft å¯ä»¥é€‰ä¸¾å¹¶ç»´æŒä¸€ä¸ªç¨³å®šçš„é¢†å¯¼äºº,åªè¦ç³»ç»Ÿæ»¡è¶³ä¸‹é¢çš„æ—¶é—´è¦æ±‚ï¼š\nbroadcastTime â‰ª electionTimeout â‰ª MTBF(å¹³å‡æ•…éšœæ—¶é—´) broadcastTime: ä»ä¸€ä¸ªæœåŠ¡å™¨å¹¶è¡Œçš„å‘é€ RPC ç»™é›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨å¹¶æ¥æ”¶å“åº”çš„å¹³å‡æ—¶é—´ electionTimeout: é€‰ä¸¾è¶…æ—¶æ—¶é—´ MTBF: å¯¹ä¸€å°æœåŠ¡å™¨è€Œè¨€ï¼Œä¸¤æ¬¡æ•…éšœä¹‹é—´çš„å¹³å‡æ—¶é—´ broadcastTime å¿…é¡»æ¯” electionTimeout å°ä¸€ä¸ªæ•°é‡çº§æ‰èƒ½å¤Ÿå‘é€ç¨³å®šçš„å¿ƒè·³æ¶ˆæ¯æ¥é˜»æ­¢ follower è¿›å…¥é€‰ä¸¾çŠ¶æ€ã€‚ é€šè¿‡éšæœºç”Ÿæˆçš„ electionTimeoutï¼Œè¿™ä¸ªä¸ç­‰å¼ä½¿å¾— split vote çš„æƒ…å†µå˜ä¸ºä¸å¯èƒ½ã€‚ electionTimeout åº”è¯¥æ¯” MTBF å°ä¸Šå‡ ä¸ªæ•°é‡çº§ï¼Œè¿™æ ·ç³»ç»Ÿæ‰èƒ½ç¨³å®šçš„è¿è¡Œã€‚ å½“ leader å´©æºƒåï¼Œæ•´ä¸ªç³»ç»Ÿä¼šåœ¨ä¸€ä¸ª electionTimeout å†…ä¸å¯ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ç§æƒ…å†µåœ¨æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œä¸­å¾ˆå°‘å‡ºç°ã€‚\nbroadcastTime å’Œ MTBF æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä½†æ˜¯ electionTimeout æ˜¯æˆ‘ä»¬è‡ªå·±é€‰æ‹©çš„ã€‚Raft çš„ RPCs éœ€è¦æ¥æ”¶æ–¹å°†ä¿¡æ¯æŒä¹…åŒ–çš„ä¿å­˜åˆ°ç¨³å®šå­˜å‚¨ä¸­å»ï¼Œ æ‰€ä»¥ broadcastTime å¤§çº¦æ˜¯ 0.5 æ¯«ç§’åˆ° 20 æ¯«ç§’ï¼Œå–å†³äºå­˜å‚¨çš„æŠ€æœ¯ã€‚ å› æ­¤ï¼ŒelectionTimeout å¯èƒ½éœ€è¦åœ¨ 10 æ¯«ç§’åˆ° 500 æ¯«ç§’ä¹‹é—´ã€‚å¤§å¤šæ•°çš„æœåŠ¡å™¨çš„ MTBF éƒ½åœ¨å‡ ä¸ªæœˆç”šè‡³æ›´é•¿ï¼Œå¾ˆå®¹æ˜“æ»¡è¶³æ—¶é—´çš„éœ€æ±‚ã€‚\nCluster membership changes \u0026nbsp;https://github.com/OneSizeFitsQuorum/raft-thesis-zh_cn Links é¡¹ç›®åœ°å€: \u0026nbsp;https://pdos.csail.mit.edu/6.824/labs/lab-raft.html Raft å®˜ç½‘: \u0026nbsp;https://raft.github.io/ GFS ç›¸å…³èµ„æ–™: \u0026nbsp;https://fzdwx.github.io/posts/2022-10-07-gfs/#links Raft paper: \u0026nbsp;https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf Raft paper ä¸­æ–‡ç¿»è¯‘: \u0026nbsp;https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md Diagram of Raft interactionsï¼š \u0026nbsp;https://pdos.csail.mit.edu/6.824/notes/raft_diagram.pdf Students guid to Raft: \u0026nbsp;https://thesquareplanet.com/blog/students-guide-to-raft/ Raft locking: \u0026nbsp;https://pdos.csail.mit.edu/6.824/labs/raft-locking.txt Raft structure: \u0026nbsp;https://pdos.csail.mit.edu/6.824/labs/raft-structure.txt Paxos Replicated State Machines as the Basis of a High-Performance Data Store \u0026nbsp;https://static.usenix.org/event/nsdi11/tech/full_papers/Bolosky.pdf TiKV å¯¹äº Raft ä¼˜åŒ– \u0026nbsp;https://cn.pingcap.com/blog/optimizing-raft-in-tikv \u0026nbsp;https://www.cnblogs.com/niejunlei/p/9719557.html \u0026nbsp;https://blog.csdn.net/viskaz/article/details/124232474 \u0026nbsp;https://www.cnblogs.com/brianleelxt/p/13251540.html ","permalink":"https://fzdwx.github.io/posts/2022-10-10-raftkv/","summary":"Lab2æ–‡æ¡£ç¿»è¯‘ ç”±äºæˆ‘çš„è‹±æ–‡ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥ä½¿ç”¨ç¿»è¯‘è½¯ä»¶è¿›è¡Œç¿»è¯‘ï¼Œç„¶åäººå·¥è¿›è¡Œæ ¡å¯¹è¿›è¡Œç†è§£ã€‚\noriginalåœ°å€: \u0026nbsp;https://pdos.csail.mit.edu/6.824/labs/lab-raft.html Introduction è¿™æ˜¯ä¸€ç³»åˆ—å®éªŒä¸­çš„ç¬¬ä¸€ä¸ªï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª fault-tolerant key/value storage system ã€‚ åœ¨æœ¬å®éªŒä¸­æˆ‘ä»¬å°†å®ç° Raft (ä¸€ç§å¤åˆ¶çš„çŠ¶æ€æœºåè®®)ã€‚åœ¨ä¸‹ä¸€ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ Raft ä¸Šæ„å»ºä¸€ä¸ª key/value service ã€‚ ç„¶åï¼Œæ‚¨å°†åœ¨æœ‰å¤šä¸ªå‰¯æœ¬çš„çŠ¶æ€æœºä¸Šè¿›è¡Œ shard(åˆ†ç‰‡ï¼Ÿæ ¹æ® key è¿›è¡Œ hash æ¥å†³å®šè·¯ç”±åˆ°å“ªä¸ªå‰¯æœ¬ä¸Š) æ¥æé«˜æ€§èƒ½ã€‚\nå¤åˆ¶(replication)é€šè¿‡åœ¨å¤šä¸ªå¤åˆ¶æœåŠ¡å™¨ä¸Šå­˜å‚¨å…¶çŠ¶æ€(å³æ•°æ®)çš„å®Œæ•´å‰¯æœ¬æ¥å®ç° fault tolerance ã€‚ å³ä½¿æœ‰ä¸€äº›æœåŠ¡å™¨å‡ºç° failure (å´©æºƒæˆ–ç½‘ç»œæ–­å¼€å’ŒæŠ–åŠ¨) replication ä¹Ÿå…è®¸å®ƒä»¬ç»§ç»­è¿è¡Œã€‚ æŒ‘æˆ˜åœ¨äº failures å¯èƒ½å¯¼è‡´å‰¯æœ¬å­˜åœ¨ä¸åŒçš„æ•°æ®ã€‚\nRaft å°†å®¢æˆ·ç«¯çš„è¯·æ±‚ç»„ç»‡æˆä¸€ä¸ªåºåˆ—ï¼Œè¢«ç§°ä¸º log ï¼Œå¹¶ä¸”ç¡®ä¿æ‰€æœ‰ replica servers çœ‹åˆ°ç›¸åŒçš„ log ã€‚ æ¯ä¸ª replica æŒ‰ç…§æ—¥å¿—çš„é¡ºåºæ¥æ‰§è¡Œå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°†å®ƒä»¬åº”ç”¨äºå…¶æœ¬åœ°çš„æœåŠ¡çŠ¶æ€å‰¯æœ¬(å°±æ˜¯è¿è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤)ã€‚ ç”±äºæ‰€æœ‰å­˜æ´»çš„å‰¯æœ¬è¯»å–çš„æ—¥å¿—å†…å®¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥éƒ½ä»¥ç›¸åŒçš„é¡ºåºæ¥æ‰§è¡Œè¯·æ±‚ï¼Œå› æ­¤å®ƒä»¬éƒ½æœ‰ç›¸åŒçš„æœåŠ¡çŠ¶æ€ã€‚ å¦‚æœä¸€ä¸ªæœåŠ¡å™¨å‘ç”Ÿäº† failure ä½†æ˜¯åæ¥åˆ recovery (æ¢å¤) äº†ï¼ŒRaft ä¼šè´Ÿè´£å°†å®ƒçš„ log æ›´æ–°åˆ°æœ€æ–°çŠ¶æ€ã€‚åªè¦è‡³å°‘å¤§å¤šæ•°çš„æœåŠ¡å™¨è¿˜æ´»ç€ï¼Œå¹¶ä¸”èƒ½å¤Ÿç»§ç»­é€šä¿¡ï¼Œ é‚£ä¹ˆ Raft å°†æŒç»­è¿è¡Œã€‚å¦‚æœæ²¡æœ‰åˆ°è¾¾è¿™ä¸ªæ•°é‡ï¼Œé‚£ä¹ˆ Raft å°†ä¼šåœæ­¢è¿è¡Œï¼Œç›´åˆ°è¾¾åˆ°è¿™ä¸ªæ•°é‡æ‰ä¼šé‡æ–°å¼€å§‹è¿è¡Œã€‚\nåœ¨æœ¬ lab ä¸­ï¼Œä½ å°†æŠŠ Raft å®ç°ä¸ºä¸€ä¸ªå¸¦æœ‰ç›¸å…³æ–¹æ³•çš„ GO çš„å¯¹è±¡ç±»å‹ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½åœ¨æ›´å¤§çš„æ¨¡å—ä¸­ä½¿ç”¨ã€‚ ä¸€ç»„ Raft å®ä¾‹é€šè¿‡ RPC æ¥ç»´æŠ¤ replicated logsã€‚ä½ çš„ Raft å®ä¾‹å°†æ”¯æŒä¸€è¿ä¸²ä¸ç¡®å®šç¼–å·çš„ commandï¼Œ ä¹Ÿå¯ä»¥å« log entriesã€‚ è¿™äº› entity é€šè¿‡ index(ç´¢å¼•)æ¥è¿›è¡Œç¼–å·ã€‚å…·æœ‰ç»™å®šç´¢å¼•çš„ log entry å°†è¢« commitï¼Œ æ­¤æ—¶ï¼Œæ‚¨çš„ Raft åº”è¯¥å°†è¿™æ¡ log å‘é€åˆ° larger service ä¸Šæ‰§è¡Œã€‚","title":"Raft Kv"},{"content":"æœ€è¿‘åœ¨å­¦ä¹  jyy çš„\u0026nbsp; è®¡ç®—æœºç³»ç»ŸåŸºç¡€ä¹ é¢˜è¯¾ ï¼Œ åœ¨åš\u0026nbsp; pa1 çš„æ—¶å€™æ åˆ°ä¸€ä¸ªè¿è¡Œçº¢ç™½æœºæ¸¸æˆçš„\u0026nbsp; é¡¹ç›® è¿è¡Œèµ·æ¥çš„æ•ˆæœ é‡åˆ°çš„å‘:\n1.SIGSTKSZ å‚æ•°æ‰¾ä¸åˆ°\nSIGSTKSZå‚æ•°æ‰¾ä¸åˆ° å°†SIGSTKSZä¿®æ”¹ä¸ºä¸€ä¸ªå›ºå®šçš„å‚æ•°\n//uint8_t sigstack[SIGSTKSZ]; uint8_t sigstack[8192]; 2.serial ä¸æ­£ç¡®\nserialä¸æ­£ç¡® ä¿®æ”¹nemu/src/device/serial.c#init_serialï¼Œæ¯ä¸ªäººçš„ä¸åŒï¼Œæˆ‘çš„æ˜¯ 9ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-10-09-mario-nes/","summary":"æœ€è¿‘åœ¨å­¦ä¹  jyy çš„\u0026nbsp; è®¡ç®—æœºç³»ç»ŸåŸºç¡€ä¹ é¢˜è¯¾ ï¼Œ åœ¨åš\u0026nbsp; pa1 çš„æ—¶å€™æ åˆ°ä¸€ä¸ªè¿è¡Œçº¢ç™½æœºæ¸¸æˆçš„\u0026nbsp; é¡¹ç›® è¿è¡Œèµ·æ¥çš„æ•ˆæœ é‡åˆ°çš„å‘:\n1.SIGSTKSZ å‚æ•°æ‰¾ä¸åˆ°\nSIGSTKSZå‚æ•°æ‰¾ä¸åˆ° å°†SIGSTKSZä¿®æ”¹ä¸ºä¸€ä¸ªå›ºå®šçš„å‚æ•°\n//uint8_t sigstack[SIGSTKSZ]; uint8_t sigstack[8192]; 2.serial ä¸æ­£ç¡®\nserialä¸æ­£ç¡® ä¿®æ”¹nemu/src/device/serial.c#init_serialï¼Œæ¯ä¸ªäººçš„ä¸åŒï¼Œæˆ‘çš„æ˜¯ 9ã€‚","title":"åœ¨Abstract Machineä¸Šç©è¶…çº§é©¬é‡Œå¥¥"},{"content":" Cç¼–è¯‘æ¦‚è¿° å¯ä»¥ç”¨gcc -save-temps xx.cä¿å­˜ç¼–è¯‘çš„ä¸­é—´æ–‡ä»¶\nå®å®šä¹‰ä¸å±•å¼€ å®å±•å¼€: é€šè¿‡ å¤åˆ¶/ç²˜è´´ æ”¹å˜ä»£ç çš„å½¢æ€\nä¸€ä¸ªincludeçš„ä¾‹å­ a.c:\n#include \u0026lt;stdio.h\u0026gt; int main(){ printf( #include \u0026lt;qwe\u0026gt; ); } qwe:\n\u0026#34;hello world\\n\u0026#34; é€šè¿‡è¿è¡Œgcc a.c \u0026amp;\u0026amp; a.outå¾—åˆ°\nâ¯ gcc a.c \u0026amp;\u0026amp; a.out hello world ä¸€ä¸ªdefineçš„ä¾‹å­ a.c:\n#define A \u0026#34;aaaaaaaaaaaa\u0026#34; #define TEN(A) A A A A A A A A A #define B TEN(A) #define C TEN(B) int main(int argc, char const *argv[]) { puts(C); return 0; } å¯ä»¥é€šè¿‡gcc a.c -Eæ¥æŸ¥çœ‹é¢„ç¼–è¯‘çš„ç»“\nâ¯ gcc a.c -E # 0 \u0026#34;a.c\u0026#34; # 0 \u0026#34;\u0026lt;built-in\u0026gt;\u0026#34; # 0 \u0026#34;\u0026lt;command-line\u0026gt;\u0026#34; # 1 \u0026#34;/usr/include/stdc-predef.h\u0026#34; 1 3 4 # 0 \u0026#34;\u0026lt;command-line\u0026gt;\u0026#34; 2 # 1 \u0026#34;a.c\u0026#34; int main(int argc, char const *argv[]) { puts(\u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34; \u0026#34;aaaaaaaaaaaa\u0026#34;); return 0; } ä¿®æ”¹trueå®šä¹‰çš„ä¾‹å­ å®ƒåªåœ¨ç‰¹å®šçš„è¡Œæ•°æ—¶æ‰ä¼šä¸ºtrueã€‚\na.c:\n#define true (__LINE__ % 2 != 0) #include \u0026lt;stdio.h\u0026gt; int main(int argc, char const *argv[]) { if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } if(true){printf(\u0026#34;yes %d\\n\u0026#34;, __LINE__); } } å®šä¹‰ä¸€ä¸ªå®çš„å‚æ•°ä¸ºå‡½æ•° #define NAMES(x) \\ x(Tom) x(Jerry) x(Tyke) x(Spike) int main(int argc, char const *argv[]) { #define PRINT(x) puts(\u0026#34;Hello,\u0026#34; #x \u0026#34;!\u0026#34;); NAMES(PRINT) } å¯ä»¥çœ‹åˆ°ï¼Œå±•å¼€åæ˜¯è°ƒç”¨äº†4éã€‚\nâ¯ gcc -E a.c # 0 \u0026#34;a.c\u0026#34; # 0 \u0026#34;\u0026lt;built-in\u0026gt;\u0026#34; # 0 \u0026#34;\u0026lt;command-line\u0026gt;\u0026#34; # 1 \u0026#34;/usr/include/stdc-predef.h\u0026#34; 1 3 4 # 0 \u0026#34;\u0026lt;command-line\u0026gt;\u0026#34; 2 # 1 \u0026#34;a.c\u0026#34; int main(int argc, char const *argv[]) { puts(\u0026#34;Hello,\u0026#34; \u0026#34;Tom\u0026#34; \u0026#34;!\u0026#34;); puts(\u0026#34;Hello,\u0026#34; \u0026#34;Jerry\u0026#34; \u0026#34;!\u0026#34;); puts(\u0026#34;Hello,\u0026#34; \u0026#34;Tyke\u0026#34; \u0026#34;!\u0026#34;); puts(\u0026#34;Hello,\u0026#34; \u0026#34;Spike\u0026#34; \u0026#34;!\u0026#34;); } Cç¨‹åºæ‰§è¡Œçš„ä¸¤ä¸ªè§†è§’ é™æ€: Cä»£ç è¿ç»­çš„ä¸€æ®µæ€»èƒ½æ‰¾åˆ°å¯¹åº”ä¸€æ®µè¿ç»­çš„æœºå™¨æŒ‡ä»¤ åŠ¨æ€: Cä»£ç æ‰§è¡Œçš„çŠ¶æ€æ€»èƒ½å¯¹åº”åˆ°æœºå™¨çš„çŠ¶æ€\næºä»£ç è§†è§’: å‡½æ•°ï¼Œå˜é‡ï¼ŒæŒ‡é’ˆ æœºå™¨æŒ‡ä»¤è§†è§’: å¯„å­˜å™¨ï¼Œå†…å­˜ï¼Œåœ°å€ å…±åŒçš„åœ°æ–¹: å†…å­˜\nä»£ç ï¼Œå˜é‡(æºä»£ç ) = åœ°å€ + é•¿åº¦(æœºå™¨æŒ‡ä»¤) å†…å­˜ = ä»£ç  + æ•°æ® + å †æ ˆ æ‰€ä»¥ç†è§£Cç¨‹åºæ‰§è¡Œæœ€é‡è¦çš„å°±æ—¶å†…å­˜æ¨¡å‹ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-10-09-c-compile/","summary":"Cç¼–è¯‘æ¦‚è¿° å¯ä»¥ç”¨gcc -save-temps xx.cä¿å­˜ç¼–è¯‘çš„ä¸­é—´æ–‡ä»¶\nå®å®šä¹‰ä¸å±•å¼€ å®å±•å¼€: é€šè¿‡ å¤åˆ¶/ç²˜è´´ æ”¹å˜ä»£ç çš„å½¢æ€\nä¸€ä¸ªincludeçš„ä¾‹å­ a.c:\n#include \u0026lt;stdio.h\u0026gt; int main(){ printf( #include \u0026lt;qwe\u0026gt; ); } qwe:\n\u0026#34;hello world\\n\u0026#34; é€šè¿‡è¿è¡Œgcc a.c \u0026amp;\u0026amp; a.outå¾—åˆ°\nâ¯ gcc a.c \u0026amp;\u0026amp; a.out hello world ä¸€ä¸ªdefineçš„ä¾‹å­ a.c:\n#define A \u0026#34;aaaaaaaaaaaa\u0026#34; #define TEN(A) A A A A A A A A A #define B TEN(A) #define C TEN(B) int main(int argc, char const *argv[]) { puts(C); return 0; } å¯ä»¥é€šè¿‡gcc a.c -Eæ¥æŸ¥çœ‹é¢„ç¼–è¯‘çš„ç»“","title":"C Compile"},{"content":" ä¸ºäº†æ€§èƒ½(Performance), æ‰€ä»¥å°†æ•°æ®åˆ†å‰²æ”¾åˆ°å¤§é‡çš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œå®ç°å¹¶è¡Œçš„è¯»å–æ•°æ®ï¼Œè¿™å°±æ˜¯åˆ†ç‰‡(Sharding)ã€‚ è€Œæˆè´¥ä¸Šåƒçš„æœºå™¨æ€»ä¼šå‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥æœ‰äº†å®¹é”™(Fault Tolerance)ã€‚ å®ç°å®¹é”™æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å¤åˆ¶(Replication)ï¼Œå…¶ä¸­ä¸€ä¸ªå‘ç”Ÿæ•…éšœäº†å°±åˆ‡æ¢å¦ä¸€ä¸ªã€‚ ä½¿ç”¨äº†å¤åˆ¶ï¼Œå¦‚æœä½ ä¸å¤Ÿå°å¿ƒï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´å°±å¯èƒ½ä¼šä¸ä¸€è‡´ã€‚æ•°æ®å°±æœ‰å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸ä¸€è‡´çš„é—®é¢˜(Inconsistency)ã€‚ å¦‚æœä¸ºäº†å®ç°ä¸€è‡´æ€§(Consistency)ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤šè¿›è¡Œé¢å¤–çš„äº¤äº’æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œæ‰€ä»¥ä»£ä»·å°±æ˜¯ä½æ€§èƒ½(Low Perf) ï¼Œä½†è¿™ä¸æˆ‘ä»¬å¼€å§‹çš„å¸Œæœ›ä¸ç¬¦åˆã€‚ TIP Soï¼Œå¼ºä¸€è‡´æ€§ä»£è¡¨ç€ä½æ€§èƒ½ã€‚ è®¾è®¡ç›®æ ‡ ç”±äºGFSæ˜¯å»ºç«‹åœ¨å¤§é‡çš„è®¡ç®—æœºä¸Šçš„ï¼Œè€Œè¿™äº›è®¡ç®—æœºä¼šä¸å¯é¿å…çš„å‘ç”Ÿæ•…éšœã€‚æ‰€ä»¥å¿…é¡»è¦è¿›è¡Œï¼šæ£€æŸ¥ï¼Œå®¹é”™ä»¥åŠå¿«é€Ÿä»æ•…éšœæ¢å¤ã€‚ ä¸»è¦æ”¯æŒå¤§æ–‡ä»¶(ä¾‹å¦‚è¯´å¥½å‡ ä¸ªGçš„æ–‡ä»¶)ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå°æ–‡ä»¶ä½†ä¸åšé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚ å·¥ä½œè´Ÿè½½ä¸»è¦ç”±ä¸¤ç§ç±»å‹çš„è¯»å–ç»„æˆï¼šå¤§çš„æµå¼è¯»å–å’Œå°çš„éšæœºè¯»å– ã€‚å¯¹äºæ€§èƒ½æœ‰è¿‡ç‰¹åˆ«è€ƒè™‘çš„åº”ç”¨é€šå¸¸ä¼šä½œæ‰¹å¤„ç†å¹¶ä¸”å¯¹ä»–ä»¬è¯»å–çš„å†…å®¹è¿›è¡Œæ’åºï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—ä»–ä»¬çš„è¯»å–å§‹ç»ˆæ˜¯å•å‘é¡ºåºè¯»å–ï¼Œè€Œä¸éœ€è¦å¾€å›è¯»å–æ•°æ®ã€‚ åœ¨å¤§çš„æµå¼è¯»å–ä¸­ï¼Œå•ä¸ªæ“ä½œé€šå¸¸è¦è¯»å–æ•°ç™¾kï¼Œç”šè‡³1mæˆ–è€…æ›´å¤§çš„æ•°æ®ã€‚å¯¹äºåŒä¸€ä¸ªå®¢æˆ·ç«¯æ¥è¯´ï¼Œå¾€å¾€ä¼šå‘èµ·è¿ç»­çš„è¯»å–æ“ä½œé¡ºåºè¯»å–ä¸€ä¸ªæ–‡ä»¶ã€‚ å°çš„éšæœºè¯»å–é€šå¸¸åœ¨æŸä¸ªä»»æ„çš„åç§»ä½ç½®è¯»å–å‡ kbçš„æ•°æ®ã€‚å°è§„æ¨¡çš„éšæœºè¯»å–é€šå¸¸åœ¨æ–‡ä»¶çš„ä¸åŒä½ç½®ï¼Œè¯»å–å‡ kæ•°æ®ã€‚ GFSä¸­çš„æ–‡ä»¶é€šå¸¸ä¸Šä¸€æ—¦å®Œæˆå†™å…¥å°±å¾ˆå°‘ä¼šå†æ¬¡ä¿®æ”¹ï¼Œæ‰€ä»¥ä¸»è¦é’ˆå¯¹å¤§çš„æµå¼è¯»å–ï¼ŒåŒæ—¶å¤œæ”¯æŒä»»æ„ä½ç½®çš„å°è§„æ¨¡å†™å…¥æ“ä½œã€‚ GFSå¯¹å¤šä¸ªå®¢æˆ·ç«¯å¹¶è¡Œæ·»åŠ åŒä¸€ä¸ªæ–‡ä»¶å¿…é¡»è¦æœ‰éå¸¸æœ‰æ•ˆä¸”æ˜ç¡®è¯­ä¹‰çš„æ”¯æŒï¼Œå³åŸå­æ“ä½œã€‚é€šå¸¸ä¼šæœ‰å¤šä¸ªå®¢æˆ·ç«¯ä¼šå¹¶è¡Œçš„å¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œappendã€‚ é«˜æ€§èƒ½çš„ç¨³å®šå¸¦å®½çš„ç½‘ç»œè¦æ¯”ä½å»¶æ—¶æ›´åŠ é‡è¦ã€‚æˆ‘ä»¬å¤§å¤šæ•°çš„ç›®æ ‡åº”ç”¨ç¨‹åºéƒ½éå¸¸é‡è§†é«˜é€Ÿæ‰¹é‡å¤„ç†æ•°æ® ï¼Œè€Œå¾ˆå°‘æœ‰äººå¯¹å•ä¸ªè¯»å†™æ“ä½œæœ‰ä¸¥æ ¼çš„å“åº”æ—¶é—´è¦æ±‚ã€‚ æ¶æ„ å•ä¸ªmasterï¼Œå¤šä¸ªchunk server(ä¿å­˜å…·ä½“çš„æ–‡ä»¶)ï¼Œå¤šä¸ªclientã€‚ æ¯ä¸ªæ–‡ä»¶è¢«æ‹†åˆ†ä¸ºä¸€å®šå¤§å°(64mb)çš„å—(chunk)ï¼Œä¸”æ¯ä¸ªchunkæœ‰ä¸€ä¸ªå”¯ä¸€çš„64ä½çš„æ ‡å¿—(chunk handle)ã€‚ æ¯ä¸ªchunkéƒ½ä¼šåœ¨ä¸åŒçš„chunk serverä¸Šä¿å­˜å¤‡ä»½(é»˜è®¤æ˜¯3ä¸ª)ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šä¸åŒçš„å¤åˆ¶çº§åˆ«ã€‚ masterç®¡ç†å…ƒæ•°æ®(metadata)ï¼Œä¾‹å¦‚æ–‡ä»¶åˆ°chunkçš„æ˜ å°„å…³ç³»ï¼Œchunkçš„ä½ç½®ä¿¡æ¯ç­‰ã€‚ masterç®¡ç†chunkçš„åˆ†ç‰‡ï¼Œå­¤ç‚¹chunkçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œchunk serverä¹‹é—´çš„é•œåƒç®¡ç†ç­‰ æ¯ä¸ªchunk serverä¸masterä¹‹é—´æœ‰å¿ƒè·³æœºåˆ¶ï¼Œå¹¶åœ¨æ£€æµ‹çš„è¿‡ç¨‹ä¸­å¹´å‘å‡ºæŒ‡ä»¤å¹¶æ”¶é›†çŠ¶æ€ã€‚ GFS Masterä¸­çš„metadata filename -\u0026gt; chunk ids(chunk handles) NV chunk handleä¸chunkæ•°æ®çš„å¯¹åº”å…³ç³» chunkä¿å­˜åœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Š(chunk server list) chunkçš„version no NV chunkçš„primary chunk serverï¼Œå› ä¸ºå†™æ“ä½œåœ¨åœ¨å…¶ä¸Šè¿›è¡Œ primary chunk serverçš„lease expiration è¿™ä¸¤ä¸ªdata tableéƒ½åœ¨masterçš„å†…å­˜ä¸­å­˜æ”¾ï¼Œä¸ºäº†å®¹é”™(ä¾‹å¦‚è¯´é‡å¯åæ•°æ®ä¸ä¸¢å¤±æ•°æ®)ï¼Œå®ƒä¼šåœ¨ç£ç›˜ä¸Šå­˜å‚¨logï¼Œè¯»å–çš„ä½¿ç”¨ä»å†…å­˜é‡Œé¢è¯»å–ï¼Œå†™çš„æ—¶å€™ä¼šå†™å…¥å†…å­˜ä»¥åŠç£ç›˜ã€‚ æ¯å½“æœ‰æ•°æ®å˜æ›´æ—¶ï¼Œå°±ä¼šåœ¨ç£ç›˜ä¸Šçš„æ—¥å¿—è¿›è¡Œè¿½åŠ ï¼Œå¹¶ä¸”å®šæœŸ(æ—¥å¿—å¢é•¿è¶…è¿‡æŸä¸€ä¸ªå¤§å°)åˆ›å»ºcheckpoint(ç±»ä¼¼å¿«ç…§ï¼Œä¸ç”¨ä»å¤´å¼€å§‹è¯»å–)\nGFS Read Steps é¦–å…ˆè¯»è¯·æ±‚å°±è¡¨æ˜clientæœ‰filenameä»¥åŠæƒ³è¦è¯»å–çš„ä½ç½®(offset)ï¼Œç„¶åå‘é€ç»™masterã€‚ masteræ”¶åˆ°è¯·æ±‚åå°±ä»filenamesä¸­è·å–å¯¹åº”çš„chunk handlesã€‚è€Œæ¯ä¸ªchunkçš„å¤§å°ä¸Šå›ºå®šçš„ï¼Œæ‰€ä»¥å°±å¾—åˆ°çš„å…·ä½“å¼€å§‹çš„chunk handleã€‚ ç„¶åæ ¹æ®chunk handleæ‰¾åˆ°å¯¹åº”å­˜æ”¾æ•°æ®çš„chunk serverçš„åˆ—è¡¨è¿”å›ç»™clientã€‚ clientå¯ä»¥é€‰æ‹©ä¸€ä¸ªserveræ¥è¿›è¡Œè¯»å–(è®ºæ–‡ä¸­è¯´ä¼šé€‰æ‹©ä¸€ä¸ªæœ€è¿‘çš„æœåŠ¡å™¨ï¼Œåº”ä¸ºgoogleé‡Œé¢ipæ˜¯è¿ç»­çš„ï¼Œå¯ä»¥æ ¹æ®ipåˆ¤æ–­è¿œè¿‘) ï¼Œåº”ä¸ºå®¢æˆ·ç«¯æ¯æ¬¡åªè¯»å–1mbæˆ–è€…64kbçš„æ•°æ®ï¼Œæ‰€ä»¥å®ƒä¼šç¼“å­˜chunkä¸chunk serverçš„å…³ç³»ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è¯·æ±‚ã€‚ chunk serveræ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®chunk handle(æ¨æµ‹chunkæ˜¯å®‰è£…chunk handleè¿›è¡Œå‘½åçš„)æ‰¾åˆ°å¯¹åº”çš„chunkä»¥åŠoffsetå¯¹åº”çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚ q1: å¦‚æœè¯»å–çš„æ•°æ®è·¨è¶Šäº†ä¸€ä¸ªchunkæ€ä¹ˆåŠï¼Ÿ ä¾‹å¦‚è¯´clientæƒ³è¦è¯»å–çš„æ•°æ®è¶…è¿‡äº†64mbï¼Œæˆ–è€…ä»…ä»…ä¸Šæ˜¯2ä¸ªbyteå´è·¨è¶Šäº†chunkï¼Œclientä¼šåœ¨å‘é€è¯·æ±‚æ—¶æ³¨æ„åˆ°è¿™æ¬¡è¯·æ±‚è·¨è¶Šäº†è¾¹ç•Œï¼Œ æ‰€ä»¥ä¼šå°†ä¸€ä¸ªè¯·æ±‚æ‹†åˆ†ä¸º2ä¸ªè¯·æ±‚å‘é€åˆ°masterï¼Œæ‰€ä»¥è¿™é‡Œå¯èƒ½ä¸Šå‘masterå‘é€ä¸¤æ¬¡è¯»è¯·æ±‚ï¼Œä¹‹ååœ¨å‘ä¸åŒçš„chunk serverè¯»å–æ•°æ®ã€‚\nå¤šä¸ªå‰¯æœ¬ä¹‹é—´å˜æ›´é¡ºåºçš„ä¸€è‡´æ€§ é’ˆå¯¹ä¸€ä¸ªchunk\nmasteræˆæƒç»™æŸä¸ªæŒæœ‰è¿™ä¸ªchunkçš„serverä¸€ä¸ªç§Ÿçº¦æœŸé™(60s)ï¼Œç§°ä¸ºprimaryã€‚ primaryå¯¹æ‰€æœ‰çš„æ›´æ”¹æ“ä½œè¿›è¡Œæ’åº(serial order)ï¼Œç„¶åå…¶ä»–çš„secondaryæ ¹æ®è¿™ä¸ªé¡ºåºè¿›è¡Œå˜æ›´ã€‚ åªè¦è¿™ä¸ªchunkæ­£åœ¨å˜æ›´ï¼Œé‚£ä¹ˆprimaryå°±å¯ä»¥å‘masterç”³è¯·å»¶é•¿ç§Ÿçº¦ã€‚ GFS Write Steps clientå‘masterå‘é€è¯·æ±‚è·å–chunk server list(primary,secondaries)ï¼Œ å¦‚æœæ²¡æœ‰primaryï¼Œmasterå°±ä¼šé€‰æ‹©ä¸€ä¸ªsecondaryæˆä¸ºprimaryã€‚ clientè·å–åˆ°chunk server liståä¼šç¼“å­˜ä¸‹æ¥ï¼Œåªæœ‰å½“primary æ²¡æœ‰å“åº”æˆ–ç§Ÿçº¦è¿‡æœŸåæ‰ä¼šå†æ¬¡è¯·æ±‚ã€‚ clientå°†æ•°æ®æ¨é€åˆ°æ‰€æœ‰replicasï¼Œå®¢æˆ·ç«¯ä¸ä¿è¯æ¨é€çš„é¡ºåºï¼Œæ¯ä¸ªchunk serverä¼šå°†æ•°æ®ä¿å­˜åœ¨å†…éƒ¨çš„lur cacheä¸­ï¼Œç›´åˆ°æ•°æ®è¢«ä½¿ç”¨æˆ–è¿‡æœŸã€‚ å½“æ‰€æœ‰replicaséƒ½æ”¶åˆ°äº†æ•°æ®ï¼Œclientå°†ä¼šå‘é€ä¸€ä¸ªå†™è¯·æ±‚åˆ°primaryï¼Œå®ƒæ ‡è¯†äº†ä¹‹å‰æ¨é€åˆ°æ¯ä¸ªå‰¯æœ¬çš„æ•°æ®ã€‚ primaryå°†è¿™äº›å†™å…¥ç»„ç»‡æˆä¸€å®šçš„é¡ºåºåº”ç”¨åˆ°è‡ªå·±æœ¬åœ°ã€‚ primaryç„¶åå°†è¿™ä¸ªåº”ç”¨é¡ºåºè½¬å‘ç»™å„ä¸ªsecondaryã€‚ secondariesåº”ç”¨è¿™ä¸ªé¡ºåºå®Œæˆä¿®æ”¹å¹¶ç­”å¤primaryã€‚ primaryç­”å¤clientï¼Œå¦‚æœå‡ºç°äº†ä»»æ„é”™è¯¯ä¹Ÿä¼šç­”å¤ç»™clientã€‚åœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œwrite requestä¹Ÿå¯èƒ½åœ¨primaryä»¥åŠsecondaryä¸­æˆåŠŸ (å¦‚æœprimaryç›´æ¥å°±å¤±è´¥äº†ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šè½¬å‘serial orderç»™secondaries)ï¼Œclientå°†è®¤ä¸ºè¿™æ¬¡è¯·æ±‚æ˜¯å¤±è´¥çš„ï¼Œå®ƒä¼šé€šè¿‡é‡è¯•æ¥å¤„ç†( 3-7å°è¯•å‡ æ¬¡é‡æ–°å†™å…¥) GFS Atomic Record Appends å¯¹åŒä¸€ç‰‡åŒºåŸŸä¸ªå¹¶å‘å†™å…¥æ˜¯ä¸å¯åºåˆ—åŒ–çš„ è¿™ç‰‡åŒºåŸŸå¯èƒ½æœ€ç»ˆåŒ…å«å¤šä¸ªå®¢æˆ·ç«¯çš„æ•°æ®ç‰‡æ®µã€‚ ä¸€ä¸ªåŸå­çš„appendæ“ä½œã€‚recored appendè‡³å°‘ä¼šåœ¨ç»™å®šçš„offset(GFSè‡ªå·±é€‰æ‹©çš„ï¼Œå› ä¸ºè¿™é‡Œå¯èƒ½ä¼šå¤±è´¥ï¼Œå¯èƒ½æœ‰ä¸€äº›chunk serverä¸Šæœ‰è¿™ä¸ªæ•°æ®) ä¸Šè¿½åŠ åˆ°æ–‡ä»¶ä¸Šä¸€æ¬¡ï¼Œå¹¶å°†è¯¥offsetè¿”å›ç»™clientã€‚å®ƒç±»ä¼¼O_APPENDä¿è¯åŸå­æ€§ã€‚ recored appendéµå®ˆ\u0026nbsp; GFS Write Steps æµç¨‹ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç‰¹åˆ«çš„åœ°æ–¹:\nclientæ¨é€æ‰€æœ‰æ•°æ®åï¼Œprimaryä¼šæ£€æŸ¥appendåˆ°è¯¥chunkåæ˜¯å¦è¶…è¿‡äº†å•ä¸ªchunkçš„å¤§å°ã€‚ å¦‚æœè¶…è¿‡äº†ï¼Œåˆ™åœ¨å½“å‰chunkå¡«å……åˆ°æœ€å¤§offsetæ—¶(secondaryä¹Ÿè¦ä¿å­˜)ï¼Œå›å¤clientï¼ŒæŒ‡å‡ºè¯¥æ“ä½œåº”è¯¥åœ¨ä¸‹ä¸€ä¸ªchunkä¸Šé‡è¯•( recordçš„å¤§å°éœ€è¦æ§åˆ¶åœ¨å•ä¸ªchunkæœ€å¤§å€¼çš„å››åˆ†ä¹‹ä¸€ï¼Œä»¥ä¿è¯ç¢ç‰‡åœ¨å¯æ¥æ”¶çš„æ°´å¹³)ã€‚ å¦‚æœæ²¡æœ‰è¶…è¿‡æœ€å¤§å¤§å°ï¼Œåˆ™æŒ‰ç…§æ­£å¸¸çš„æƒ…å†µè¿›è¡Œä¿å­˜ã€‚ è¿‡æœŸå‰¯æœ¬æ£€æµ‹ å¦‚æœchunk serverå‘ç”Ÿæ•…éšœè€Œå®•æœºæˆ–è€…ä¸¢å¤±äº†æŸäº›æ›´æ–°è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒå°±æœ‰å¯èƒ½è¿‡æœŸäº†ã€‚å¯¹äºæ¯ä¸ªchunkï¼Œmasteréƒ½ç»´æŠ¤äº†ä¸€ä¸ªversion noæ¥æ ‡è¯†æœ€æ–°å’Œè¿‡æœŸçš„å‰¯æœ¬ã€‚\nå½“masterä¸ºä¸€ä¸ªchunkçš„primary serveræˆæƒæˆ–ç»­æœŸæ—¶å°±ä¼šå¢åŠ version noå¹¶é€šçŸ¥æ‰€æœ‰replicasè¿›è¡Œæ›´æ–°ã€‚\nåœ¨æ•°æ®ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œmasterå’Œæ‰€æœ‰replicasçš„version noæ˜¯ä¸€è‡´çš„(åœ¨clientå‘é€å†™è¯·æ±‚ä¹‹å‰å¯ä»¥ä¿è¯)ã€‚\nå½“chunk serveré‡å¯æˆ–ä¸ŠæŠ¥version noæ—¶ï¼Œmasterä¼šæ£€æŸ¥å®ƒæ—¶å¦åŒ…å«è¿‡æœŸçš„å‰¯æœ¬ï¼Œå¦‚æœå‘ç°masterå‘ç°version noå¤§äºå®ƒçš„è®°å½•ï¼Œmasterä¼šé‡‡ç”¨æ›´é«˜çš„version noè¿›è¡Œæ›´æ–°ã€‚\nmasteré€šè¿‡å‘¨æœŸæ€§çš„åƒåœ¾å›æ”¶æ¥åˆ é™¤è¿‡æœŸçš„å‰¯æœ¬ï¼Œåœ¨åˆ é™¤å‰ï¼Œå®ƒä¼šç¡®è®¤åœ¨å®ƒæ‰€æœ‰clientçš„chunkä¿¡æ¯è¯·æ±‚çš„åº”ç­”ä¸­æ²¡æœ‰åŒ…å«è¿™ä¸ªè¿‡æœŸçš„å‰¯æœ¬ã€‚\nclientåœ¨ä»masterè·å–chunk serveråˆ—è¡¨æ—¶ä¼šé™„å¸¦è·å–version noï¼Œæ‰€ä»¥å®ƒå¯ä»¥è¿›è¡Œæ¯”å¯¹ï¼Œé€‰æ‹©æœ€æ–°çš„å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚\næ€»ç»“ è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªåˆæ ¼çš„å¤šå‰¯æœ¬ï¼Œå¤šæ´»ï¼Œé«˜å¯ç”¨ï¼Œæ•…éšœè‡ªä¿®å¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚\nLinks \u0026nbsp;gfs paper åŸæ–‡ \u0026nbsp;gfs paper ä¸­æ–‡ç¿»è¯‘ \u0026nbsp;gfs è§†é¢‘ \u0026nbsp;gfs è§†é¢‘ç¿»è¯‘ \u0026nbsp;Bad Replication Design ","permalink":"https://fzdwx.github.io/posts/2022-10-07-gfs/","summary":"ä¸ºäº†æ€§èƒ½(Performance), æ‰€ä»¥å°†æ•°æ®åˆ†å‰²æ”¾åˆ°å¤§é‡çš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œå®ç°å¹¶è¡Œçš„è¯»å–æ•°æ®ï¼Œè¿™å°±æ˜¯åˆ†ç‰‡(Sharding)ã€‚ è€Œæˆè´¥ä¸Šåƒçš„æœºå™¨æ€»ä¼šå‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥æœ‰äº†å®¹é”™(Fault Tolerance)ã€‚ å®ç°å®¹é”™æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å¤åˆ¶(Replication)ï¼Œå…¶ä¸­ä¸€ä¸ªå‘ç”Ÿæ•…éšœäº†å°±åˆ‡æ¢å¦ä¸€ä¸ªã€‚ ä½¿ç”¨äº†å¤åˆ¶ï¼Œå¦‚æœä½ ä¸å¤Ÿå°å¿ƒï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´å°±å¯èƒ½ä¼šä¸ä¸€è‡´ã€‚æ•°æ®å°±æœ‰å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸ä¸€è‡´çš„é—®é¢˜(Inconsistency)ã€‚ å¦‚æœä¸ºäº†å®ç°ä¸€è‡´æ€§(Consistency)ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤šè¿›è¡Œé¢å¤–çš„äº¤äº’æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œæ‰€ä»¥ä»£ä»·å°±æ˜¯ä½æ€§èƒ½(Low Perf) ï¼Œä½†è¿™ä¸æˆ‘ä»¬å¼€å§‹çš„å¸Œæœ›ä¸ç¬¦åˆã€‚ TIP Soï¼Œå¼ºä¸€è‡´æ€§ä»£è¡¨ç€ä½æ€§èƒ½ã€‚ è®¾è®¡ç›®æ ‡ ç”±äºGFSæ˜¯å»ºç«‹åœ¨å¤§é‡çš„è®¡ç®—æœºä¸Šçš„ï¼Œè€Œè¿™äº›è®¡ç®—æœºä¼šä¸å¯é¿å…çš„å‘ç”Ÿæ•…éšœã€‚æ‰€ä»¥å¿…é¡»è¦è¿›è¡Œï¼šæ£€æŸ¥ï¼Œå®¹é”™ä»¥åŠå¿«é€Ÿä»æ•…éšœæ¢å¤ã€‚ ä¸»è¦æ”¯æŒå¤§æ–‡ä»¶(ä¾‹å¦‚è¯´å¥½å‡ ä¸ªGçš„æ–‡ä»¶)ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå°æ–‡ä»¶ä½†ä¸åšé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚ å·¥ä½œè´Ÿè½½ä¸»è¦ç”±ä¸¤ç§ç±»å‹çš„è¯»å–ç»„æˆï¼šå¤§çš„æµå¼è¯»å–å’Œå°çš„éšæœºè¯»å– ã€‚å¯¹äºæ€§èƒ½æœ‰è¿‡ç‰¹åˆ«è€ƒè™‘çš„åº”ç”¨é€šå¸¸ä¼šä½œæ‰¹å¤„ç†å¹¶ä¸”å¯¹ä»–ä»¬è¯»å–çš„å†…å®¹è¿›è¡Œæ’åºï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—ä»–ä»¬çš„è¯»å–å§‹ç»ˆæ˜¯å•å‘é¡ºåºè¯»å–ï¼Œè€Œä¸éœ€è¦å¾€å›è¯»å–æ•°æ®ã€‚ åœ¨å¤§çš„æµå¼è¯»å–ä¸­ï¼Œå•ä¸ªæ“ä½œé€šå¸¸è¦è¯»å–æ•°ç™¾kï¼Œç”šè‡³1mæˆ–è€…æ›´å¤§çš„æ•°æ®ã€‚å¯¹äºåŒä¸€ä¸ªå®¢æˆ·ç«¯æ¥è¯´ï¼Œå¾€å¾€ä¼šå‘èµ·è¿ç»­çš„è¯»å–æ“ä½œé¡ºåºè¯»å–ä¸€ä¸ªæ–‡ä»¶ã€‚ å°çš„éšæœºè¯»å–é€šå¸¸åœ¨æŸä¸ªä»»æ„çš„åç§»ä½ç½®è¯»å–å‡ kbçš„æ•°æ®ã€‚å°è§„æ¨¡çš„éšæœºè¯»å–é€šå¸¸åœ¨æ–‡ä»¶çš„ä¸åŒä½ç½®ï¼Œè¯»å–å‡ kæ•°æ®ã€‚ GFSä¸­çš„æ–‡ä»¶é€šå¸¸ä¸Šä¸€æ—¦å®Œæˆå†™å…¥å°±å¾ˆå°‘ä¼šå†æ¬¡ä¿®æ”¹ï¼Œæ‰€ä»¥ä¸»è¦é’ˆå¯¹å¤§çš„æµå¼è¯»å–ï¼ŒåŒæ—¶å¤œæ”¯æŒä»»æ„ä½ç½®çš„å°è§„æ¨¡å†™å…¥æ“ä½œã€‚ GFSå¯¹å¤šä¸ªå®¢æˆ·ç«¯å¹¶è¡Œæ·»åŠ åŒä¸€ä¸ªæ–‡ä»¶å¿…é¡»è¦æœ‰éå¸¸æœ‰æ•ˆä¸”æ˜ç¡®è¯­ä¹‰çš„æ”¯æŒï¼Œå³åŸå­æ“ä½œã€‚é€šå¸¸ä¼šæœ‰å¤šä¸ªå®¢æˆ·ç«¯ä¼šå¹¶è¡Œçš„å¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œappendã€‚ é«˜æ€§èƒ½çš„ç¨³å®šå¸¦å®½çš„ç½‘ç»œè¦æ¯”ä½å»¶æ—¶æ›´åŠ é‡è¦ã€‚æˆ‘ä»¬å¤§å¤šæ•°çš„ç›®æ ‡åº”ç”¨ç¨‹åºéƒ½éå¸¸é‡è§†é«˜é€Ÿæ‰¹é‡å¤„ç†æ•°æ® ï¼Œè€Œå¾ˆå°‘æœ‰äººå¯¹å•ä¸ªè¯»å†™æ“ä½œæœ‰ä¸¥æ ¼çš„å“åº”æ—¶é—´è¦æ±‚ã€‚ æ¶æ„ å•ä¸ªmasterï¼Œå¤šä¸ªchunk server(ä¿å­˜å…·ä½“çš„æ–‡ä»¶)ï¼Œå¤šä¸ªclientã€‚ æ¯ä¸ªæ–‡ä»¶è¢«æ‹†åˆ†ä¸ºä¸€å®šå¤§å°(64mb)çš„å—(chunk)ï¼Œä¸”æ¯ä¸ªchunkæœ‰ä¸€ä¸ªå”¯ä¸€çš„64ä½çš„æ ‡å¿—(chunk handle)ã€‚ æ¯ä¸ªchunkéƒ½ä¼šåœ¨ä¸åŒçš„chunk serverä¸Šä¿å­˜å¤‡ä»½(é»˜è®¤æ˜¯3ä¸ª)ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šä¸åŒçš„å¤åˆ¶çº§åˆ«ã€‚ masterç®¡ç†å…ƒæ•°æ®(metadata)ï¼Œä¾‹å¦‚æ–‡ä»¶åˆ°chunkçš„æ˜ å°„å…³ç³»ï¼Œchunkçš„ä½ç½®ä¿¡æ¯ç­‰ã€‚ masterç®¡ç†chunkçš„åˆ†ç‰‡ï¼Œå­¤ç‚¹chunkçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œchunk serverä¹‹é—´çš„é•œåƒç®¡ç†ç­‰ æ¯ä¸ªchunk serverä¸masterä¹‹é—´æœ‰å¿ƒè·³æœºåˆ¶ï¼Œå¹¶åœ¨æ£€æµ‹çš„è¿‡ç¨‹ä¸­å¹´å‘å‡ºæŒ‡ä»¤å¹¶æ”¶é›†çŠ¶æ€ã€‚ GFS Masterä¸­çš„metadata filename -\u0026gt; chunk ids(chunk handles) NV chunk handleä¸chunkæ•°æ®çš„å¯¹åº”å…³ç³» chunkä¿å­˜åœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Š(chunk server list) chunkçš„version no NV chunkçš„primary chunk serverï¼Œå› ä¸ºå†™æ“ä½œåœ¨åœ¨å…¶ä¸Šè¿›è¡Œ primary chunk serverçš„lease expiration è¿™ä¸¤ä¸ªdata tableéƒ½åœ¨masterçš„å†…å­˜ä¸­å­˜æ”¾ï¼Œä¸ºäº†å®¹é”™(ä¾‹å¦‚è¯´é‡å¯åæ•°æ®ä¸ä¸¢å¤±æ•°æ®)ï¼Œå®ƒä¼šåœ¨ç£ç›˜ä¸Šå­˜å‚¨logï¼Œè¯»å–çš„ä½¿ç”¨ä»å†…å­˜é‡Œé¢è¯»å–ï¼Œå†™çš„æ—¶å€™ä¼šå†™å…¥å†…å­˜ä»¥åŠç£ç›˜ã€‚ æ¯å½“æœ‰æ•°æ®å˜æ›´æ—¶ï¼Œå°±ä¼šåœ¨ç£ç›˜ä¸Šçš„æ—¥å¿—è¿›è¡Œè¿½åŠ ï¼Œå¹¶ä¸”å®šæœŸ(æ—¥å¿—å¢é•¿è¶…è¿‡æŸä¸€ä¸ªå¤§å°)åˆ›å»ºcheckpoint(ç±»ä¼¼å¿«ç…§ï¼Œä¸ç”¨ä»å¤´å¼€å§‹è¯»å–)\nGFS Read Steps é¦–å…ˆè¯»è¯·æ±‚å°±è¡¨æ˜clientæœ‰filenameä»¥åŠæƒ³è¦è¯»å–çš„ä½ç½®(offset)ï¼Œç„¶åå‘é€ç»™masterã€‚ masteræ”¶åˆ°è¯·æ±‚åå°±ä»filenamesä¸­è·å–å¯¹åº”çš„chunk handlesã€‚è€Œæ¯ä¸ªchunkçš„å¤§å°ä¸Šå›ºå®šçš„ï¼Œæ‰€ä»¥å°±å¾—åˆ°çš„å…·ä½“å¼€å§‹çš„chunk handleã€‚ ç„¶åæ ¹æ®chunk handleæ‰¾åˆ°å¯¹åº”å­˜æ”¾æ•°æ®çš„chunk serverçš„åˆ—è¡¨è¿”å›ç»™clientã€‚ clientå¯ä»¥é€‰æ‹©ä¸€ä¸ªserveræ¥è¿›è¡Œè¯»å–(è®ºæ–‡ä¸­è¯´ä¼šé€‰æ‹©ä¸€ä¸ªæœ€è¿‘çš„æœåŠ¡å™¨ï¼Œåº”ä¸ºgoogleé‡Œé¢ipæ˜¯è¿ç»­çš„ï¼Œå¯ä»¥æ ¹æ®ipåˆ¤æ–­è¿œè¿‘) ï¼Œåº”ä¸ºå®¢æˆ·ç«¯æ¯æ¬¡åªè¯»å–1mbæˆ–è€…64kbçš„æ•°æ®ï¼Œæ‰€ä»¥å®ƒä¼šç¼“å­˜chunkä¸chunk serverçš„å…³ç³»ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è¯·æ±‚ã€‚ chunk serveræ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®chunk handle(æ¨æµ‹chunkæ˜¯å®‰è£…chunk handleè¿›è¡Œå‘½åçš„)æ‰¾åˆ°å¯¹åº”çš„chunkä»¥åŠoffsetå¯¹åº”çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚ q1: å¦‚æœè¯»å–çš„æ•°æ®è·¨è¶Šäº†ä¸€ä¸ªchunkæ€ä¹ˆåŠï¼Ÿ ä¾‹å¦‚è¯´clientæƒ³è¦è¯»å–çš„æ•°æ®è¶…è¿‡äº†64mbï¼Œæˆ–è€…ä»…ä»…ä¸Šæ˜¯2ä¸ªbyteå´è·¨è¶Šäº†chunkï¼Œclientä¼šåœ¨å‘é€è¯·æ±‚æ—¶æ³¨æ„åˆ°è¿™æ¬¡è¯·æ±‚è·¨è¶Šäº†è¾¹ç•Œï¼Œ æ‰€ä»¥ä¼šå°†ä¸€ä¸ªè¯·æ±‚æ‹†åˆ†ä¸º2ä¸ªè¯·æ±‚å‘é€åˆ°masterï¼Œæ‰€ä»¥è¿™é‡Œå¯èƒ½ä¸Šå‘masterå‘é€ä¸¤æ¬¡è¯»è¯·æ±‚ï¼Œä¹‹ååœ¨å‘ä¸åŒçš„chunk serverè¯»å–æ•°æ®ã€‚","title":"GFS"},{"content":"æŸ¥çœ‹å½“å‰backlightç”±ä»€ä¹ˆæ§åˆ¶:\nä¸€èˆ¬éƒ½æ˜¯intelã€‚\nls /sys/class/backlight æŸ¥çœ‹å½“å‰çš„äº®åº¦:\ncat /sys/class/backlight/intel_backlight/max_brightness ä¿®æ”¹äº®åº¦:\necho 5000 | sudo tee /sys/class/backlight/intel_backlight/brightness ","permalink":"https://fzdwx.github.io/posts/2022-10-04-backlight/","summary":"ç”±äºä½¿ç”¨DWMï¼Œå®ƒä¸èƒ½åƒKDEé‚£æ ·ä¹‹é—´æœ‰å›¾å½¢åŒ–çš„äº®åº¦è°ƒèŠ‚åŠŸèƒ½ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚","title":"è°ƒèŠ‚linuxå±å¹•çš„äº®åº¦"},{"content":"ç»ˆç«¯ä¸‹å¥½ç”¨çš„ç¨‹åº ranger \u0026nbsp;https://github.com/ranger/ranger é…ç½®æ¨è \u0026nbsp;https://zhuanlan.zhihu.com/p/105731111 \u0026nbsp;https://zhuanlan.zhihu.com/p/441083543 fzf(æ¨¡ç³Šæœç´¢) \u0026nbsp;https://github.com/junegunn/fzf å‹æµ‹å·¥å…· \u0026nbsp;https://github.com/link1st/go-stress-testing vhs(æ ¹æ®é¢„å®šä¹‰çš„å‘½ä»¤ï¼Œè°ƒç”¨bashï¼Œç„¶åå°†è¾“å‡ºç»“æœè®°å½•ä¸ºgifç­‰) \u0026nbsp;https://github.com/charmbracelet/vhs ä¸€äº›å¼€æºä¹¦ \u0026nbsp;ã€ŠFFmpegåŸç†ã€‹ æ­£åˆ™è¡¨è¾¾å¼ \u0026nbsp;learn regex101 Blockchain \u0026nbsp;ä¸­æœ¬èªè®ºæ–‡ é€ŸæŸ¥è¡¨ \u0026nbsp;GDB Card \u0026nbsp;LLDB ","permalink":"https://fzdwx.github.io/notes/1/","summary":"ç»ˆç«¯ä¸‹å¥½ç”¨çš„ç¨‹åº ranger \u0026nbsp;https://github.com/ranger/ranger é…ç½®æ¨è \u0026nbsp;https://zhuanlan.zhihu.com/p/105731111 \u0026nbsp;https://zhuanlan.zhihu.com/p/441083543 fzf(æ¨¡ç³Šæœç´¢) \u0026nbsp;https://github.com/junegunn/fzf å‹æµ‹å·¥å…· \u0026nbsp;https://github.com/link1st/go-stress-testing vhs(æ ¹æ®é¢„å®šä¹‰çš„å‘½ä»¤ï¼Œè°ƒç”¨bashï¼Œç„¶åå°†è¾“å‡ºç»“æœè®°å½•ä¸ºgifç­‰) \u0026nbsp;https://github.com/charmbracelet/vhs ä¸€äº›å¼€æºä¹¦ \u0026nbsp;ã€ŠFFmpegåŸç†ã€‹ æ­£åˆ™è¡¨è¾¾å¼ \u0026nbsp;learn regex101 Blockchain \u0026nbsp;ä¸­æœ¬èªè®ºæ–‡ é€ŸæŸ¥è¡¨ \u0026nbsp;GDB Card \u0026nbsp;LLDB ","title":"ğŸŒŸ  æ”¶è—å¤¹"},{"content":"å®‰è£…: git clone https://git.suckless.org/dwm cd dwm sudo make clean install å¯åŠ¨ å¦‚æœå·²ç»æœ‰äº†sddmï¼Œå¯ä»¥ä½¿ç”¨sudo systemctl disable sddm.service æ¥è¿›è¡Œå…³é—­ï¼Œå¦‚æœåˆ°æ—¶å€™ä¸æƒ³ç”¨äº†å¯ä»¥ç”¨sudo systemctl enable sddm.serviceæ¥å¼€å¯sddmã€‚\n# å‡†å¤‡é…ç½®æ–‡ä»¶ cp /etc/X11/xinit/xinitrc ~/.xinitrc vim ~/.xinitrc # æ·»åŠ  exec dwm # æ³¨é‡Š #twm \u0026amp; #xclock -geometry 50x50-1+1 \u0026amp; #xterm -geometry 80x50+494+51 \u0026amp; #xterm -geometry 80x20+494-0 \u0026amp; #exec xterm -geometry 80x66+0+0 -name login ç„¶åé‡å¯å¹¶è°ƒç”¨startxå³å¯ã€‚\né‡åˆ°çš„é—®é¢˜ ç›´æ¥æ–­ç½‘ ä½¿ç”¨NetworkManagerè¿›è¡Œè¿æ¥ï¼Œå¯èƒ½è¦ç”¨åˆ°dhcpcdã€‚\nnmcli device wifi list nmcli device wifi connect {{wifi name}} password {{pwd}} å¯èƒ½ä¼šè¿æ¥å¤±è´¥ï¼Œä½ å¯ä»¥è¯•è¯•nmcli connection show æ¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥å‰çš„è¿æ¥ä¿¡æ¯ï¼Œå¯ä»¥ç”¨nmcli connection delete {{wifi name}}æ¥åˆ é™¤å¯¹åº”çš„ä¿¡æ¯\nè¾“å…¥æ³•å¤±æ•ˆ æ·»åŠ é…ç½®æ–‡ä»¶\nvim ~/.pam_environment INPUT_METHOD DEFAULT=fcitx5 GTK_IM_MODULE DEFAULT=fcitx5 QT_IM_MODULE DEFAULT=fcitx5 XMODIFIERS DEFAULT=@im=fcitx5 æ·»åŠ å¯åŠ¨å‘½ä»¤\nvim ~/.xinitrc1 # åœ¨exec dwmä¹‹å‰æ·»åŠ  exec fcitx5 \u0026amp; æ‰©å±•å±å¹•æ— æ•ˆ # å¯ä»¥å…ˆæŸ¥çœ‹æœ‰å“ªäº›å±å¹• xrandr # # å°†ä¸‹é¢çš„å‘½ä»¤åŠ å…¥ ~/.xinitrc1 ä¸­ï¼Œåœ¨exec dwmä¹‹å‰æ·»åŠ  # æˆ‘æœ‰ä¸¤ä¸ªï¼Œæ˜¯ä¸Šä¸‹å…³ç³»ï¼Œæ‰€ä»¥ç”¨below å…¶ä»–æœ‰ left ä»¥åŠ right xrandr --output eDP-1-1 --auto --below HDMI-0 å¸¸ç”¨å¿«æ·é”® å¯ä»¥å‚è€ƒæˆ‘é…ç½®ï¼š \u0026nbsp;https://github.com/fzdwx/dwm MOD -\u0026gt; WIN\nå¿«æ·é”® desc MOD+SHIFT+ENTER æ–°å¼€ç»ˆç«¯ åœ¨æœ¬tagå†…åˆ‡æ¢èšç„¦çª—å£ å¿«æ·é”® desc ALT + tab åˆ‡æ¢èšç„¦çª—å£ MOD + up åˆ‡æ¢èšç„¦çª—å£ MOD + down åˆ‡æ¢èšç„¦çª—å£ è·¨tagæ“ä½œ å¿«æ·é”® desc MOD + left / right åˆ‡æ¢tag MOD + SHIGT + left / tight å°†å½“å‰çª—å£ç§»åŠ¨åˆ°å…¶ä»–tag MOD + a ç¬¬ä¸€æ¬¡æ˜¯æ˜¾ç¤ºæ‰€æœ‰tagï¼Œç¬¬äºŒæ¬¡æ˜¯è·³è½¬åˆ°èšç„¦çš„çª—å£æ‰€åœ¨çš„çª—å£ çª—å£æ“ä½œ å¿«æ·é”® desc MOD + q é€€å‡ºçª—å£ MOD + h éšè—çª—å£ MOD + SHIFT + h æ˜¾ç¤ºçª—å£ï¼ˆåƒä¸€ä¸ªæ ˆä¸€æ ·ã€‚ï¼‰ MOD + ENTER å°†å½“å‰çª—å£è®¾ç½®ä¸ºä¸»çª—å£ MOD + f å°†å½“å‰çª—å£å…¨å± MOD + CTRL + æ–¹å‘é”® ç§»åŠ¨çª—å£ MOD + ALT + æ–¹å‘é”® è°ƒæ•´çª—å£å¤§å° MOD + o åªæ˜¾ç¤ºå½“å‰çª—å£/æ˜¾ç¤ºæ‰€æœ‰çª—å£ MOD + t å¼€å¯/å…³é—­ èšç„¦ç›®æ ‡çš„æµ®åŠ¨æ¨¡å¼ MOD + SHIFT + t å¼€å¯/å…³é—­ å…¨éƒ¨ç›®æ ‡çš„æµ®åŠ¨æ¨¡å¼ | MOD + SHIFT + f | å¼€å¯/å…³é—­ çŠ¶æ€æ  |\nåˆ‡æ¢å±å¹• å¿«æ·é”® desc MOD + x å°†é¼ æ ‡ç§»åŠ¨åˆ°å…¶ä»–å±å¹• MOD + SHIFT + X å°†å½“å‰çª—å£ç§»åŠ¨åˆ°å…¶ä»–å±å¹• æ›´æ–° click status bar æœ€è¿‘è·Ÿè¿›äº†å¤§ä½¬çš„é…ç½®\u0026nbsp;yaocccc , å¯ç‚¹å‡»çš„ status bar.\nä¸»è¦åŸç†å°±æ˜¯æ ¹æ®é¢„å®šä¹‰çš„æ ¼å¼è§£æå‡ºsignal ,ç„¶åè°ƒç”¨é¢„å®šä¹‰çš„è„šæœ¬æ–‡ä»¶(\u0026nbsp;commit )\nä¹Ÿå¾ˆå®¹æ˜“æ‰©å±•ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„\u0026nbsp;fm , updateæ˜¯æ„é€ è¦è¿”å›çš„å†…å®¹, clickå°±æ˜¯ç‚¹å‡»æ—¶è°ƒç”¨çš„æ–¹æ³•,wezterm start --class float rangeræˆ‘è¿™ä¸€æ®µå°±æ˜¯å¯åŠ¨ wezterm å¹¶è°ƒç”¨ ranger.\nimg.png Links \u0026nbsp;ArchWiki Dwm \u0026nbsp;Dwm patches \u0026nbsp;Dwm patchesä¸­æ–‡ç¿»è¯‘ \u0026nbsp;picomç¾åŒ– ","permalink":"https://fzdwx.github.io/posts/2022-09-29-dwm/","summary":"å®‰è£…: git clone https://git.suckless.org/dwm cd dwm sudo make clean install å¯åŠ¨ å¦‚æœå·²ç»æœ‰äº†sddmï¼Œå¯ä»¥ä½¿ç”¨sudo systemctl disable sddm.service æ¥è¿›è¡Œå…³é—­ï¼Œå¦‚æœåˆ°æ—¶å€™ä¸æƒ³ç”¨äº†å¯ä»¥ç”¨sudo systemctl enable sddm.serviceæ¥å¼€å¯sddmã€‚\n# å‡†å¤‡é…ç½®æ–‡ä»¶ cp /etc/X11/xinit/xinitrc ~/.xinitrc vim ~/.xinitrc # æ·»åŠ  exec dwm # æ³¨é‡Š #twm \u0026amp; #xclock -geometry 50x50-1+1 \u0026amp; #xterm -geometry 80x50+494+51 \u0026amp; #xterm -geometry 80x20+494-0 \u0026amp; #exec xterm -geometry 80x66+0+0 -name login ç„¶åé‡å¯å¹¶è°ƒç”¨startxå³å¯ã€‚\né‡åˆ°çš„é—®é¢˜ ç›´æ¥æ–­ç½‘ ä½¿ç”¨NetworkManagerè¿›è¡Œè¿æ¥ï¼Œå¯èƒ½è¦ç”¨åˆ°dhcpcdã€‚\nnmcli device wifi list nmcli device wifi connect {{wifi name}} password {{pwd}} å¯èƒ½ä¼šè¿æ¥å¤±è´¥ï¼Œä½ å¯ä»¥è¯•è¯•nmcli connection show æ¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä»¥å‰çš„è¿æ¥ä¿¡æ¯ï¼Œå¯ä»¥ç”¨nmcli connection delete {{wifi name}}æ¥åˆ é™¤å¯¹åº”çš„ä¿¡æ¯","title":"Dwmåˆä½“éªŒ"},{"content":" ç”±äºæœ€è¿‘åˆ‡æ¢åˆ°äº†linuxï¼Œä¸å¯é¿å…çš„ç»å¸¸éœ€è¦ä½¿ç”¨viç­‰ç¼–è¾‘å™¨ï¼Œæ‰€ä»¥è¿™æ¬¡å¥½å¥½æŠ˜è…¾ä¸€ä¸‹ã€‚\næˆ‘çš„é…ç½®åœ°å€: \u0026nbsp;https://github.com/fzdwx/nvim ã€‚\næˆ‘çš„é…ç½® pakcer æˆ‘é€‰ç”¨çš„æ’ä»¶ç®¡ç†å™¨æ˜¯packerï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“é€‰ä»€ä¹ˆå¥½ï¼Œå°±æŒ‰æœ€æ–°çš„æ¥å§ã€‚\n--- setup packer local fn = vim.fn local install_path = fn.stdpath(\u0026#39;data\u0026#39;) .. \u0026#39;/site/pack/packer/start/packer.nvim\u0026#39; if fn.empty(fn.glob(install_path)) \u0026gt; 0 then packer_bootstrap = fn.system({ \u0026#39;git\u0026#39;, \u0026#39;clone\u0026#39;, \u0026#39;--depth\u0026#39;, \u0026#39;1\u0026#39;, \u0026#39;https://github.com/wbthomason/packer.nvim\u0026#39;, install_path }) vim.cmd(\u0026#34;packadd packer.nvim\u0026#34;) end --- add plugins require(\u0026#39;packer\u0026#39;).startup(function(use) -- è‡ªæ‰˜ç®¡ use \u0026#39;wbthomason/packer.nvim\u0026#39; -- å…¶ä»–æ’ä»¶ -- å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ™åŒæ­¥ if packer_bootstrap then require(\u0026#39;packer\u0026#39;).sync() end end) \u0026nbsp;alpha æ˜¯ä¸€ä¸ªdashboardï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ¬¢è¿ç•Œé¢ã€‚\nrequire(\u0026#39;packer\u0026#39;).startup(function(use) -- ... --- æ·»åŠ ä¸‹é¢ä¸¤è¡Œè¿›è¡Œå®‰è£… use \u0026#34;goolord/alpha-nvim\u0026#34;; use \u0026#34;kyazdani42/nvim-web-devicons\u0026#34;; -- ... end) é…ç½®ä»£ç å¤ªé•¿äº†å°±ä¸æ”¾äº†ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡Œ\u0026nbsp; è¿™é‡Œ å‚è€ƒã€‚\n\u0026nbsp;telescope ä¸»è¦ä½œç”¨æ˜¯æ–‡ä»¶çš„æŸ¥æ‰¾ä¸é¢„è§ˆã€‚\nrequire(\u0026#39;packer\u0026#39;).startup(function(use) -- ... --- æ·»åŠ ä¸‹é¢ä»£ç è¿›è¡Œå®‰è£… use { \u0026#39;nvim-telescope/telescope.nvim\u0026#39;, tag = \u0026#39;0.1.0\u0026#39;, \u0026#34;ahmedkhalf/project.nvim\u0026#34;, \u0026#39;nvim-lua/plenary.nvim\u0026#39;, } -- ... end) \u0026nbsp;é…ç½® \u0026nbsp;key map ä¸€äº›æ•™ç¨‹ \u0026nbsp;Rust and nvim ","permalink":"https://fzdwx.github.io/posts/2022-09-28-neovim-use-notes/","summary":"ç”±äºæœ€è¿‘åˆ‡æ¢åˆ°äº†linuxï¼Œä¸å¯é¿å…çš„ç»å¸¸éœ€è¦ä½¿ç”¨viç­‰ç¼–è¾‘å™¨ï¼Œæ‰€ä»¥è¿™æ¬¡å¥½å¥½æŠ˜è…¾ä¸€ä¸‹ã€‚","title":"Neovimä½¿ç”¨è®°å½•  "},{"content":" HTTP 1.1ä¹‹å‰çš„å®ç°å°±ä¸è®¨è®ºäº†ï¼Œå› ä¸ºå®ƒä»¬å·²ç»è¿‡æ—¶å¤ªä¹…äº†ï¼Œæˆ‘ä¸Šç½‘çš„æ—¶å€™å°±å·²ç»æ¥è§¦ä¸åˆ°äº†ï¼Œæ‰€ä»¥ä¸»è¦è¯´è¯´HTTP/1.1ã€HTTP/2ã€‚\nHTTP/1.1 HTTP/1.1åè®®æŠ¥æ–‡ç®€ä»‹ CRLF: \\r\\n\nMETHOD: HTTPè¯·æ±‚ï¼ŒGETã€POSTã€PUTã€DELETE\u0026hellip;\nURI: ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚/ï¼Œ/index.html\u0026hellip;\nHTTPVersion: HTTPåè®®çš„ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚HTTP/1.1ï¼ŒHTTP/2\nHEADERS: è¯·æ±‚å¤´ï¼Œä¾‹å¦‚Host:localhostï¼ŒAccept: */*ã€‚\nBODY: è¯·æ±‚ä½“ï¼Œä¾‹å¦‚è¯´ä¸€ä¸ªJSONæ•°æ®{\u0026quot;name\u0026quot;:\u0026quot;fzdwx\u0026quot;}\nHTTPStatus: HTTPå“åº”çŠ¶æ€ï¼Œå¸¸è§çš„æœ‰200ï¼Œ404ç­‰\nHTTPStatusDesc: HTTPå“åº”çŠ¶æ€æè¿°ï¼Œ200å¯¹åº”çš„OKã€‚\nè¯·æ±‚ METHOD\u0026lt;SPACE\u0026gt;URI\u0026lt;SPACE\u0026gt;HTTPVersion HEADERS \u0026lt;CRLF\u0026gt; BODY ç¤ºä¾‹:\nGET /hello HTTP/1.1 Host: 192.168.1.107:8889 Connection: keep-alive Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.82 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 å“åº” HTTPVersion HTTPStatus HTTPStatusDesc HEADERS \u0026lt;CRLF\u0026gt; BODY ç¤ºä¾‹:\nå¦‚æœå“åº”ä¸­ä½¿ç”¨äº†transfer-encoding: chunkedè¿™ä¸ªæ¥æ›¿ä»£Content-Length ï¼Œå°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¸å›ºå®šå¤§å°çš„å“åº”ï¼Œç»“å°¾é€šå¸¸ç”¨0\\r\\næ¥åˆ†å‰²ã€‚\nHTTP/1.1 200 OK transfer-encoding: chunked content-type: application/json; charset=utf-8 0/r/n HTTP/1.1ä¸»è¦æ–°ç‰¹æ€§ é»˜è®¤æ˜¯é•¿è¿æ¥(Connection: Keep-alive)ï¼Œæ”¯æŒä¸€ä¸ªTCPè¿æ¥å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚ ç¼“å­˜ç­–ç•¥ï¼Œåœ¨è¯·æ±‚å¤´ä¸­ä½¿ç”¨Cache-Controlï¼ŒExpiresï¼ŒLast-Modifiedï¼ŒETagç­‰æ¥æ§åˆ¶ã€‚ å…è®¸å“åº”åˆ†å—ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„transfer-encoding: chunkedï¼Œå…è®¸æœåŠ¡ç«¯å¯ä»¥å¤šæ¬¡è¿”å›å“åº”ä½“ã€‚ ä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œä¾‹å¦‚è¯´å¦‚æœæœ‰ä¸€ä¸ªTCPè¿æ¥é˜»å¡äº†ï¼Œè¿˜æ˜¯ä¼šå¼€å¯æ–°çš„TCPè¿æ¥è¿›è¡Œå¤„ç†è¯·æ±‚ã€‚\nH2 HTTP2ä¸­çš„ä¸»è¦æ¦‚å¿µ:\nConnection: ä¸€ä¸ªTCPè¿æ¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªStream,æ‰€æœ‰çš„é€šè®¯éƒ½åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šå®Œæˆã€‚ Stream: ä¸€ä¸ªå¯ä»¥åŒå‘é€šè®¯çš„æ•°æ®æµï¼ŒåŒ…å«ä¸€æ¡æˆ–å¤šæ¡Messageï¼Œæ¯ä¸ªæ•°æ®æµéƒ½ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ä»¥åŠå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ã€‚ Message: å¯¹åº”HTTP/1.1ä¸­çš„è¯·æ±‚æˆ–å“åº”ï¼ŒåŒ…å«ä¸€æ¡æˆ–å¤šæ¡Frameã€‚ Frame: æœ€å°ä¼ è¾“å•ä½ï¼Œå®ƒä»¥äºŒè¿›åˆ¶è¿›è¡Œç¼–ç ã€‚ \u0026nbsp;HTTPé€šè®¯ç®€å›¾ åœ¨HTTP/1.1ä¸­æ˜¯æœ‰Start Line + header + body ç»„æˆçš„ï¼Œè€Œåœ¨H2ä¸­æ˜¯ç”±ä¸€ä¸ªHEADER Frameä»¥åŠå¤šä¸ªDATA Frameç»„æˆçš„ã€‚\nHTTP/1.1ä¸H2æŠ¥æ–‡ç»„æˆçš„åŒºåˆ« Frame é€šå¸¸æœ‰ä¸€äº›å…¬å…±çš„å­—æ®µï¼Œä¾‹å¦‚Lengthï¼ŒTypeï¼ŒFlagsä»¥åŠStream Idï¼›ä¹Ÿå„ä¸ªç±»å‹æ‰€ç‹¬æœ‰çš„å­—æ®µã€‚\nåˆ†ç±»å¦‚ä¸‹:\n\u0026nbsp;DATA : ç”¨äºä¼ è¾“httpæ¶ˆæ¯ä½“ã€‚ \u0026nbsp;HEADERS : ç”¨äºä¼ è¾“é¦–éƒ¨å­—æ®µã€‚ \u0026nbsp;PRIORITY : ç”¨äºæŒ‡å®šæˆ–é‡æ–°æŒ‡å®šå¼•ç”¨èµ„æºçš„ä¼˜å…ˆçº§ã€‚ \u0026nbsp;RST_STREAM : ç”¨äºé€šçŸ¥æµçš„éæ­£å¸¸ç»ˆæ­¢ã€‚ \u0026nbsp;SETTINGS : ç”¨äºçº¦å®šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é…ç½®æ•°æ®ã€‚ä¾‹å¦‚è®¾ç½®åˆè¯†çš„åŒå‘æµé‡æ§åˆ¶çª—å£å¤§å°ã€‚ \u0026nbsp;PUSH_PROMISE : æœåŠ¡ç«¯æ¨é€è®¸å¯ã€‚ \u0026nbsp;PING : ç”¨äºè®¡ç®—å¾€è¿”æ—¶é—´ï¼Œæ‰§è¡Œâ€œ æ´»æ€§â€ æ£€æ´»ã€‚ \u0026nbsp;GOAWAY : ç”¨äºé€šçŸ¥å¯¹ç«¯åœæ­¢åœ¨å½“å‰è¿æ¥ä¸­åˆ›å»ºæµã€‚ \u0026nbsp;WINDOW_UPDATE : ç”¨äºè°ƒæ•´ä¸ªåˆ«æµæˆ–ä¸ªåˆ«è¿æ¥çš„æµé‡ã€‚ \u0026nbsp;CONTINUATION : ä¸“é—¨ç”¨äºä¼ é€’è¾ƒå¤§ HTTP å¤´éƒ¨æ—¶çš„æŒç»­å¸§ã€‚ ä¸ºä»€ä¹ˆH2å¿…é¡»è¦èµ°HTTPSï¼Ÿ è¿™å…¶å®åœ¨H2æ ‡å‡†ä¸­æ²¡æœ‰è§„å®šï¼Œä¸»è¦æ˜¯ä¸ºäº†æ›´æ–¹ä¾¿çš„è¿›è¡ŒHTTPåè®®çš„ å‡çº§/åå•†ï¼Œç¡®è®¤ä¸€ä¸ªWebæœåŠ¡å™¨æ˜¯å¦æ”¯æŒH2é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼:\nåœ¨è¯·æ±‚å¤´ä¸­è®¾ç½®Upgrade: HTTP/2.0ä»¥åŠConnection: Upgrade,HTTP2-Settingsç­‰ï¼Œç±»ä¼¼å‡çº§åˆ°Websocketã€‚ ä½¿ç”¨TLSä¸­çš„ALPN(Application Layer Protocol Negotiationï¼Œåº”ç”¨å±‚åè®®åå•†)ä¸­çš„ALPN Next Protocol å­—æ®µï¼Œåœ¨Client Helloä¸Server Helloè¿™ä¸ªé˜¶æ®µå°±å¯ä»¥ç¡®å®šä¸‹æ¥ã€‚ è€Œç°åœ¨çš„æµè§ˆå™¨åŸºæœ¬éƒ½æ˜¯å®ç°çš„æ–¹å¼äºŒï¼Œå³ä¸HTTPSç»‘å®šåœ¨ä¸€èµ·ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸ç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨HTTPSã€‚\nè¯¦ç»†å¯\u0026nbsp;å‚è€ƒ ã€‚\nä¸ºä»€ä¹ˆH2èƒ½å®ç°å¹¶è¡Œå“åº”è¯·æ±‚? åœ¨HTTP/1.1ä¸­ï¼Œè¯·æ±‚ä¸å“åº”æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œåœ¨åŒä¸€ä¸ªè¿æ¥é‡Œï¼Œå®¢æˆ·ç«¯ä¾æ¬¡å‘é€ä¸¤ä¸ªè¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´ä»¥åæ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„ä¸€ä¸ªå“åº”ï¼Œè¿™ä¸ªå“åº”ä¸€å®šæ˜¯å¯¹åº”äºç¬¬ä¸€ä¸ªå‘å‡ºå»çš„è¯·æ±‚çš„ã€‚ å› ä¸ºæ²¡æœ‰ä¸€ä¸ªæ ‡å¿—æ¥è¡¨ç¤ºå“ªä¸ªå“åº”å¯¹åº”å“ªä¸ªè¯·æ±‚ã€‚\nè€Œåœ¨H2ä¸­åŸºäºStreamå’ŒFrameçš„è®¾è®¡: æ¯ä¸ªFrameéƒ½å¸¦æœ‰Stream Idæ¥æ ‡è¯†æ˜¯å¦ä¸ºåŒä¸€ä¸ªStreamé‡Œé¢çš„æ•°æ®ï¼Œæ¯ä¸ªStream äº’ä¸å½±å“ï¼Œè¿™æ ·å°±èƒ½åšåˆ°åœ¨ä¸€ä¸ªTCPé‡Œé¢è¿æ¥é‡Œé¢ä¼ è¾“å¤šå¯¹è¯·æ±‚/å“åº”ã€‚\nH2çš„æ–°ç‰¹æ€§ H2çš„å¯¹HTTP/1.1ä¼˜åŒ–çš„æ ¸å¿ƒå°±æ˜¯ ä½¿ç”¨å°½å¯èƒ½å°‘çš„è¿æ¥æ•°ã€‚\nå¤šè·¯å¤ç”¨: åªç”¨ä¸€ä¸ªTCPè¿æ¥å°±èƒ½å¤„ç†å¤šå¯¹ è¯·æ±‚/å“åº” ï¼Œä¸ç”¨åœ¨å¼€å¯å¦å¤–çš„TCPè¿æ¥ï¼Œå°±æ˜¯é€šè¿‡Streamä¸Frameæ¥å®ç°çš„ã€‚ äºŒè¿›åˆ¶åˆ†å¸§: ä½¿ç”¨Frameä¸ºæœ€å°å•ä½è¿›è¡Œé€šè®¯ï¼Œå¹¶é‡‡ç”¨äºŒè¿›åˆ¶ç¼–ç ã€‚ \u0026nbsp;å¤´éƒ¨å‹ç¼© : ä½¿ç”¨HPACKç®—æ³•è¿›è¡Œä¼˜åŒ–. ç»´æŠ¤ä¸€ä»½ç›¸åŒçš„\u0026nbsp;é™æ€å­—å…¸ ï¼ŒåŒ…å«å¸¸è§çš„è¯·æ±‚å¤´çš„KVç»„åˆ ä¸€ä»½åŠ¨æ€å­—å…¸ï¼Œå¯ä»¥åŠ¨æ€çš„æ‰©å®¹(æ¯ä¸ªè¿æ¥å•ç‹¬ç»´æŠ¤) æ”¯æŒå“ˆå¤«æ›¼ç¼–ç (\u0026nbsp;é™æ€å“ˆå¤«æ›¼ç è¡¨ ) åœ¨HTTP/1ä¸­æ¶ˆæ¯ä½“å¯ä»¥ç”¨gzipè¿›è¡Œå‹ç¼©ï¼Œä½†æ˜¯è¯·æ±‚å¤´é€šå¸¸æ²¡æœ‰ä»»ä½•å‹ç¼©ï¼Œæœ‰æ—¶å€™è¯·æ±‚å¤´çš„æ•°æ®å¯èƒ½æ¯”è¯·æ±‚ä½“çš„æ•°æ®è¿˜å¤šã€‚\nè¯·æ±‚ä¼˜å…ˆçº§: ä¸€èˆ¬åœ¨HEADERSå¸§ä¸PRIORITYå¸§ä¸­æºå¸¦ï¼Œé€šå¸¸ä¾èµ–äºæœåŠ¡ç«¯çš„æ”¯æŒç¨‹åº¦ã€‚ å·¥å…· ç”Ÿæˆæµ‹è¯•ç­¾å go run $GOROOT/src/crypto/tls/generate_cert.go --host localhost ä½¿ç”¨curlè°ƒè¯•HTTPS curl https://zcygov.cn -vv Links \u0026nbsp;Hypertext Transfer Protocol Version 2 (HTTP/2) \u0026nbsp;HPACK: Header Compression for HTTP/2 \u0026nbsp;HTTP/2èµ„æ–™æ±‡æ€» \u0026nbsp;HTTP/2ä¸­å¸§çš„å®šä¹‰ \u0026nbsp;HTTP/2æ–°çš„æœºé‡ä¸æŒ‘æˆ˜ \u0026nbsp;æ¢ç´¢http1.0åˆ°http3.0çš„å‘å±•å²ï¼Œè¯¦è§£http2.0 \u0026nbsp;HTTP/2ç›¸æ¯”1.0æœ‰å“ªäº›é‡å¤§æ”¹è¿› ","permalink":"https://fzdwx.github.io/posts/2022-09-28-http-protocol/","summary":"ç®€ä»‹HTTP/1.1ä¸H2ã€‚","title":"HTTPåè®®"},{"content":"çœ‹çš„æ—¶å€™å¾ˆæ‡µï¼Œå†™çš„æ—¶å€™æ›´æ‡µï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¦å†™å‡ ä¸ªMapReduceçš„ç¨‹åºï¼Œåœ¨æŠŠå®˜æ–¹çš„A few rulesä»¥åŠHints( ç¿»è¯‘å¯ä»¥çœ‹\u0026nbsp;è¿™é‡Œ ) ä»”ç»†çš„é˜…è¯»äº†å‡ éåæ‰å‘ç°æ˜¯è¦å†™ä¸€ä¸ª MapReduce çš„è°ƒåº¦æ¡†æ¶ã€‚ã€‚ã€‚\nè§£é¢˜æ€è·¯å¯ä»¥åˆ†ä¸º 3 æ­¥ã€‚\nworkerä¸masterå…ˆé€šè¿‡rpcè¿›è¡Œé€šä¿¡ï¼Œå³workerå‘é€è¯·æ±‚ï¼Œmasterèƒ½å¤Ÿæ­£ç¡®çš„åº”ç­”ä¸”worker èƒ½å¤Ÿæ”¶åˆ°ã€‚è¿™ä¸€éƒ¨åˆ†å…¶å®ç¤ºä¾‹ä»£ç å·²ç»ç»™åˆ°äº†ï¼Œå¯ä»¥æ¨¡ä»¿ç€å†™ä¸€ä¸ªä»masterè·å–éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åç§°çš„rpc requestã€‚ ä¸Šé¢ä¸€æ­¥å®Œæˆåå°±å¯ä»¥è¿›è¡ŒçœŸæ­£çš„Map taskè¯·æ±‚ä»¥åŠæ‰§è¡Œäº†: Map taskä½•æ—¶ç”Ÿæˆï¼Ÿ æ¯ä¸ªworkeråªå‘masterè¯·æ±‚ä¸€æ¬¡å°±å¥½äº†å—ï¼Ÿ Map taskæ‰§è¡Œ è¶…æ—¶/å¤±è´¥ éœ€è¦æœ‰é‡è¯•æœºåˆ¶å—ï¼Ÿ å¦‚ä½•ä¿è¯Map taskæ¶ˆè´¹æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼Ÿ å½“æ‰€æœ‰çš„Map taskæ‰§è¡Œå®Œæ¯•åå°±éœ€è¦æ‰§è¡ŒReduce taskäº†ï¼Œå¦‚æœä½ å†™å®Œäº†ç¬¬ 2 æ­¥ï¼Œé‚£ä¹ˆReduce taskå…¶å®å°±æ˜¯æ°´åˆ°æ¸ æˆäº†ã€‚ ç”ŸæˆReduce taskï¼Œè¿™é‡Œçš„æ¯ä¸ªReduce taskéœ€è¦åŠ è½½çš„æ–‡ä»¶æŒ‰ä»€ä¹ˆåˆ†æˆä¸€ç»„ï¼Ÿ å‰©ä¸‹çš„ä¸Map taskå¤„ç†æ–¹æ³•ç›¸åŒã€‚ æˆ‘å°±æ˜¯å¡åœ¨äº†Reduce taskåˆ›å»ºæ—¶æ–‡ä»¶åˆ†ç»„è¿™ä¸ªåœ°æ–¹äº†ï¼Œæˆ‘ç›´æ¥æŠŠåŒä¸€ä¸ªMap taskç”Ÿæˆçš„æ–‡ä»¶å½“æˆä¸€ç»„äº†\u0026hellip;ä½†æ˜¯æ˜¾ç„¶ä¸æ˜¯è¿™æ ·ã€‚\n","permalink":"https://fzdwx.github.io/posts/2022-09-27-mit6.824-lab1/","summary":"about mit6.824 lab1(Map reduce framework)","title":"MapReduce æ¡†æ¶å®ç°æ€è·¯"},{"content":" ä»Šå¤©å‘ç°äº†ä¸€ä¸ª linux ä¸‹çš„ application launcher \u0026nbsp;rofi ï¼Œå®ƒå¯ä»¥å¿«é€Ÿåˆ‡æ¢çª—å£å’Œå¯åŠ¨ç¨‹åºï¼Œ æˆ‘ç”¨å®ƒå’Œwmctrlè¿›è¡Œé…åˆä½¿ç”¨ã€‚\næˆ‘çš„ä½¿ç”¨è¿‡ç¨‹:\n1.Archlinux install\nyay -S rofi 2.æ·»åŠ è‡ªå®šä¹‰å¿«æ·é”®ç»‘å®š hotkey ä¸ºalt+spaceè§¦å‘rofi -showã€‚\n3.pressalt+spaceï¼Œç„¶åä½¿ç”¨shift+leftorrightè¿›è¡Œåˆ‡æ¢ mode ã€‚\næ›´æ”¹ä¸»é¢˜ä»¥åŠæ˜¾ç¤º icon:\n1.ç”Ÿæˆé…ç½®æ–‡ä»¶\nmkdir -p ~/.config/rofi rofi -dump-config \u0026gt; ~/.config/rofi/config.rasi 2.æ˜¾ç¤ºicon\nsed -i \u0026#39;8c show-icons: true;\u0026#39; ~/.config/rofi/config.rasi 3.æ›´æ¢ä¸»é¢˜\nå‚è€ƒ \u0026nbsp;https://github.com/lr-tech/rofi-themes-collection#installing-themes æˆ‘çš„wmctrlçš„é…ç½®ç¤ºä¾‹:\nä½¿ç”¨xprop WM_CLASSè·å–å‰ç¼€ã€‚\nalias chrome=\u0026#34;wmctrl -x -a google-chrome || google-chrome-stable \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#34; alias note=\u0026#34;wmctrl -x -a obsidian || /usr/bin/obsidian \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#34; alias codew=\u0026#34;wmctrl -x -a code || /opt/code/code \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#34; alias idea=\u0026#34;wmctrl -x -a jetbrains-idea || /opt/idea/bin/idea.sh \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#34; alias discord=\u0026#34;wmctrl -x -a discord || /opt/discord/Discord \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026#34; ","permalink":"https://fzdwx.github.io/posts/2022-09-18-about-rofi/","summary":"ä¸€ä¸ª linux ä¸‹çš„ application launcher, è®©ä½ åªç”¨é”®ç›˜å°±å¯ä»¥è¿›è¡Œåº”ç”¨çš„å¯åŠ¨ä¸åˆ‡æ¢ã€‚","title":"About rofi"},{"content":"","permalink":"https://fzdwx.github.io/flomo/","summary":"","title":""}]