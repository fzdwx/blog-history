<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>os | fzdwx</title><meta name=keywords content><meta name=description content="What you say ?"><meta name=author content="fzdwx"><link rel=canonical href=https://fzdwx.github.io/tags/os/><link crossorigin=anonymous href=/assets/css/stylesheet.min.eb182c2fc225cb57e6032b17e1506450a0999d8d31dcfab8f6662ebce29da943.css integrity="sha256-6xgsL8Ily1fmAysX4VBkUKCZnY0x3Pq49mYuvOKdqUM=" rel="preload stylesheet" as=style><link rel=icon href=https://fzdwx.github.io/favicon.ico><link rel=apple-touch-icon href=https://fzdwx.github.io/apple-touch-icon.png><link rel=alternate type=application/rss+xml href=https://fzdwx.github.io/tags/os/feed.xml><meta name=twitter:card content="summary"><meta name=twitter:title content="os | fzdwx"><meta name=twitter:description content="What you say ?"><meta property="og:title" content="os | fzdwx"><meta property="og:description" content="What you say ?"><meta property="og:type" content="website"><meta property="og:url" content="https://fzdwx.github.io/tags/os/"><meta property="og:image" content="https://avatars.githubusercontent.com/u/65269574?v=4"><meta property="og:site_name" content="fzdwx"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="list-page type-tags kind-term layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark"),document.body.classList.add("light");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches?document.body.classList.add("dark"):document.body.classList.add("light")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-tc-webfont@1.0.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/400.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/400-italic.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/500.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/500-italic.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/700.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/800.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/700-italic.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/jetbrains-mono@4.5.11/800-italic.css><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[","]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><div class=sticky-top><div class=header-bar></div><header class=header><nav class=nav><div class=logo><a href=https://fzdwx.github.io/ accesskey=h title="fzdwx (Alt + H)">fzdwx</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><img class=logo-img src=/images/party_parrot.gif alt=logo aria-label=logo height=30 width=30></li><li><a href=https://fzdwx.github.io/notes/ title=Notes>Notes</a></li><li><a href=https://fzdwx.github.io/archives/ title=Archives>Archives</a></li><li><a href=https://fzdwx.github.io/tags/ title=Tags class=active>Tags</a></li><li><a href=https://fzdwx.github.io/links/ title=Links>Links</a></li></ul></nav></header></div><main class=main><header class=page-header><div class=breadcrumbs><a href=https://fzdwx.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fzdwx.github.io/tags/>Tags</a></div><h1>tag: os</h1><div class=inline-links><span><a href=https://fzdwx.github.io/tags/os/feed.xml target=_blank>RSS</a></span></div></header><article class="post-entry tag-entry"><header class=entry-header><h2>操作系统的特权级机制</h2></header><section class=entry-content><p>应用程序会不可避免的出现错误，如果一个程序出现错误会导致其他程序或操作系统都无法运行那就是不可接受的。
所以人们提出特权级（Privilege）这一保护计算机系统不受有意或无意出错的程序破坏的机制，它让应用程序运行在用户态 ，而操作系统运行在内核态，并且实现用户态和内核态的隔离。
一个支持顺序执行多个应用程序的操作系统结构图 主要通过 RustSBI 完成基本的硬件初始化后，跳转到操作系统的起始位置，操作系统然后建立栈空间并情况 bss 段（置0），然后通过 AppManager 从 app 列表中一次加载各个 app 到指定的内存在用户态执行。app 在执行时，会通过系统调用的方式得到操作系统提供的功能，比如输出字符串。
特权级的软硬件协同设计 实现特权级机制的根本原因是应用程运行的安全性不可充分信任 。所以，计算机科学家和工程师想到了一个方法：让相对安全可靠的操作系统运行在一个硬件保护的安全执行环境中，不受到程序的破坏；而让应用程序运行在另外一个无法破坏操作系统的受限执行环境中。
应用程序不能访问任意的地址空间 应用程序不能执行某些可能破坏计算机系统的指令 同时为了应用程序能获得操作系统的服务——应用程序和操作系统还需要有交互的手段。
低特权级的软件只能做高特权级允许它做的操作 超出低特权级能力的功能必须寻求高特权级的帮助 这样高特权级(操作系统)就成为低特权级（一般应用）的执行环境的总要组成部分。
为了实现这样的特权级机制，需要进行软硬件协同设计。一种简介的方式是： 处理器设置两个不同安全等级的执行环境，* 用户态特权级的执行环境和内核态特权级的执行环境*。
明确指出可能破坏计算机系统的内核态特权指令集子集 规定内核态特权级指令子集中的指令只能在内核态特权级的执行环境中执行 处理器在执行指令前会进行特权级安全检查，如果在用户态环境中执行内核态特权级指令就会产生异常 传统的call和ret指令组合会直接绕过硬件的特权级保护检查，所以需要新的指令：
ecall： 执行环境调用，具有用户态到内核态的执行环境切换能力的函数调用指令 从当前特权级切换到比当前高一级 eret： 执行环境返回，基友内核态到用户态的执行环境切换能力的函数返回指令 切换到不高于当前特权级 硬件有了这样的机制之后，还需要操作系统的配合才能完成对操作系统自身的保护。
操作系统需要提供能在执行eret前准备和恢复用户态执行应用程序的上下文 在用户程序调用ecall后能检查应用程序的系统调用参数，确保参数不会破坏操作系统 RISC-V 特权级架构 级别 编码 名称 0 00 用户/应用模式 (U,User/Application) 1 01 监督模式 (S,Supervisor) 2 10 虚拟监督模式 (H,Hypervisor) 3 11 机器模式 (M,Machine) 级别数值越大则特权级越高，掌控硬件的能力越强。即 M 最强，U 最弱，在 CPU 层面只有 M 是必须的。...</p></section><footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>&nbsp;2022-12-30</span></span><span class=meta-item>
<span class=post-tags><span class=post-tag><a href=https://fzdwx.github.io/tags/os/>#os</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/note/>#note</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/risc-v/>#risc-v</a></span></span></span></footer><a class=entry-link aria-label="post link to 操作系统的特权级机制" href=https://fzdwx.github.io/posts/2022-12-30-os-privilege/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>操作系统的并发编程</h2></header><section class=entry-content><p>操作系统是最早的并发程序之一。
开始，我们肯定要理解什么是并发和并行以及它们的区别。
并行： 可以同时处理多个任务。 并发： 可以执行多个任务，但是同时只能执行一个任务，会在它们之间进行切换。 如果一个操作系统要支持并发，那么以下的哪些部分需要复制多份？ 全局变量 堆内存 函数调用栈 答案显而易见的是 函数调用栈 并发编程为什么难？
所有线程都共享一个堆内存 单个线程的状态机的执行结果是固定的，但是多线程不一样，因为它们涉及到一个线程切换的问题，这会导致每次程序运行的结果可能都是不一样的。 多线程状态机执行示意图 无法保证的三个特性 原子性: 一段代码执行时独占整个计算机系统 无法保证的例子： 两个线程对一个值进行 ++ N 次， 这个结果可能不是 2N 实现原子性： lock & unlock 实现临界去的绝对串行化 其他部分仍然可以并行执行 顺序性: 代码按编写的顺序执行，也就是实现源代码的按顺序翻译(为汇编)。 会导致的原因: 编译器的优化(编译器对内存访问 “eventually consistent” 的处理导致共享内存作为线程同步工具的失效。)，比如说 gcc 加-O1/2 实际例子： while(!done); // => opt if (!done) while(1); 实现源代码的按顺序翻译： 在代码中插入“优化不能穿越的” barrier asm volatile ("" ::: “memory”); 含义是 可以读写任何内存 使用 volatile 变量 保持 c 语义和汇编语义一致 extern int volatile done; while(!...</p></section><footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>&nbsp;2022-12-16</span></span><span class=meta-item>
<span class=post-tags><span class=post-tag><a href=https://fzdwx.github.io/tags/note/>#note</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/os/>#os</a></span></span></span></footer><a class=entry-link aria-label="post link to 操作系统的并发编程" href=https://fzdwx.github.io/posts/2022-12-16-os-concurrent/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>RISC-V 简介</h2></header><section class=entry-content><p>Resource  RISC-V Green Card  RISC-V Call convertion  P&H(RISC-V) 在汇编语言中没有变量这个概念，汇编语言通常操作的是寄存器。算术指令的操作数必须取自寄存器，内建于硬件的特殊位置(CPU内？)。
TIP 寄存器（Register）是 中央处理器 内用来暂存指令、 数据 和 地址 的 电脑存储器 。寄存器的存贮容量有限，读写速度非常快。在 计算机体系结构 里，寄存器存储在已知时间点所作计算的中间结果，通过快速地访问数据来加速 计算机程序 的执行。 RISC-V Card RISC-V 操作数 如果寄存器的大小是 64位 则称为双字，32位 则是单字。 x0 被硬连接到 0 add x3, x4, x0 => x3 = x4 (x0 is hard-wired to value 0) 汇编指令 存储操作数 TIP 将数据从内存复制到寄存器的数据传输指令称为 载入指令(load)。在 RISC-V 中指令是 ld,表示取双字。 一个从数组中取值的C程序，写出汇编代码 g = h + A[8]; A 是一个 100 个双字组成的数组，g, h分别存储在 x20, x21 中，数组起始地址或基址位于 x22 中。
ld x9, 8(x22) // x9 = A[8] add x21, x20, x9; // x21 = x20 + x9 存放基址的寄存器(x22)被称为基址寄存器, 数据传输指令中的 8 称为偏移量。...</p></section><footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>&nbsp;2022-12-10</span></span><span class=meta-item>
<span class=post-tags><span class=post-tag><a href=https://fzdwx.github.io/tags/risc-v/>#risc-v</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/os/>#os</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/note/>#note</a></span></span></span></footer><a class=entry-link aria-label="post link to RISC-V 简介" href=https://fzdwx.github.io/posts/2022-12-10-risc-v/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>浮点数在计算机中的表示</h2></header><section class=entry-content><p>表示方法 $(-1)^{S}\times(1.xxx…x_{2}\times2^{{yyy…y}_{2}})$ 指数表示Y,尾数表示X 单精度的表示方法 双精度的表示方法 公式:
$(-1)^{S}\times{F}\times{2^{E}}$ F 是尾数表示的值，E 是指数表示的值，S 就对应数的符号位, 1 表示负数。 移码表示法 TIP 最理想的表示法是将最小的负指数表示为 00…002， 将最大的正指数表示为 11…112。从移码表示的数减去原数就可以得到相应的偏移值，从而由无符号的移码可得到真实的值。 IEEE 754规定:
单精度的偏移值为 127 指数为 -1 表示 -1 + 12710 = 12610 = 011111102 +1 = 1 + 12710 = 12810 = 100000002 最大指数为127 最小为-126 双精度的指数偏移值为 1023 1023 -1022 带偏移值的指数意味着一个由浮点数表示的值实际上是:
$(-1)^{S}\times{(1 + 有效位数)}\times{2^{指数 - 偏移值}}$ 表示 - 0.7510 分数表示为：
(-3/4)10 = (-3/22)10 二进制小数表示:
(-11/22)10 = -0.112 -11 右移 2 位 用科学计数法表示:...</p></section><footer class=entry-footer><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>&nbsp;2022-12-09</span></span><span class=meta-item>
<span class=post-tags><span class=post-tag><a href=https://fzdwx.github.io/tags/risc-v/>#risc-v</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/os/>#os</a>
</span><span class=post-tag><a href=https://fzdwx.github.io/tags/note/>#note</a></span></span></span></footer><a class=entry-link aria-label="post link to 浮点数在计算机中的表示" href=https://fzdwx.github.io/posts/2022-12-09-float-rep/></a></article></main><footer class=footer><span>Copyright &nbsp;<a href=https://github.com/fzdwx target=_blank rel=noopener>fzdwx</a>
since 2022</span></span>
<span><a target=_blank href=https://github.com/fzdwx/fzdwx.github.io/issues>欢迎交流</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script src=/js/instantclick.min.js data-no-instant></script>
<script data-no-instant>InstantClick.init()</script><script src=https://unpkg.com/lucide@latest></script>
<script>lucide.createIcons()</script></body></html>